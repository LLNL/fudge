
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LUPY.ancestry &#8212; Fudge and GNDS 6.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="shortcut icon" href="../../_static/gnd-20121206-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Fudge and GNDS 6.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">LUPY.ancestry</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for LUPY.ancestry</h1><div class="highlight"><pre>
<span></span><span class="c1"># &lt;&lt;BEGIN-copyright&gt;&gt;</span>
<span class="c1"># &lt;&lt;END-copyright&gt;&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains all the ancestry classes. These classes allow a node in a hierarchy </span>
<span class="sd">to reference any other node in the hierarchy provided that each node of the hierarchy inherits</span>
<span class="sd">from one of the ancestry classes and the method :py:func:`Ancestry.setAncestor` is called to</span>
<span class="sd">contect a child node to its parent node.</span>

<span class="sd">This module was mainly written to support linking and xpath referencing in a GNDS hierarchy.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">cElementTree</span>

<span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">xmlNode</span> <span class="k">as</span> <span class="n">xmlNodeMode</span>        <span class="c1"># Wrapper around the xml parser.</span>
<span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">checksums</span> <span class="k">as</span> <span class="n">checksumsModule</span>

<span class="n">XML_declaration</span> <span class="o">=</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="Ancestry"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry">[docs]</a><span class="k">class</span> <span class="nc">Ancestry</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is designed to be a base class for a class (instance) that is a member of another</span>
<span class="sd">    class (instance). The function of this class is to aid in tracking a class&#39;s ancestors and all</span>
<span class="sd">    of the ancestors members. That is, if an instance is part of a hierarchy, this class provides </span>
<span class="sd">    methods, for example, that list the position of the instance within the hierarchy or give its </span>
<span class="sd">    position relative to another member in the hierarchy using xlinks.</span>

<span class="sd">    This class defines the following members:</span>

<span class="sd">        +---------------------------+-----------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        | moniker                   | The name associated with the class type.                                                                  |</span>
<span class="sd">        +---------------------------+-----------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        | ancestor                  | Instance which *self* is a child of.                                                                      |</span>
<span class="sd">        +---------------------------+-----------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        | keyName                   | The name of the key. The key&#39;s value is used by a suite to indentify an element of a suite.               |</span>
<span class="sd">        +---------------------------+-----------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        | ancestryMembers           | Tuple of names of the members of *self* that inherit from **Ancestry**.                                   |</span>
<span class="sd">        +---------------------------+-----------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        | legacyMemberNameMapping   | A map whose keys are legacy member names and whose associated values are the current memeber names.       |</span>
<span class="sd">        +---------------------------+-----------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        | monikerByFormat           | If the moniker had a different name for in a prior format version, then this is a dict of key/value where |</span>
<span class="sd">        |                           | key it the format version and its associated value is the moniker used for that format version.           |</span>
<span class="sd">        +---------------------------+-----------------------------------------------------------------------------------------------------------+</span>

<span class="sd">    This class defines moniker to be abstract meaning that all classes that inherit from this class must define moniker.</span>
<span class="sd">    The main reason for the **keyName** is that is it used by a **Suite** instance to reference (i.e., uniquely identify) its children.</span>

<span class="sd">    An instance has the xlink &#39;/the/list/of/ancestors/andSelf&#39; if attribute is None or</span>
<span class="sd">    &#39;/the/list/of/ancestors/andSelf[@attribute=&quot;value&quot;]&#39; if attribute is not None where each string</span>
<span class="sd">    part of the xpath the value of the moniker for that node. For example,</span>
<span class="sd">    for a hierarchy consisting of::</span>

<span class="sd">        class A with moniker &#39;nameA&#39; and </span>
<span class="sd">            member mB of class B, class B with moniker &#39;nameB&#39; and </span>
<span class="sd">                member mC of class C and class C with moniker &#39;nameC&#39;,</span>

<span class="sd">    then the xlink for an instance of a C class in the hierarchy is &#39;/nameA/nameB/nameC&#39;. If the mC instance</span>
<span class="sd">    set attribute to be the member &#39;greeting&#39; that, for this example as value &#39;Hi&#39;, then the</span>
<span class="sd">    xlink for the C class is &#39;/nameA/nameB/nameC[@greeting=&quot;Hi&quot;]&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">keyName</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ancestryMembers</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
    <span class="n">legacyMemberNameMapping</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">monikerByFormat</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the xpath of *self*.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXLink</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">moniker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ancestor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self&#39;s ancestor.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keyValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self&#39;s keyValue. If keyName is *None*, then *None* is returned.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyName</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rootAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traverse up the ancestry tree to the root ancestor and returns a reference to it. </span>
<span class="sd">        The root ancestor is the instance whose ancestor is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ancestor</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span><span class="p">(</span><span class="n">ancestor</span><span class="o">.</span><span class="n">__ancestor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span> <span class="n">ancestor</span> <span class="o">=</span> <span class="n">ancestor</span><span class="o">.</span><span class="n">__ancestor</span>
        <span class="k">return</span> <span class="n">ancestor</span>

<div class="viewcode-block" id="Ancestry.checkAncestry"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.checkAncestry">[docs]</a>    <span class="k">def</span> <span class="nf">checkAncestry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks that all ancestryMembers are properly set up. This method checks *self* and all its child nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            For internal use only.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">child</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isChild</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">checkAncestry</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING from checkAncestry: member &quot;</span><span class="si">%s</span><span class="s1">&quot; not a child of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXLink</span><span class="p">()))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Its ancestry is: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">toXLink</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ancestryMembers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="p">(</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">*</span> <span class="s1">&#39;    &#39;</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestryMembers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">member</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">member</span><span class="p">))</span>
            <span class="n">doLoop</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">:</span>
                <span class="n">member</span> <span class="o">=</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">doLoop</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member</span><span class="p">):</span>
                <span class="n">m1</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">doLoop</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">m1</span><span class="p">:</span> <span class="n">check</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">check</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING from checkAncestry: </span><span class="si">%s</span><span class="s1"> does not have member &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toXLink</span><span class="p">(),</span> <span class="n">member</span><span class="p">))</span></div>

<div class="viewcode-block" id="Ancestry.copy"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses deepcopy to make a copy of self.</span>

<span class="sd">        :return: copy of self</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">link</span> <span class="k">as</span> <span class="n">linkModule</span>

        <span class="n">theCopy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">theCopy</span><span class="o">.</span><span class="n">_copyPost</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">theCopy</span><span class="o">.</span><span class="n">findInstancesOfClassInChildren</span><span class="p">(</span><span class="n">linkModule</span><span class="o">.</span><span class="n">Link</span><span class="p">)</span> <span class="o">+</span> <span class="n">theCopy</span><span class="o">.</span><span class="n">findInstancesOfClassInChildren</span><span class="p">(</span><span class="n">linkModule</span><span class="o">.</span><span class="n">Link2</span><span class="p">):</span> <span class="n">link</span><span class="o">.</span><span class="n">updateLink</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">theCopy</span></div>

    <span class="k">def</span> <span class="nf">_copyPost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For internal use only. Recursively fixes up the ancestor stuff in self.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">PoPs</span> <span class="kn">import</span> <span class="n">suite</span> <span class="k">as</span> <span class="n">PoPsSuiteModule</span>
        <span class="kn">from</span> <span class="nn">fudge</span> <span class="kn">import</span> <span class="n">suites</span> <span class="k">as</span> <span class="n">suitesModule</span>

        <span class="k">for</span> <span class="n">memberName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestryMembers</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">memberName</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">member</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">member</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">member</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">member</span><span class="o">.</span><span class="n">_copyPost</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="p">(</span><span class="n">PoPsSuiteModule</span><span class="o">.</span><span class="n">Suite</span><span class="p">,</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">Suite</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">member</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">_copyPost</span><span class="p">()</span>

<div class="viewcode-block" id="Ancestry.findAttributeInAncestry"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.findAttributeInAncestry">[docs]</a>    <span class="k">def</span> <span class="nf">findAttributeInAncestry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributeName</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributeName</span><span class="p">):</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributeName</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find attribute name = </span><span class="si">%s</span><span class="s1"> in ancestry&#39;</span> <span class="o">%</span> <span class="n">attributeName</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span><span class="o">.</span><span class="n">findAttributeInAncestry</span><span class="p">(</span><span class="n">attributeName</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ancestry.findClassInAncestry"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.findClassInAncestry">[docs]</a>    <span class="k">def</span> <span class="nf">findClassInAncestry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find class name = </span><span class="si">%s</span><span class="s1"> in ancestry&#39;</span> <span class="o">%</span> <span class="n">class_</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span><span class="o">.</span><span class="n">findClassInAncestry</span><span class="p">(</span><span class="n">class_</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ancestry.findEntity"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.findEntity">[docs]</a>    <span class="k">def</span> <span class="nf">findEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="p">,</span> <span class="n">attribute</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default findEntity method. In general, sub-classes should over-ride this method.</span>
<span class="sd">        This method uses the following algorithm to find entity. Firstly, if &#39;attribute&#39; is None, then self is assumed</span>
<span class="sd">        to have an attribute named entityName which is taken to be the desired entity. Otherwise, self is iterated</span>
<span class="sd">        over until an item with an attribute named attribute with value value is found. In either case, if</span>
<span class="sd">        an entity is found, its moniker value must be entityName. If no entity is found, raise AttributeError.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">entityName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacyMemberNameMapping</span><span class="p">:</span> <span class="n">entityName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacyMemberNameMapping</span><span class="p">[</span><span class="n">entityName</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">entityName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="n">entityName</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span>

        <span class="n">entity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>                       <span class="c1"># try needed in case self cannot be iterated.</span>
                <span class="k">for</span> <span class="n">entity1</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">entity</span> <span class="o">=</span> <span class="n">entity1</span>
                        <span class="k">break</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">entity</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">entityName</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s1">&#39;moniker&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find entity </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entityName</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">entity</span></div>

<div class="viewcode-block" id="Ancestry.findInstancesOfClassInChildren"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.findInstancesOfClassInChildren">[docs]</a>    <span class="k">def</span> <span class="nf">findInstancesOfClassInChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">9999</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all instances of class *cls* in self&#39;s children, grand-children, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">foundInstances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">foundInstances</span>
        <span class="k">for</span> <span class="n">ancestryMember</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestryMembers</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ancestryMember</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span> <span class="n">foundInstances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span> <span class="n">foundInstances</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">findInstancesOfClassInChildren</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">foundInstances</span> <span class="o">+=</span> <span class="n">instance</span><span class="o">.</span><span class="n">findInstancesOfClassInChildren</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">foundInstances</span></div>

<div class="viewcode-block" id="Ancestry.isChild"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.isChild">[docs]</a>    <span class="k">def</span> <span class="nf">isChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Ancestry</span><span class="p">):</span> <span class="k">return</span> <span class="n">child</span><span class="o">.</span><span class="n">__ancestor</span> <span class="o">==</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Ancestry.isParent"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.isParent">[docs]</a>    <span class="k">def</span> <span class="nf">isParent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span> <span class="o">==</span> <span class="n">parent</span></div>

<div class="viewcode-block" id="Ancestry.setAncestor"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.setAncestor">[docs]</a>    <span class="k">def</span> <span class="nf">setAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ancestor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets self&#39;s ancestor to ancestor.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span> <span class="o">=</span> <span class="n">ancestor</span> </div>

<div class="viewcode-block" id="Ancestry.toRelativeXLink"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.toRelativeXLink">[docs]</a>    <span class="k">def</span> <span class="nf">toRelativeXLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">formatVersion</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string that is a relative xlink to another element (using XML xpath syntax).</span>
<span class="sd">        Both elements must reside in the same hierarchy.  For a description of xpath, see </span>
<span class="sd">        http://en.wikipedia.org/wiki/XPath_1.0#Syntax_and_semantics.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span><span class="o">.</span><span class="n">toRelativeXLink</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;../&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootAncestor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">rootAncestor</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Root ancestors not the same (&quot;</span><span class="si">%s</span><span class="s1">&quot; != &quot;</span><span class="si">%s</span><span class="s1">&quot;)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toXLink</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">toXLink</span><span class="p">()))</span>
            <span class="n">thisPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXLink</span><span class="p">(</span><span class="n">formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">othersPath</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">toXLink</span><span class="p">(</span><span class="n">formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thisPath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">othersPath</span><span class="p">):</span> <span class="k">break</span>
                <span class="k">if</span> <span class="n">tag</span> <span class="o">!=</span> <span class="n">othersPath</span><span class="p">[</span><span class="n">i1</span><span class="p">]:</span> <span class="k">break</span>
            <span class="n">relativePath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisPath</span><span class="p">)</span> <span class="o">-</span> <span class="n">i1</span><span class="p">):</span> <span class="n">relativePath</span> <span class="o">+=</span> <span class="s1">&#39;../&#39;</span>
            <span class="n">relativePath</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">othersPath</span><span class="p">[</span><span class="n">i1</span><span class="p">:])</span>
            <span class="k">return</span> <span class="n">relativePath</span></div>

<div class="viewcode-block" id="Ancestry.toXLink"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.toXLink">[docs]</a>    <span class="k">def</span> <span class="nf">toXLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatVersion</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string that is an xlink to self (using XML xpath syntax).  The resulting </span>
<span class="sd">        xlink starts at the root element. For a description of xpath, see </span>
<span class="sd">        http://en.wikipedia.org/wiki/XPath_1.0#Syntax_and_semantics.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ancestorXLink</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ancestorXLink</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ancestor</span><span class="o">.</span><span class="n">toXLink</span><span class="p">(</span><span class="n">formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span><span class="p">)</span>

        <span class="n">attribute</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">keyValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyValue</span>
        <span class="k">if</span> <span class="n">keyValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">attribute</span> <span class="o">=</span> <span class="s2">&quot;[@</span><span class="si">%s</span><span class="s2">=&#39;</span><span class="si">%s</span><span class="s2">&#39;]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyName</span><span class="p">,</span> <span class="n">keyValue</span><span class="p">)</span>

        <span class="n">moniker1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monikerByFormat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">formatVersion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ancestorXLink</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">moniker1</span><span class="p">,</span> <span class="n">attribute</span> <span class="p">)</span></div>

<div class="viewcode-block" id="Ancestry.followXPath"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.followXPath">[docs]</a>    <span class="k">def</span> <span class="nf">followXPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xPath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param xPath: string xPath, e.g. &quot;/reactionSuite/reactions/reaction[@label=&#39;2&#39;]&quot;</span>

<span class="sd">        :return: class instance pointed to by xPath</span>

<span class="sd">        Uses Ancestry.findEntity to find each element</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">follow2</span><span class="p">(</span><span class="n">xPathList</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For internal use. Recursive helper function: descend the path to find the correct element.&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xPathList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">node</span>

            <span class="n">xPathNext</span> <span class="o">=</span> <span class="n">xPathList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;[@&quot;</span> <span class="ow">in</span> <span class="n">xPathNext</span><span class="p">:</span>
                    <span class="n">r1</span><span class="p">,</span><span class="n">r2</span> <span class="o">=</span> <span class="n">xPathNext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[@&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">r2</span><span class="p">,</span><span class="n">r3</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">r3</span> <span class="o">=</span> <span class="n">r3</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">nodeNext</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">findEntity</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nodeNext</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">findEntity</span><span class="p">(</span><span class="n">xPathNext</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">XPathNotFound</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">follow2</span><span class="p">(</span><span class="n">xPathList</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">nodeNext</span><span class="p">)</span>

        <span class="n">xPathList</span> <span class="o">=</span> <span class="n">xPath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>                        <span class="c1"># FIXME refactor to use xml.etree.ElementPath.xpath_tokenizer?</span>

        <span class="k">while</span> <span class="n">xPathList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xPathList</span> <span class="o">=</span> <span class="n">xPathList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>                       <span class="c1"># Trim empty sections from the beginning.</span>

        <span class="k">while</span> <span class="n">xPathList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xPathList</span> <span class="o">=</span> <span class="n">xPathList</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                      <span class="c1"># Trim empty sections from the end as can happend with xPath = &#39;../&#39;.</span>

        <span class="k">if</span> <span class="s1">&#39;{&#39;</span> <span class="ow">in</span> <span class="n">xPath</span><span class="p">:</span>                                    <span class="c1"># Careful, qualifiers may contain &#39;/&#39;.</span>
            <span class="n">xpl2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">xPathList</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;}&#39;</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">and</span> <span class="s1">&#39;{&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">and</span> <span class="s1">&#39;{&#39;</span> <span class="ow">in</span> <span class="n">xpl2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;}&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xpl2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">xpl2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xpl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">xPathList</span> <span class="o">=</span> <span class="n">xpl2</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">follow2</span><span class="p">(</span><span class="n">xPathList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">XPathNotFound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">XPathNotFound</span><span class="p">(</span><span class="s2">&quot;Cannot locate path &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">xPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ancestry.printNewMembers"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.printNewMembers">[docs]</a>    <span class="k">def</span> <span class="nf">printNewMembers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method prints the type of *self* and then prints all the member added since the base class *cls2*. That is, </span>
<span class="sd">        those members which are not defined in by base class *cls2*.</span>

<span class="sd">        :param cls2:        Must be a base class for *self**.</span>
<span class="sd">        :param exclude:     If True, any member starting with an underscore (i.e., &#39;_&#39;) is also not printed.</span>
<span class="sd">        :param width:       The number of members printed per line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cls2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cls2</span> <span class="o">=</span> <span class="n">Ancestry</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">cls2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;self is not a derived fom class cls2&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="p">)</span>

        <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_ancestryMembers</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">cls2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">_ancestryMembers</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">-</span><span class="si">%d</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">members</span><span class="p">))</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;   &#39;</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">member</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">counter</span> <span class="o">%</span> <span class="n">width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;   &#39;</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">%</span> <span class="n">width</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span></div>

<div class="viewcode-block" id="Ancestry.printNonAncestryMembers"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.Ancestry.printNonAncestryMembers">[docs]</a>    <span class="k">def</span> <span class="nf">printNonAncestryMembers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method prints the type of *self* and then prints all the member added by the derived class. That is, </span>
<span class="sd">        those members which are not defined by the :py:class:`Ancestry` class.</span>

<span class="sd">        :param exclude:     If True, any member starting with an underscore (i.e., &#39;_&#39;) is also not printed.</span>
<span class="sd">        :param width:       The number of members printed per line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">printNewMembers</span><span class="p">(</span><span class="n">Ancestry</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="AncestryIO_base"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base">[docs]</a><span class="k">class</span> <span class="nc">AncestryIO_base</span><span class="p">(</span><span class="n">Ancestry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class adds methods to read and write *self* to a file. Currently, its supports reading and writing to an XML file.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AncestryIO_base.toXML"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.toXML">[docs]</a>    <span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calls self.toXML_strList and joins its returned list with &#39;\n&#39;.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="AncestryIO_base.toXML_strList"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.toXML_strList">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">toXML_strList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This methods must be overwritten by the derived class. It must return a Python list of strings that are the XML representation of *self*.&quot;&quot;&quot;</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="AncestryIO_base.saveToOpenedFile"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.saveToOpenedFile">[docs]</a>    <span class="k">def</span> <span class="nf">saveToOpenedFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fOut</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes an XML representation of *self* to the opened file *fOut*. This method uses *self.toXML* to construct *self*&#39;s XML representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AncestryIO_base.saveToFile"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.saveToFile">[docs]</a>    <span class="k">def</span> <span class="nf">saveToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes an XML representation of *self* to path *fileName*. This methods opens the file and calls **saveToOpenedFile** and then closes the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span> <span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">XML_declaration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveToOpenedFile</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AncestryIO_base.saveToHybrid"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.saveToHybrid">[docs]</a>    <span class="k">def</span> <span class="nf">saveToHybrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XML_name</span><span class="p">,</span> <span class="n">HDF_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">HDF_subDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minLength</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves *self* to as two files, with most of the hierarchy in an XML file but most of the numerical data saved in an associated HDF file.</span>
<span class="sd">        To construct the file names, the best is to leave *HDF_name* as None. However, if the HDF file should be put into a sub-directory</span>
<span class="sd">        below where the XML file will be placed, then one can leave *HDF_name* as **None** and set *HDF_subDir*. For example, to</span>
<span class="sd">        place the HDF file is the sub-directory &#39;HDF&#39;, set HDF_subDir=&#39;HDF&#39;. The following example will write the XMl to the file</span>
<span class="sd">        &#39;path/to/n-Pu239.xml&#39; and the HDF data to the file &#39;path/to/HDF/n-Pu239.h5&#39;:</span>

<span class="sd">        node.saveToHybrid(&#39;path/to/n-Pu239.xml&#39;, HDF_subDir=&#39;HDF&#39;)</span>

<span class="sd">        :param XML_name:    Name of the XML file written.</span>
<span class="sd">        :param HDF_name:    Name of the HDF file written. If None, will be the same as XML_name with extension changed to .h5</span>
<span class="sd">        :param HDF_subDir:  If not None, this name is added as a directory to the front of the HDF_name.</span>
<span class="sd">        :param minLength:   Minimum number of numerical values in a *Values* node before writing the *Values* node to HDF.</span>
<span class="sd">        :param flatten:     If True, GNDS datasets are concatenated into flattened HDF5 datasets.</span>
<span class="sd">        :param compress:    Enable gzip + shuffle compression for HDF5 datasets.</span>
<span class="sd">        :param kwargs:      Extra keywork arguments passed to other functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">fudge</span> <span class="kn">import</span> <span class="n">externalFile</span> <span class="k">as</span> <span class="n">externalFileModule</span>
        <span class="kn">from</span> <span class="nn">.hdf5</span> <span class="kn">import</span> <span class="n">HDF5_present</span><span class="p">,</span> <span class="n">h5py</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HDF5_present</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Missing module &#39;h5py&#39; must be installed to support generating HDF5 files.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;externalFiles&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveToFile</span><span class="p">(</span><span class="n">XML_name</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">HDF_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">XML_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">):</span>
                <span class="n">HDF_name</span> <span class="o">=</span> <span class="n">XML_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.h5&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">HDF_name</span> <span class="o">=</span> <span class="n">XML_name</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span>

        <span class="n">relativeHDF_name</span> <span class="o">=</span> <span class="n">HDF_name</span>
        <span class="n">commonPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span> <span class="n">XML_name</span><span class="p">,</span> <span class="n">HDF_name</span> <span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commonPath</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">relativeHDF_name</span> <span class="o">=</span> <span class="n">HDF_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">commonPath</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">HDF_subDir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">relativeHDF_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">HDF_subDir</span><span class="p">,</span> <span class="n">relativeHDF_name</span><span class="p">)</span>

        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">XML_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">HDF_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>

        <span class="n">HDF_opts</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;minLength&#39;</span><span class="p">:</span> <span class="n">minLength</span><span class="p">,</span> <span class="s1">&#39;flatten&#39;</span><span class="p">:</span> <span class="n">flatten</span><span class="p">,</span> <span class="s1">&#39;iData&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;dData&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;compression&#39;</span><span class="p">:</span> <span class="p">{}</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">compress</span><span class="p">:</span> <span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;compression&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip&#39;</span><span class="p">,</span> <span class="s1">&#39;shuffle&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">HDF_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
            <span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;h5file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">externalFileModule</span><span class="o">.</span><span class="n">ExternalFile</span><span class="p">(</span><span class="s2">&quot;HDF&quot;</span><span class="p">,</span> <span class="n">relativeHDF_name</span><span class="p">,</span> <span class="n">checksum</span> <span class="o">=</span> <span class="s2">&quot;deadbeef&quot;</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;sha1&quot;</span><span class="p">))</span>

            <span class="n">xmlString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXML</span><span class="p">(</span><span class="n">HDF_opts</span><span class="o">=</span><span class="n">HDF_opts</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;iData&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;iData&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;iData&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">iData</span><span class="p">,</span> <span class="o">**</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;dData&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;dData&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;dData&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dData</span><span class="p">,</span> <span class="o">**</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">])</span>

        <span class="n">sha1sum</span> <span class="o">=</span> <span class="n">checksumsModule</span><span class="o">.</span><span class="n">Sha1sum</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">HDF_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xmlString</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;externalFile&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;checksum=&quot;deadbeef&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">xmlString</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;deadbeef&quot;</span><span class="p">,</span> <span class="n">sha1sum</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">XML_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span> <span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">XML_declaration</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xmlString</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;HDF&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AncestryIO_base.parseAncestryMembers"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.parseAncestryMembers">[docs]</a>    <span class="k">def</span> <span class="nf">parseAncestryMembers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The method parses all member of *self.ancestryMembers* found in *node*. If *kwargs* contains the key *membersToSkip*</span>
<span class="sd">        then all members of *self* whose moniker is in the list *kwargs[&#39;membersToSkip&#39;] are not parsed. This, for example,</span>
<span class="sd">        allows the calling instance to parse the *externalFiles* member and set up needed entries into *kwargs*.</span>

<span class="sd">        This method returns a dictionary and a list. The dictionary contains all child nodes of *node* not parsed, including </span>
<span class="sd">        those specified by membersToSkip. The keys in the dictionary are the member monikers and the items are their associated </span>
<span class="sd">        child node of *node*. The list contains all monikers for the *ancestryMembers* not in *node*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">membersToSkip</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;membersToSkip&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">membersNotFoundInNode</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">childNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span> <span class="n">childNodes</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>

        <span class="k">for</span> <span class="n">ancestryMember</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestryMembers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ancestryMember</span> <span class="ow">in</span> <span class="n">membersToSkip</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">ancestryMember</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">childNodes</span><span class="p">:</span>
                <span class="n">membersNotFoundInNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ancestryMember</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ancestryMember</span><span class="p">)</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ancestryMember</span><span class="p">)</span><span class="o">.</span><span class="n">parseNode</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">childNodes</span><span class="p">,</span> <span class="n">membersNotFoundInNode</span></div>

<div class="viewcode-block" id="AncestryIO_base.parseCleanup"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.parseCleanup">[docs]</a>    <span class="k">def</span> <span class="nf">parseCleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method does nothing. A place holder incase the derived class needs one.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="AncestryIO_base.parseXMLString"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.parseXMLString">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parseXMLString</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses a XML string using class *cls*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Invalid string.&#39;</span><span class="p">)</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">cElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">xmlNodeMode</span><span class="o">.</span><span class="n">XML_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">xmlNodeMode</span><span class="o">.</span><span class="n">XML_node</span><span class="o">.</span><span class="n">etree</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parseNodeUsingClass</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">parseCleanup</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span></div>

<div class="viewcode-block" id="AncestryIO_base.readXML_file"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_base.readXML_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">readXML_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and parses an XML file using class *cls*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Invalid file name.&#39;</span><span class="p">)</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">cElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">xmlNodeMode</span><span class="o">.</span><span class="n">XML_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">xmlNodeMode</span><span class="o">.</span><span class="n">XML_node</span><span class="o">.</span><span class="n">etree</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Node name &quot;</span><span class="si">%s</span><span class="s1">&quot; in XML not the same as requested class moniker &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">moniker</span><span class="p">))</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sourcePath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fileName</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parseNodeUsingClass</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">parseCleanup</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span></div></div>

<div class="viewcode-block" id="AncestryIO"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO">[docs]</a><span class="k">class</span> <span class="nc">AncestryIO</span><span class="p">(</span><span class="n">AncestryIO_base</span><span class="p">):</span>

<div class="viewcode-block" id="AncestryIO.parseNodeUsingClass"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO.parseNodeUsingClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">parseNodeUsingClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method must be overrwritten by the derived class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="AncestryIO_bare"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_bare">[docs]</a><span class="k">class</span> <span class="nc">AncestryIO_bare</span><span class="p">(</span><span class="n">AncestryIO_base</span><span class="p">):</span>

<div class="viewcode-block" id="AncestryIO_bare.parseNode"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.AncestryIO_bare.parseNode">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">parseNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method must be overrwritten by the derived class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="XPathNotFound"><a class="viewcode-back" href="../../LUPY/index.html#LUPY.ancestry.XPathNotFound">[docs]</a><span class="k">class</span> <span class="nc">XPathNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">pass</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/gnd.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Fudge and GNDS 6.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">LUPY.ancestry</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, B.Beck, D. Brown, C. Mattoon, N. Patel, N. Summers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>