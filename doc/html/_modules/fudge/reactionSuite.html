
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fudge.reactionSuite &#8212; Fudge and GNDS 6.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="shortcut icon" href="../../_static/gnd-20121206-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Fudge and GNDS 6.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fudge.reactionSuite</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fudge.reactionSuite</h1><div class="highlight"><pre>
<span></span><span class="c1"># &lt;&lt;BEGIN-copyright&gt;&gt;</span>
<span class="c1"># &lt;&lt;END-copyright&gt;&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">reactionSuite.py contains the &#39;reactionSuite&#39; class that in turn holds all reactions for a given target/projectile.</span>
<span class="sd">reactionSuite is the top-level class for the GNDS structure.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">pqu</span> <span class="kn">import</span> <span class="n">PQU</span> <span class="k">as</span> <span class="n">PQUModule</span>

<span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">ancestry</span> <span class="k">as</span> <span class="n">ancestryModule</span>
<span class="kn">from</span> <span class="nn">LUPY.hdf5</span> <span class="kn">import</span> <span class="n">HDF5_present</span><span class="p">,</span> <span class="n">h5py</span>
<span class="kn">from</span> <span class="nn">fudge</span> <span class="kn">import</span> <span class="n">GNDS_formatVersion</span> <span class="k">as</span> <span class="n">GNDS_formatVersionModule</span>
<span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">checksums</span> <span class="k">as</span> <span class="n">checksumsModule</span>

<span class="kn">from</span> <span class="nn">PoPs</span> <span class="kn">import</span> <span class="n">IDs</span> <span class="k">as</span> <span class="n">IDsPoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs</span> <span class="kn">import</span> <span class="n">database</span> <span class="k">as</span> <span class="n">PoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs.chemicalElements</span> <span class="kn">import</span> <span class="n">misc</span> <span class="k">as</span> <span class="n">chemicalElementMiscPoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs.chemicalElements</span> <span class="kn">import</span> <span class="n">chemicalElement</span> <span class="k">as</span> <span class="n">chemicalElementPoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs.decays</span> <span class="kn">import</span> <span class="n">misc</span> <span class="k">as</span> <span class="n">decaysMiscPoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs.families</span> <span class="kn">import</span> <span class="n">unorthodox</span> <span class="k">as</span> <span class="n">unorthodoxPoPsModule</span>

<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">enums</span> <span class="k">as</span> <span class="n">xDataEnumsModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">axes</span> <span class="k">as</span> <span class="n">axesModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">values</span> <span class="k">as</span> <span class="n">valuesModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">vector</span> <span class="k">as</span> <span class="n">vectorModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">matrix</span> <span class="k">as</span> <span class="n">matrixModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">productArray</span> <span class="k">as</span> <span class="n">productArrayModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">XYs1d</span> <span class="k">as</span> <span class="n">XYs1dModule</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">enums</span> <span class="k">as</span> <span class="n">enumsModule</span>
<span class="kn">from</span> <span class="nn">fudge.core.utilities</span> <span class="kn">import</span> <span class="n">guessInteraction</span> <span class="k">as</span> <span class="n">guessInteractionModule</span>
<span class="kn">from</span> <span class="nn">fudge.processing</span> <span class="kn">import</span> <span class="n">group</span> <span class="k">as</span> <span class="n">groupModule</span>
<span class="kn">from</span> <span class="nn">fudge.processing</span> <span class="kn">import</span> <span class="n">nuclearPlusCoulombInterference</span> <span class="k">as</span> <span class="n">nuclearPlusCoulombInterferenceModule</span>
<span class="kn">from</span> <span class="nn">fudge.processing.deterministic</span> <span class="kn">import</span> <span class="n">multiGroupUpScatter</span> <span class="k">as</span> <span class="n">multiGroupUpScatterModule</span>
<span class="kn">from</span> <span class="nn">fudge.processing.deterministic</span> <span class="kn">import</span> <span class="n">particles</span> <span class="k">as</span> <span class="n">particlesModule</span>
<span class="kn">from</span> <span class="nn">fudge.processing</span> <span class="kn">import</span> <span class="n">transporting</span> <span class="k">as</span> <span class="n">transportingModule</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">suites</span> <span class="k">as</span> <span class="n">suitesModule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sums</span> <span class="k">as</span> <span class="n">sumsModule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">styles</span> <span class="k">as</span> <span class="n">stylesModule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">warning</span> <span class="k">as</span> <span class="n">warningModule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">product</span> <span class="k">as</span> <span class="n">productModule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">institution</span> <span class="k">as</span> <span class="n">institutionModule</span>
<span class="kn">from</span> <span class="nn">.resonances</span> <span class="kn">import</span> <span class="n">resonances</span> <span class="k">as</span> <span class="n">resonancesModule</span>

<span class="kn">from</span> <span class="nn">.reactionData</span> <span class="kn">import</span> <span class="n">crossSection</span> <span class="k">as</span> <span class="n">crossSectionModule</span>
<span class="kn">from</span> <span class="nn">.outputChannelData</span> <span class="kn">import</span> <span class="n">Q</span> <span class="k">as</span> <span class="n">QModule</span>
<span class="kn">from</span> <span class="nn">.productData</span> <span class="kn">import</span> <span class="n">averageProductEnergy</span> <span class="k">as</span> <span class="n">averageProductEnergyModule</span>
<span class="kn">from</span> <span class="nn">.productData.distributions</span> <span class="kn">import</span> <span class="n">angular</span> <span class="k">as</span> <span class="n">angularModule</span>

<span class="kn">from</span> <span class="nn">brownies.legacy.toENDF6</span> <span class="kn">import</span> <span class="n">ENDFconversionFlags</span> <span class="k">as</span> <span class="n">ENDFconversionFlagsModule</span>

<span class="kn">import</span> <span class="nn">fudge</span>

<div class="viewcode-block" id="NullDevice"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.NullDevice">[docs]</a><span class="k">class</span> <span class="nc">NullDevice</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For internal use. Used in methods to set logFile when one is not entered.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="NullDevice.write"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.NullDevice.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span> <span class="k">pass</span></div></div>

<div class="viewcode-block" id="ReactionSuite"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite">[docs]</a><span class="k">class</span> <span class="nc">ReactionSuite</span><span class="p">(</span><span class="n">ancestryModule</span><span class="o">.</span><span class="n">AncestryIO</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the main class for a gnds projectile/target object. It contains</span>
<span class="sd">        * optional external files (e.g. for covariances or binary data stored in another file)</span>
<span class="sd">        * a &#39;styles&#39; section describing all evaluated and processed data styles, documentation, etc.</span>
<span class="sd">        * a &#39;PoPs&#39; Database with a list of all particles encountered in the file</span>
<span class="sd">        * optional resonance data</span>
<span class="sd">        * a list of reactions</span>
<span class="sd">        * additional lists: summed reactions (e.g. total), production reactions, &#39;orphan products&#39;, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;reactionSuite&#39;</span>
    <span class="n">ancestryMembers</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;externalFiles&#39;</span><span class="p">,</span> <span class="s1">&#39;styles&#39;</span><span class="p">,</span> <span class="s1">&#39;PoPs&#39;</span><span class="p">,</span> <span class="s1">&#39;resonances&#39;</span><span class="p">,</span> <span class="s1">&#39;reactions&#39;</span><span class="p">,</span> <span class="s1">&#39;orphanProducts&#39;</span><span class="p">,</span> <span class="s1">&#39;productions&#39;</span><span class="p">,</span> <span class="s1">&#39;incompleteReactions&#39;</span><span class="p">,</span> <span class="s1">&#39;fissionComponents&#39;</span><span class="p">,</span> <span class="s1">&#39;sums&#39;</span><span class="p">,</span> <span class="s1">&#39;applicationData&#39;</span> <span class="p">)</span>
    <span class="n">childNodeOrder</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_1_10</span><span class="p">:</span> <span class="p">(</span><span class="n">suitesModule</span><span class="o">.</span><span class="n">ExternalFiles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>                <span class="n">stylesModule</span><span class="o">.</span><span class="n">Styles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> 
                                                 <span class="s1">&#39;documentations&#39;</span><span class="p">,</span>                                  <span class="n">PoPsModule</span><span class="o">.</span><span class="n">Database</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                 <span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>               <span class="n">suitesModule</span><span class="o">.</span><span class="n">Reactions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> 
                                                 <span class="n">suitesModule</span><span class="o">.</span><span class="n">OrphanProducts</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>               <span class="n">sumsModule</span><span class="o">.</span><span class="n">Sums</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> 
                                                 <span class="n">suitesModule</span><span class="o">.</span><span class="n">FissionComponents</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>            <span class="n">suitesModule</span><span class="o">.</span><span class="n">Productions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                 <span class="n">suitesModule</span><span class="o">.</span><span class="n">IncompleteReactions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>          <span class="n">suitesModule</span><span class="o">.</span><span class="n">ApplicationData</span><span class="o">.</span><span class="n">moniker</span> <span class="p">),</span>
            <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_2_0_LLNL_4</span><span class="p">:</span> <span class="p">(</span><span class="n">suitesModule</span><span class="o">.</span><span class="n">ExternalFiles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>                 <span class="n">stylesModule</span><span class="o">.</span><span class="n">Styles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                        <span class="n">PoPsModule</span><span class="o">.</span><span class="n">Database</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                        <span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>        <span class="n">suitesModule</span><span class="o">.</span><span class="n">Reactions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> 
                                                        <span class="n">suitesModule</span><span class="o">.</span><span class="n">OrphanProducts</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>                <span class="n">sumsModule</span><span class="o">.</span><span class="n">Sums</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> 
                                                        <span class="n">suitesModule</span><span class="o">.</span><span class="n">FissionComponents</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>             <span class="n">suitesModule</span><span class="o">.</span><span class="n">Productions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                        <span class="n">suitesModule</span><span class="o">.</span><span class="n">IncompleteReactions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>           <span class="n">suitesModule</span><span class="o">.</span><span class="n">ApplicationData</span><span class="o">.</span><span class="n">moniker</span><span class="p">),</span>
            <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_2_0</span><span class="p">:</span>      <span class="p">(</span><span class="n">suitesModule</span><span class="o">.</span><span class="n">ExternalFiles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>                 <span class="n">stylesModule</span><span class="o">.</span><span class="n">Styles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                        <span class="n">PoPsModule</span><span class="o">.</span><span class="n">Database</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                        <span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>        <span class="n">suitesModule</span><span class="o">.</span><span class="n">Reactions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> 
                                                        <span class="n">suitesModule</span><span class="o">.</span><span class="n">OrphanProducts</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>                <span class="n">sumsModule</span><span class="o">.</span><span class="n">Sums</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> 
                                                        <span class="n">suitesModule</span><span class="o">.</span><span class="n">FissionComponents</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>             <span class="n">suitesModule</span><span class="o">.</span><span class="n">Productions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>
                                                        <span class="n">suitesModule</span><span class="o">.</span><span class="n">IncompleteReactions</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span>           <span class="n">suitesModule</span><span class="o">.</span><span class="n">ApplicationData</span><span class="o">.</span><span class="n">moniker</span><span class="p">)}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">projectile</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">interaction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">formatVersion</span> <span class="o">=</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">projectileFrame</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">lab</span><span class="p">,</span> <span class="n">MAT</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">PoPs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sourcePath</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new reactionSuite object, containing all reaction data for a projectile/target combination.</span>

<span class="sd">        :param projectile:      Projectile ID (string)</span>
<span class="sd">        :param target:          Target ID (string)</span>
<span class="sd">        :param evaluation:      The evaluation for this protare (string)</span>
<span class="sd">        :param interaction:     The GNDS interaction for the protare (string)</span>
<span class="sd">        :param formatVersion:   GNDS format version (string)</span>
<span class="sd">        :param style:           Indicates style of data in this reactionSuite (evaluated, processed, etc.).  Instance of styles.style</span>
<span class="sd">        :param projectileFrame: Frame of the projectile. Allowed values are &#39;lab&#39; or &#39;centerOfMass&#39;</span>
<span class="sd">        :param MAT:             Integer ENDF MAT number (only needed for writing back to ENDF-6)</span>
<span class="sd">        :param PoPs:            A PoPs Database that is copied to self&#39;s PoPs Database</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">AncestryIO</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">projectile</span><span class="p">,</span> <span class="nb">str</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;projectile ID not a string&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__projectile</span> <span class="o">=</span> <span class="n">projectile</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="nb">str</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;target ID not a string&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__target</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">evaluation</span><span class="p">,</span> <span class="nb">str</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;evaluation not a string&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__evaluation</span> <span class="o">=</span> <span class="n">evaluation</span>

        <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">legacyTNSL</span><span class="p">:</span>
            <span class="n">interaction</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">TNSL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interaction</span> <span class="o">=</span> <span class="n">interaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__guessedInteraction</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">formatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">allowedPlus</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Unsupported GNDS PoPs structure &#39;</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span> <span class="n">formatVersion</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__projectileFrame</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">checkEnumOrString</span><span class="p">(</span><span class="n">projectileFrame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">MAT</span> <span class="o">=</span> <span class="n">MAT</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcePath</span> <span class="o">=</span> <span class="n">sourcePath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__externalFiles</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">ExternalFiles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__externalFiles</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">Styles</span><span class="p">(</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">PoPs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span> <span class="o">=</span> <span class="n">PoPs</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span> <span class="o">=</span> <span class="n">PoPsModule</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span> <span class="s1">&#39;protare_internal&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__resonances</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">Reactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">OrphanProducts</span><span class="p">(</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span> <span class="o">=</span> <span class="n">sumsModule</span><span class="o">.</span><span class="n">Sums</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">Productions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">IncompleteReactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">FissionComponents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__applicationData</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">ApplicationData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__applicationData</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_externalLinks</span> <span class="o">=</span> <span class="p">[]</span>        <span class="c1"># Keep track of links to external files.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadedCovariances</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># If loadCovariances called, store results here.</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>
        <span class="k">for</span> <span class="n">orphanProduct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">orphanProduct</span>
        <span class="k">for</span> <span class="n">_sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSectionSums</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">_sum</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incompleteReactions</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;See method toString.&quot;&quot;&quot;</span>

        <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span> <span class="p">)</span> <span class="o">+</span> <span class="p">(</span> <span class="s1">&#39; (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>  <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span> <span class="p">)</span>
        
        <span class="k">return</span><span class="p">(</span> <span class="n">string</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">compound_nucleus</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the compound nucleus id corresponding to this reaction.</span>

<span class="sd">        Note, we don&#39;t check to see if the compound nucleus is a valid concept, so</span>
<span class="sd">        this will fail on electro-atomic, photo-atomic and natural element target data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ZAproj</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">ZAtarg</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">Zcompound</span><span class="p">,</span> <span class="n">Acompound</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span> <span class="n">ZAproj</span> <span class="o">+</span> <span class="n">ZAtarg</span><span class="p">,</span> <span class="mi">1000</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">idFromZAndA</span><span class="p">(</span><span class="n">Zcompound</span><span class="p">,</span> <span class="n">Acompound</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">projectile</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self&#39;s projectile.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__projectile</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self&#39;s target.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__target</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">projectileFrame</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__projectileFrame</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">evaluation</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self&#39;s evaluation.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__evaluation</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">interaction</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self&#39;s interaction.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__interaction</span> <span class="p">)</span>

    <span class="nd">@interaction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">interaction</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">nuclear</span>
            <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Need to specify interaction when calling reactionSuite.__init__. Setting it to &quot;</span><span class="si">%s</span><span class="s1">&quot;. Please update your code as in the future this will execute a raise.&#39;</span> <span class="o">%</span> <span class="n">value</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__interaction</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">checkEnumOrString</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guessedInteraction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Returns the guessedInteraction value. This is for pre GNDS 2.0 use only and should not be used with GNDS 2.0 or higher</span>
<span class="sd">        (i.e., it should always be False for GNDS 2.0 or higher.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__guessedInteraction</span>

    <span class="nd">@guessedInteraction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">guessedInteraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Set self&#39;s guessedInteraction member. This is for pre GNDS 2.0 use only and should not be used with GNDS 2.0 or higher.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__guessedInteraction</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sourcePath</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the sourcePath member which is the path to the reactionSuite file for self if self is from a file.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcePath</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">externalFiles</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the externalFiles instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__externalFiles</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">styles</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the PoPs instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">PoPs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the PoPs instance.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resonances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__resonances</span>

    <span class="nd">@resonances</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">resonances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resonances</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set resonances to the specified resonances instance.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resonances</span><span class="p">,</span> <span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Must be Resonances instance, not &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">resonances</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__resonances</span> <span class="o">=</span> <span class="n">resonances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__resonances</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reactions</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the reactions instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orphanProducts</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the orphanProducts instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sums</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the sums instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">productions</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the productions instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">incompleteReactions</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the incompleteReactions instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fissionComponents</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the fissionComponents instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">applicationData</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the applicationData instance.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__applicationData</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">domainMin</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">domainMin</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">domainMax</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">domainUnit</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">domainUnit</span> <span class="p">)</span>

<div class="viewcode-block" id="ReactionSuite.isThermalNeutronScatteringLaw"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.isThermalNeutronScatteringLaw">[docs]</a>    <span class="k">def</span> <span class="nf">isThermalNeutronScatteringLaw</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">reaction</span><span class="o">.</span><span class="n">isThermalNeutronScatteringLaw</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span><span class="p">(</span> <span class="kc">True</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="kc">False</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.photonBranchingData"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.photonBranchingData">[docs]</a>    <span class="k">def</span> <span class="nf">photonBranchingData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For each isotope in *self.PoPs*, calls decaysMiscPoPsModule.photonBranchingData.</span>

<span class="sd">        :return:        Dictionary with keys being each isotope in *self.PoPs* and their values being that returned by </span>
<span class="sd">                            decaysMiscPoPsModule.photonBranchingData.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">branchingData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chemicalElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">chemicalElements</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">chemicalElement</span><span class="p">:</span>
                <span class="n">branchingData</span><span class="p">[</span><span class="n">isotope</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">decaysMiscPoPsModule</span><span class="o">.</span><span class="n">photonBranchingData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">,</span> <span class="n">isotope</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">branchingData</span></div>

<div class="viewcode-block" id="ReactionSuite.convertUnits"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.convertUnits">[docs]</a>    <span class="k">def</span> <span class="nf">convertUnits</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">unitMap</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively searches for units within all sections, converting units that appear in the unitMap.</span>
<span class="sd">        unitMap is a dictionary with old/new unit pairs where the old unit is the key (e.g., { &#39;eV&#39; : &#39;MeV&#39;, &#39;b&#39; : &#39;mb&#39; }).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.fixDomains"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.fixDomains">[docs]</a>    <span class="k">def</span> <span class="nf">fixDomains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energyMax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each reaction type and summed data, makes all projectile energy domains be consistent. This only modifies *evaluated* data and</span>
<span class="sd">        not any *processed* data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">numberOfFixes</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">fixDomains</span><span class="p">(</span><span class="n">energyMax</span><span class="p">)</span>
        <span class="n">numberOfFixes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">fixDomains</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">energyMax</span><span class="p">)</span>               <span class="c1"># The energyMin value is ignored by all &quot;reaction&quot; exclusive suites.</span>
        <span class="n">numberOfFixes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="o">.</span><span class="n">fixDomains</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">energyMax</span><span class="p">)</span>
        <span class="n">numberOfFixes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="o">.</span><span class="n">fixDomains</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">energyMax</span><span class="p">)</span>
        <span class="n">numberOfFixes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="o">.</span><span class="n">fixDomains</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">energyMax</span><span class="p">)</span>
        <span class="n">numberOfFixes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incompleteReactions</span><span class="o">.</span><span class="n">fixDomains</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">energyMax</span><span class="p">)</span>
        <span class="n">numberOfFixes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">fixDomains</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">energyMax</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">numberOfFixes</span></div>

<div class="viewcode-block" id="ReactionSuite.check"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check all data in the reactionSuite, returning a gnds.warning.context object with list of warnings.</span>

<span class="sd">        Currently supported options::</span>

<span class="sd">            &#39;branchingRatioSumTolerance&#39; 1e-6        # branching ratios must sum to 1 (within this tolerance)</span>
<span class="sd">            &#39;dQ&#39;                         &#39;1e-3 MeV&#39;  # tolerance for comparing tabulated / calculated Q values</span>
<span class="sd">            &#39;dThreshold&#39;                 &#39;1e-3 MeV&#39;</span>
<span class="sd">            &#39;crossSectionEnergyMax&#39;      &#39;20 MeV&#39;    # warn if cross section ends before this energy</span>
<span class="sd">            &#39;crossSectionOnly&#39;:          False</span>
<span class="sd">            &#39;crossSectionMaxDiff&#39;:       1e-3        # for comparing crossSectionSum to summands</span>
<span class="sd">            &#39;multiplicityMaxDiff&#39;:       1e-3        # for comparing multiplicitySum to summands</span>
<span class="sd">            &#39;transportables&#39;             (&#39;n&#39;,)      # distribution required for these products</span>
<span class="sd">            &#39;normTolerance&#39;:             1e-5        # for checking distribution normalization</span>
<span class="sd">            &#39;checkEnergyBalance&#39;         True</span>
<span class="sd">            &#39;reconstructResonances&#39;      True</span>
<span class="sd">            &#39;dEnergyBalanceRelative&#39;     1e-3</span>
<span class="sd">            &#39;dEnergyBalanceAbsolute&#39;     &#39;1 eV&#39;</span>
<span class="sd">            &#39;fissionEnergyBalanceLimit&#39;  0.15        # at least 85% of available energy should go to fission products</span>
<span class="sd">            &#39;failOnException&#39;            False       # if True, crash instead of converting exceptions to warnings</span>
<span class="sd">            &#39;cleanUpTempFiles&#39;           True        # remove derived data that was produced during checking</span>

<span class="sd">        Currently unused options::</span>

<span class="sd">            &#39;checkForEnDepData&#39;         False</span>
<span class="sd">            &#39;allowZeroE&#39;                False</span>
<span class="sd">            &#39;xCloseEps&#39;                 None</span>
<span class="sd">            &#39;maxAbsFloatValue&#39;          None</span>
<span class="sd">            &#39;checkEMin&#39;                 True</span>
<span class="sd">            &#39;checkMissing&#39;              True</span>
<span class="sd">            &#39;maxGammaMultiplicity&#39;      100.</span>
<span class="sd">          &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">fudge</span> <span class="kn">import</span> <span class="n">warning</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;branchingRatioSumTolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s1">&#39;dQ&#39;</span><span class="p">:</span> <span class="s1">&#39;1e-3 MeV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dThreshold&#39;</span><span class="p">:</span> <span class="s1">&#39;1e-3 MeV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionEnergyMin&#39;</span><span class="p">:</span> <span class="s1">&#39;1e-5 eV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionEnergyMax&#39;</span><span class="p">:</span> <span class="s1">&#39;20 MeV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionOnly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionMaxDiff&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s1">&#39;multiplicityMaxDiff&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s1">&#39;transportables&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;normTolerance&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
                <span class="s1">&#39;checkEnergyBalance&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;reconstructResonances&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;dEnergyBalanceRelative&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s1">&#39;dEnergyBalanceAbsolute&#39;</span><span class="p">:</span> <span class="s1">&#39;1 eV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fissionEnergyBalanceLimit&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
                <span class="s1">&#39;failOnException&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;cleanUpTempFiles&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="c1"># currently unused options:</span>
                <span class="s1">&#39;checkForEnDepData&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;allowZeroE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;xCloseEps&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;maxAbsFloatValue&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;checkEMin&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;checkMissing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;maxGammaMultiplicity&#39;</span><span class="p">:</span> <span class="mf">100.</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;check() received unknown keyword argument &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">PoPsModule</span><span class="o">.</span><span class="n">unorthodoxModule</span><span class="o">.</span><span class="n">Particle</span> <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">UnorthodoxParticleNotImplemented</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;ReactionSuite: </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">warnings</span><span class="p">)</span>

        <span class="n">evaluatedStyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getEvaluatedStyle</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">evaluatedStyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">NotImplemented</span><span class="p">(</span> <span class="s2">&quot;Checking currently only supported for &#39;evaluated&#39; style&quot;</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">warning</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s1">&#39;ReactionSuite: </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">warnings</span><span class="p">)</span>

        <span class="c1"># assemble some useful info, to be handed down to children&#39;s check() functions:</span>
        <span class="n">incidentEnergyUnit</span> <span class="o">=</span> <span class="s1">&#39;eV&#39;</span>
        <span class="n">massUnit</span> <span class="o">=</span> <span class="s1">&#39;eV/c**2&#39;</span>
        <span class="n">projectile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span>
        <span class="n">projectileZ</span><span class="p">,</span> <span class="n">projectileA</span><span class="p">,</span> <span class="n">projectileZA</span><span class="p">,</span> <span class="n">projectileLevelIndex</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZAInfo</span><span class="p">(</span> <span class="n">projectile</span> <span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="n">target</span><span class="o">.</span><span class="n">pid</span> <span class="p">]</span>
        <span class="n">targetZ</span><span class="p">,</span> <span class="n">targetA</span><span class="p">,</span> <span class="n">targetZA</span><span class="p">,</span> <span class="n">targetLevelIndex</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZAInfo</span><span class="p">(</span> <span class="n">target</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">targetA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">compoundZA</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">projectileZ</span> <span class="o">+</span> <span class="n">targetZ</span><span class="p">)</span> <span class="c1"># elemental target</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compoundZA</span> <span class="o">=</span> <span class="n">targetZA</span> <span class="o">+</span> <span class="n">projectileZA</span>
        <span class="n">CoulombChannel</span> <span class="o">=</span> <span class="p">(</span> <span class="n">targetZ</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">projectileZ</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="n">elementalTarget</span> <span class="o">=</span> <span class="p">(</span><span class="n">targetA</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elementalTarget</span><span class="p">:</span>
            <span class="n">projectileMass_amu</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="s1">&#39;amu&#39;</span> <span class="p">)</span>
            <span class="n">targetMass_amu</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="s1">&#39;amu&#39;</span> <span class="p">)</span>
            <span class="n">kinematicFactor</span> <span class="o">=</span> <span class="p">(</span> <span class="n">targetMass_amu</span> <span class="o">+</span> <span class="n">projectileMass_amu</span> <span class="p">)</span> <span class="o">/</span> <span class="n">targetMass_amu</span>    <span class="c1"># (M+m)/M</span>

            <span class="n">projectileMass</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">massUnit</span> <span class="p">)</span>
            <span class="n">targetMass</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">massUnit</span> <span class="p">)</span>
            <span class="n">availableEnergy_eV</span> <span class="o">=</span> <span class="n">projectileMass</span> <span class="o">+</span> <span class="n">targetMass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For elemental targets, calculating these factors doesn&#39;t make sense since there is no defined target mass</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">ElementalTarget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">kinematicFactor</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="n">availableEnergy_eV</span><span class="o">=</span><span class="kc">None</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;kinematicFactor&#39;</span><span class="p">:</span> <span class="n">kinematicFactor</span><span class="p">,</span> <span class="s1">&#39;compoundZA&#39;</span><span class="p">:</span> <span class="n">compoundZA</span><span class="p">,</span>
                <span class="s1">&#39;availableEnergy_eV&#39;</span><span class="p">:</span> <span class="n">availableEnergy_eV</span><span class="p">,</span> <span class="s1">&#39;CoulombChannel&#39;</span><span class="p">:</span> <span class="n">CoulombChannel</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="n">evaluatedStyle</span><span class="p">,</span>
                <span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;elementalTarget&#39;</span><span class="p">:</span> <span class="n">elementalTarget</span> <span class="p">}</span>
        <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">options</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">elementalTarget</span><span class="p">:</span>
            <span class="c1"># For elemental targets, calculating energy balance isn&#39;t possible</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;checkEnergyBalance&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>

        <span class="n">externalFileWarnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">externalFile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="p">:</span>
            <span class="n">fullPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcePath</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">externalFile</span><span class="o">.</span><span class="n">path</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullPath</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warning</span><span class="o">.</span><span class="n">MissingExternalFile</span><span class="p">(</span><span class="n">externalFile</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">externalFile</span><span class="o">.</span><span class="n">checksum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">algorithm</span> <span class="o">=</span> <span class="n">externalFile</span><span class="o">.</span><span class="n">algorithm</span>
                <span class="n">checksum</span> <span class="o">=</span> <span class="n">checksumsModule</span><span class="o">.</span><span class="n">checkers</span><span class="p">[</span><span class="n">algorithm</span><span class="p">]</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">checksum</span> <span class="o">!=</span> <span class="n">externalFile</span><span class="o">.</span><span class="n">checksum</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">warning</span><span class="o">.</span><span class="n">WrongExternalFileChecksum</span><span class="p">(</span><span class="n">externalFile</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                          <span class="n">externalFile</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span>
                                                          <span class="n">checksum</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">externalFileWarnings</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s1">&#39;externalFiles&#39;</span><span class="p">,</span> <span class="n">externalFileWarnings</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resonanceWarnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">check</span><span class="p">(</span> <span class="n">info</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">resonanceWarnings</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s1">&#39;resonances&#39;</span><span class="p">,</span> <span class="n">resonanceWarnings</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;reconstructResonances&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">reconstructCrossSection</span> <span class="p">):</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getTempStyleNameOfClass</span><span class="p">(</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">CrossSectionReconstructed</span> <span class="p">)</span>
                <span class="c1"># convert resonance parameters to pointwise data, interpolable to .1 percent:</span>
                <span class="n">reconstructedStyle</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">CrossSectionReconstructed</span><span class="p">(</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">],</span> <span class="n">derivedFrom</span><span class="o">=</span><span class="n">evaluatedStyle</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstructResonances</span><span class="p">(</span> <span class="n">reconstructedStyle</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">ExceptionRaised</span><span class="p">(</span> <span class="s2">&quot;when reconstructing resonances: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;failOnException&#39;</span><span class="p">]:</span> <span class="k">raise</span>

        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;checkEnergyBalance&#39;</span><span class="p">]:</span>
            <span class="c1"># setup options for calculating average product energy and momentum</span>
            <span class="n">averageProductDataStyle</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">AverageProductData</span><span class="p">(</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getTempStyleNameOfClass</span><span class="p">(</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">AverageProductData</span> <span class="p">),</span>
                    <span class="n">derivedFrom</span><span class="o">=</span><span class="n">evaluatedStyle</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">averageProductDataStyle</span> <span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;averageProductDataStyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">averageProductDataStyle</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;averageProductDataArgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>   <span class="c1"># additional required arguments</span>
                        <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">:</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="s1">&#39;energyAccuracy&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;momentumAccuracy&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
                        <span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">:</span> <span class="n">incidentEnergyUnit</span><span class="p">,</span> <span class="s1">&#39;massUnit&#39;</span><span class="p">:</span> <span class="n">massUnit</span><span class="p">,</span>
                        <span class="s1">&#39;momentumUnit&#39;</span><span class="p">:</span> <span class="n">incidentEnergyUnit</span> <span class="o">+</span> <span class="s1">&#39;/c&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;projectileMass&#39;</span><span class="p">:</span> <span class="n">projectileMass</span><span class="p">,</span> <span class="s1">&#39;targetMass&#39;</span><span class="p">:</span> <span class="n">targetMass</span><span class="p">,</span>
                        <span class="s1">&#39;reactionSuite&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;photonBranchingData&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">photonBranchingData</span><span class="p">(),</span>
                        <span class="s1">&#39;isInfiniteTargetMass&#39;</span> <span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">ChemicalElement</span> <span class="p">)</span> <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
            <span class="c1"># test Wick&#39;s limit: 0-degree elastic xsc &gt;= ( total xsc * k/4pi )^2</span>
            <span class="n">elastic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s1">&#39;elastic&#39;</span><span class="p">)</span>
            <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">TestSkipped</span><span class="p">(</span><span class="s2">&quot;Wick&#39;s limit&quot;</span><span class="p">,</span> <span class="s2">&quot;can&#39;t find reaction &#39;total&#39;&quot;</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span> <span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">elastic</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span> <span class="p">:</span>
                        <span class="n">elastic_xsc</span> <span class="o">=</span> <span class="n">elastic</span><span class="o">.</span><span class="n">crossSection</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]]</span>
                        <span class="n">total_xsc</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">crossSection</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">elastic_xsc</span> <span class="o">=</span> <span class="n">elastic</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span><span class="n">lowerEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="n">upperEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
                        <span class="n">total_xsc</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span><span class="n">lowerEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="n">upperEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
                    <span class="n">elastic_distribution</span> <span class="o">=</span> <span class="n">elastic</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">getProductWithName</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="n">evaluatedStyle</span><span class="o">.</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">angularSubform</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">elastic_distribution</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span> <span class="p">):</span>
                        <span class="n">linearized</span> <span class="o">=</span> <span class="n">elastic_distribution</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">()</span>
                        <span class="n">forward_scattering</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">axes</span><span class="o">=</span><span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">()</span> <span class="p">)</span>
                        <span class="k">for</span> <span class="n">energy_in</span> <span class="ow">in</span> <span class="n">linearized</span><span class="o">.</span><span class="n">getEnergyArray</span><span class="p">():</span>
                            <span class="n">forward_scattering</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">energy_in</span><span class="p">,</span> <span class="n">linearized</span><span class="o">.</span><span class="n">interpolateAtValue</span><span class="p">(</span> <span class="n">energy_in</span> <span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">elastic_distribution</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Regions2d</span> <span class="p">):</span>
                        <span class="n">forward_scattering</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">Regions1d</span><span class="p">(</span> <span class="n">axes</span><span class="o">=</span><span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">()</span> <span class="p">)</span>
                        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">elastic_distribution</span><span class="p">:</span>
                            <span class="n">ptw</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="p">[]</span> <span class="p">)</span>
                            <span class="n">linearized</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">energy_in</span> <span class="ow">in</span> <span class="n">linearized</span><span class="o">.</span><span class="n">getEnergyArray</span><span class="p">():</span>
                                <span class="n">ptw</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">energy_in</span><span class="p">,</span> <span class="n">linearized</span><span class="o">.</span><span class="n">interpolateAtValue</span><span class="p">(</span> <span class="n">energy_in</span> <span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">)</span>
                            <span class="n">forward_scattering</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ptw</span> <span class="p">)</span>
                        <span class="n">forward_scattering</span> <span class="o">=</span> <span class="n">forward_scattering</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span>
                                <span class="n">lowerEps</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="mf">1e-8</span> <span class="p">)</span>

                    <span class="n">mutualDomain</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="o">*</span><span class="p">[</span><span class="n">dat</span><span class="o">.</span><span class="n">domain</span><span class="p">()</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="p">(</span><span class="n">elastic_xsc</span><span class="p">,</span> <span class="n">total_xsc</span><span class="p">,</span> <span class="n">forward_scattering</span><span class="p">)])</span> <span class="p">)</span>
                    <span class="n">mutualDomain</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">mutualDomain</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="n">mutualDomain</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">egrid</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">forward_scattering</span><span class="o">.</span><span class="n">domainGrid</span> <span class="k">if</span> <span class="n">mutualDomain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">e</span> <span class="o">&lt;=</span> <span class="n">mutualDomain</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

                    <span class="c1"># get probability at mu=1.0:</span>
                    <span class="n">forward_scattering</span> <span class="o">=</span> <span class="p">[</span><span class="n">forward_scattering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">]</span>
                    <span class="n">elastic_xsc</span> <span class="o">=</span> <span class="p">[</span><span class="n">elastic_xsc</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">]</span>
                    <span class="n">total_xsc</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_xsc</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">]</span>

                    <span class="n">wlcons</span> <span class="o">=</span> <span class="mf">3.05607e-8</span> <span class="o">*</span> <span class="n">kinematicFactor</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># ( sqrt(2 * neutronMass) / (4 * pi * hbar) * (M+m)/M )^2 in 1/(eV*b)</span>
                    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">forward_scattering</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">elastic_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">wlcons</span> <span class="o">*</span> <span class="n">egrid</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                            <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">forward_scattering</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">elastic_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">wlcons</span> <span class="o">*</span> <span class="n">egrid</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">WicksLimitError</span><span class="p">(</span> <span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">,</span> <span class="n">egrid</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">ExceptionRaised</span><span class="p">(</span> <span class="s2">&quot;when checking Wick&#39;s limit: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;failOnException&#39;</span><span class="p">]:</span> <span class="k">raise</span>

        <span class="n">particleWarnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">check</span><span class="p">(</span> <span class="o">**</span><span class="n">info</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">particleWarnings</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s1">&#39;PoPs&#39;</span><span class="p">,</span> <span class="n">particleWarnings</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;isInfiniteTargetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">ChemicalElement</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="n">reactionWarnings</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">check</span><span class="p">(</span> <span class="n">info</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">reactionWarnings</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> label </span><span class="si">%s</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">reaction</span><span class="o">.</span><span class="n">label</span><span class="p">),</span> <span class="n">reactionWarnings</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">warning</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s1">&#39;ReactionSuite: </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">warnings</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;cleanUpTempFiles&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">removeStyle</span><span class="p">(</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="ReactionSuite.diff"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.diff">[docs]</a>    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">diffResults1</span> <span class="o">=</span> <span class="n">warningModule</span><span class="o">.</span><span class="n">DiffResults</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">other</span><span class="p">,</span> <span class="n">ReactionSuite</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Other not a reactionSuite instance.&#39;</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">domainUnit</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;Energy units not the same.&#39;</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="p">(</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">Evaluated</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">CrossSectionReconstructed</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;Style &quot;</span><span class="si">%s</span><span class="s1">&quot; not allowed when diffing.&#39;</span> <span class="o">%</span> <span class="n">style</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">styles</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="p">(</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">Evaluated</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">CrossSectionReconstructed</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;Style &quot;</span><span class="si">%s</span><span class="s1">&quot; not allowed when diffing.&#39;</span> <span class="o">%</span> <span class="n">style</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span> <span class="n">other</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="n">diffResults1</span> <span class="p">)</span>

        <span class="k">return</span><span class="p">(</span> <span class="n">diffResults1</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.elasticReactionLabel"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.elasticReactionLabel">[docs]</a>    <span class="k">def</span> <span class="nf">elasticReactionLabel</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the label for the elastic channel. When constructing the label, if target is an alias, use the alias&#39; pid; otherwise, use the target id.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetID</span><span class="p">(</span> <span class="n">protareID</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.targetID"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.targetID">[docs]</a>    <span class="k">def</span> <span class="nf">targetID</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">protareID</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ID for the target. If the target is a nuclear meta-stable, then the target ID as listed by the &#39;target&#39; attribute for the</span>
<span class="sd">        reactionSuite (i.e., protare) will be the meta-stable&#39;s ID while everywhere else it will be the nuclide excitation ID. Otherwise,</span>
<span class="sd">        the target ID as listed by the &#39;target&#39; attribute for the reactionSuite is the same as it is everywhere else. For example, for the</span>
<span class="sd">        protare &#39;n + Am242&#39;, the target will be listed as &#39;Am242&#39; everywhere, while for the protare &#39;n + Am242_m1&#39;, the target will be listed</span>
<span class="sd">        as &#39;Am242_m1&#39; by the &#39;target&#39; attribute for the reactionSuite and &#39;Am242_e2&#39; everywhere else. Note, for the protare &#39;n + Am242_m1&#39;</span>
<span class="sd">        the PoPs.aliases instance must have the alias &#39;Am242_m1&#39; for &#39;Am242_e2&#39;. If protareID is True, the target ID as listed by the &#39;target&#39;</span>
<span class="sd">        attribute for the reactionSuite will be returned, otherwise, the target ID list everywhere else will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">protareID</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">final</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="p">)</span><span class="o">.</span><span class="n">id</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.findEntity"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.findEntity">[docs]</a>    <span class="k">def</span> <span class="nf">findEntity</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="p">,</span> <span class="n">attribute</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overrides ancestry.findEntity. reactionSuite contains several different lists,</span>
<span class="sd">        so may need to descend into those to find desired entity.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">entityName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;reaction&#39;</span><span class="p">,</span><span class="s1">&#39;summedReaction&#39;</span><span class="p">,</span><span class="s1">&#39;fissionComponent&#39;</span><span class="p">,</span><span class="s1">&#39;production&#39;</span><span class="p">,</span><span class="s1">&#39;reactionSum&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="o">+</span><span class="s1">&#39;s&#39;</span> <span class="p">):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">entity</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">entity</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">Ancestry</span><span class="o">.</span><span class="n">findEntity</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.findLinks"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.findLinks">[docs]</a>    <span class="k">def</span> <span class="nf">findLinks</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ancestryMember</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestryMembers</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ancestryMember</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ancestryMember</span> <span class="p">)</span>
                <span class="k">if</span><span class="p">(</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="s1">&#39;findLinks&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span> <span class="s1">&#39;findLinks&#39;</span> <span class="p">)(</span> <span class="n">links</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">links</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.fixLinks"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.fixLinks">[docs]</a>    <span class="k">def</span> <span class="nf">fixLinks</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">ENDFconversions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span><span class="p">(</span> <span class="s1">&#39;LLNL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationData</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">ENDFconversions</span> <span class="o">=</span> <span class="p">[</span> <span class="n">LLNL_data</span> <span class="k">for</span> <span class="n">LLNL_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationData</span><span class="p">[</span><span class="s1">&#39;LLNL&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">LLNL_data</span><span class="p">,</span> <span class="n">ENDFconversionFlagsModule</span><span class="o">.</span><span class="n">ENDFconversionFlags</span> <span class="p">)</span> <span class="p">]</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">ENDFconversions</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Too many ENDFconversionFlags in applicationData[&quot;LLNL&quot;] section.&#39;</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">ENDFconversions</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span> <span class="n">ENDFconversions</span> <span class="o">=</span> <span class="n">ENDFconversions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findLinks</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">xlink</span> <span class="ow">in</span> <span class="n">links</span> <span class="p">:</span>
            <span class="n">link2</span> <span class="o">=</span> <span class="n">link</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">xlink</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span> <span class="p">)</span> <span class="p">:</span>                     <span class="c1"># Cannot look for relative xlink as it is relative to link which is not known.</span>
                <span class="k">try</span> <span class="p">:</span>
                    <span class="n">link2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">followXPath</span><span class="p">(</span> <span class="n">instance</span><span class="o">.</span><span class="n">path</span> <span class="p">)</span>
                <span class="k">except</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">XPathNotFound</span> <span class="p">:</span>
                    <span class="n">link2</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">except</span> <span class="p">:</span>
                    <span class="k">raise</span>

            <span class="k">if</span><span class="p">(</span> <span class="n">link2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">instance</span><span class="p">,</span> <span class="n">ENDFconversionFlagsModule</span><span class="o">.</span><span class="n">Conversion</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">ENDFconversions</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="n">ENDFconversions</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">instance</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">instance</span><span class="p">,</span> <span class="n">sumsModule</span><span class="o">.</span><span class="n">Add</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">summands</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">ancestor</span>
                    <span class="n">summands</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="n">summands</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">instance</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">link2</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">instance</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">link2</span></div>

<div class="viewcode-block" id="ReactionSuite.hasParticle"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.hasParticle">[docs]</a>    <span class="k">def</span> <span class="nf">hasParticle</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.heatCrossSections"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.heatCrossSections">[docs]</a>    <span class="k">def</span> <span class="nf">heatCrossSections</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">doNotThin</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">EMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainMin</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span>
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">orphanProduct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span>
            <span class="n">orphanProduct</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span>
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">production</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">:</span>
            <span class="n">production</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span>
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">_sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSectionSums</span> <span class="p">:</span>
            <span class="n">_sum</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span>
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">fissionComponent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="p">:</span>
            <span class="n">fissionComponent</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span>
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.getParticle"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.getParticle">[docs]</a>    <span class="k">def</span> <span class="nf">getParticle</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.getMassRatio"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.getMassRatio">[docs]</a>    <span class="k">def</span> <span class="nf">getMassRatio</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__massRatio&#39;</span> <span class="p">):</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__massRatio</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">m</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__massRatio</span></div>

<span class="c1"># BRB6 This does not belong here.</span>
<div class="viewcode-block" id="ReactionSuite.getIsotopeName"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.getIsotopeName">[docs]</a>    <span class="k">def</span> <span class="nf">getIsotopeName</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return name of compound nucleus formed by nuc1+nuc2+...</span>
<span class="sd">        if a nucleus in &#39;args&#39; starts with &#39;-&#39;, subtract instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="c1"># CALEB: This logic need to use PoPs stuff.</span>
        <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="c1"># FIXME remove &#39;_natural&#39;? Now using &#39;Os0&#39; instead to indicate elemental target</span>
            <span class="k">if</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span>
            <span class="n">sign</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([-]?)([0-9]+)?([a-zA-Z]+)(_natural|[0-9]*)&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mult</span><span class="p">:</span> <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">symbol</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">A</span><span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">!=</span><span class="s1">&#39;_natural&#39;</span><span class="p">:</span> <span class="n">A</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZFromSymbol</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span> <span class="n">sign</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span> <span class="p">),</span> <span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="n">mult</span> <span class="p">)</span>

        <span class="n">retZ</span><span class="p">,</span> <span class="n">retA</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nucleus</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;photon&#39;</span> <span class="ow">in</span> <span class="n">nucleus</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">sign</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">nucleus</span><span class="p">)</span>
                <span class="n">retZ</span> <span class="o">+=</span> <span class="n">sign</span><span class="o">*</span><span class="n">mult</span><span class="o">*</span><span class="n">Z</span>
                <span class="k">if</span> <span class="n">retA</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">retA</span> <span class="o">=</span> <span class="n">A</span>
                <span class="k">elif</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">retA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">retA</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">retA</span> <span class="o">+=</span> <span class="n">sign</span><span class="o">*</span><span class="n">mult</span><span class="o">*</span><span class="n">A</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">symbolFromZ</span><span class="p">[</span><span class="n">retZ</span><span class="p">],</span> <span class="n">retA</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;      WARNING: couldn&#39;t extract isotope name from product list!&quot;</span><span class="p">)</span></div>

<span class="c1"># BRB6 many hardwired in this method.</span>
<div class="viewcode-block" id="ReactionSuite.getReaction"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.getReaction">[docs]</a>    <span class="k">def</span> <span class="nf">getReaction</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">channel</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search list of reactions for a specified channel.</span>
<span class="sd">        The &#39;channel&#39; argument should be either a reaction type (&#39;elastic&#39;,&#39;capture&#39;,&#39;fission&#39;, etc) or</span>
<span class="sd">        the list of outgoing particles (&#39;n + Pu239&#39; for example).</span>

<span class="sd">        If &#39;channel&#39; is an int, then we assume it&#39;s an ENDF MT</span>

<span class="sd">        Returns None if no matching reaction is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s1">&#39;capture&#39;</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="mi">102</span>

        <span class="c1"># If channel is an int, it might be an ENDF MT, so check those first</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span> <span class="c1"># must be an ENDF MT</span>
            <span class="k">for</span> <span class="n">reactionList</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSectionSums</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">reactionList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">reaction</span><span class="o">.</span><span class="n">ENDF_MT</span> <span class="o">==</span> <span class="n">channel</span><span class="p">:</span> <span class="k">return</span> <span class="n">reaction</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># translate special channel names:</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">channel_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elasticReactionLabel</span><span class="p">(</span> <span class="p">)</span>

            <span class="c1"># FIXME we&#39;re not dealing with metastables or other aliases very well right now, need to rework this.</span>
            <span class="c1"># special treatment to check for elastic reactions with labels like &#39;n + Am242_m1&#39; (instead of Am242_e2):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
                <span class="n">metastableElastic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">metastableElastic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
                    <span class="n">channel</span> <span class="o">=</span> <span class="n">channel_tr</span> <span class="o">=</span> <span class="n">metastableElastic</span>

        <span class="k">elif</span> <span class="n">channel</span><span class="o">==</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="n">channel_tr</span><span class="o">=</span><span class="s1">&#39;z,gamma&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">channel_tr</span> <span class="o">=</span> <span class="n">channel</span>

        <span class="c1"># check if &#39;channel&#39; == one of the fudge reactions:</span>
        <span class="n">chStrings</span><span class="p">,</span> <span class="n">reacs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="o">==</span> <span class="n">channel</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span>
            <span class="n">chStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">reacs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span>

        <span class="c1"># make list containing a set() of products for each reaction.</span>
        <span class="n">chStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chStrings</span><span class="p">]</span>
        <span class="n">chSets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chStrings</span><span class="p">]</span>
        <span class="n">chSetsNoPhoton</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chSets</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chSetsNoPhoton</span><span class="p">:</span> <span class="n">tmp</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s1">&#39;photon&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="n">chSets</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSets</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="n">chSetsNoPhoton</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSetsNoPhoton</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;fission&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">channel_fiss</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">matchlist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="n">a</span> <span class="ow">in</span> <span class="n">channel_fiss</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">channel_fiss</span> <span class="o">==</span> <span class="s1">&#39;fission&#39;</span> <span class="ow">or</span> <span class="s1">&#39;total&#39;</span> <span class="ow">in</span> <span class="n">channel_fiss</span><span class="p">:</span>
                <span class="n">fissionGenre</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">FissionGenre</span><span class="o">.</span><span class="n">total</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;1st&#39;</span><span class="p">):</span>
                <span class="n">fissionGenre</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">FissionGenre</span><span class="o">.</span><span class="n">firstChance</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="s1">&#39;2nd&#39;</span><span class="p">):</span>
                <span class="n">fissionGenre</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">FissionGenre</span><span class="o">.</span><span class="n">secondChance</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">,</span> <span class="s1">&#39;3rd&#39;</span><span class="p">):</span>
                <span class="n">fissionGenre</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">FissionGenre</span><span class="o">.</span><span class="n">thirdChance</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;fourth&#39;</span><span class="p">,</span> <span class="s1">&#39;4th&#39;</span><span class="p">):</span>
                <span class="n">fissionGenre</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">FissionGenre</span><span class="o">.</span><span class="n">fourthChance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot determine fission genre from &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="n">channel_fiss</span><span class="p">)</span>
                <span class="n">fissionGenre</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">FissionGenre</span><span class="o">.</span><span class="n">none</span>
            <span class="n">retVal</span>  <span class="o">=</span> <span class="p">[</span><span class="n">r1</span> <span class="k">for</span> <span class="n">r1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span>         <span class="k">if</span> <span class="n">r1</span><span class="o">.</span><span class="n">fissionGenre</span> <span class="o">==</span> <span class="n">fissionGenre</span><span class="p">]</span>
            <span class="n">retVal</span> <span class="o">+=</span> <span class="p">[</span><span class="n">r1</span> <span class="k">for</span> <span class="n">r1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="k">if</span> <span class="n">r1</span><span class="o">.</span><span class="n">fissionGenre</span> <span class="o">==</span> <span class="n">fissionGenre</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">retVal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">retVal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check if channel is in form &#39;(z,2na)&#39;, &#39;n,4n&#39; or similar:</span>
            <span class="n">patt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^[(]?[znpdthag],([a-zA-Z0-9]+)[)]?$&#39;</span><span class="p">,</span> <span class="n">channel_tr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">patt</span><span class="p">:</span>
                <span class="n">thisChannelSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;([1-9]?)(gamma|He3|[npagdt]?)[+]?&#39;</span><span class="p">,</span> <span class="n">patt</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">mul</span><span class="p">,</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">prod</span> <span class="p">:</span> <span class="k">continue</span>
                    <span class="n">prod</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;g&#39;</span> <span class="p">:</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="p">,</span> <span class="s1">&#39;gamma&#39;</span> <span class="p">:</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span> <span class="p">:</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span> <span class="p">:</span> <span class="s1">&#39;H1&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;d&#39;</span> <span class="p">:</span> <span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span> <span class="p">:</span> <span class="s1">&#39;H3&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span> <span class="p">:</span> <span class="s1">&#39;He3&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="p">:</span> <span class="s1">&#39;He4&#39;</span> <span class="p">}[</span><span class="n">prod</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">mul</span><span class="p">:</span> <span class="n">prod</span> <span class="o">=</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">prod</span>
                    <span class="k">if</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">thisChannelSet</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Please specify multiplicity explicitly (&#39;z,2n&#39; instead of &#39;z,nn&#39;)&quot;</span><span class="p">)</span>
                    <span class="n">thisChannelSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">thisChannelSet</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="c1"># also add residual to the set:</span>
                <span class="n">proj</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
                <span class="n">thisChannelSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIsotopeName</span><span class="p">(</span> <span class="o">*</span><span class="p">([</span><span class="n">proj</span><span class="p">,</span> <span class="n">target</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">thisChannelSet</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">thisChannelSet</span> <span class="ow">in</span> <span class="n">chSets</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSets</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">thisChannelSet</span> <span class="p">)</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">thisChannelSet</span> <span class="ow">in</span> <span class="n">chSetsNoPhoton</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSetsNoPhoton</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">thisChannelSet</span> <span class="p">)</span> <span class="p">]</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ReactionSuite.calculateAverageProductData"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.calculateAverageProductData">[docs]</a>    <span class="k">def</span> <span class="nf">calculateAverageProductData</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">additionalReactions</span> <span class="o">=</span> <span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate average energy and momentum data for all products of all reactions.</span>
<span class="sd">        Resulting data are stored within each product. Example usage is:</span>

<span class="sd">        from fudge import reactionSuite as reactionSuiteModule</span>
<span class="sd">        from fudge import styles as stylesSuiteModule</span>
<span class="sd">        reactionSuite = reactionSuiteModule.ReactionSuite.readXML_file( &quot;16.xml&quot; )</span>

<span class="sd">        style = stylesModule.AverageProductData( label = &#39;productData&#39;, &#39;eval&#39; )</span>
<span class="sd">        reactionSuite.calculateAverageProductData( style )</span>

<span class="sd">        :param style: The style to use.</span>
<span class="sd">        :param indent: string; The amount to indent and verbose output.</span>
<span class="sd">        :param kwargs: string; All other parameters.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">AverageProductData</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;Invalid style&#39;</span> <span class="p">)</span>

        <span class="n">verbosity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;verbosity&#39;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>

        <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementalIndent</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span>

        <span class="n">logFile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;logFile&#39;</span><span class="p">,</span> <span class="n">NullDevice</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logFile</span>

        <span class="n">energyAccuracy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;energyAccuracy&#39;</span><span class="p">,</span> <span class="mf">1e-5</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;energyAccuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energyAccuracy</span>
        <span class="n">momentumAccuracy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;momentumAccuracy&#39;</span><span class="p">,</span> <span class="mf">1e-3</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;momentumAccuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">momentumAccuracy</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;momentumUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c**2&#39;</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;isInfiniteTargetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">ChemicalElement</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;isInfiniteTargetMass&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span> <span class="p">)</span> <span class="p">:</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot; --&gt;&quot;</span><span class="p">)))</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">calculateAverageProductData</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">calculateAverageProductData</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">additionalReactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">calculateAverageProductData</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.buildCrossSectionSum"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.buildCrossSectionSum">[docs]</a>    <span class="k">def</span> <span class="nf">buildCrossSectionSum</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">sumLabel</span><span class="p">,</span> <span class="n">ENDF_MT</span><span class="p">,</span> <span class="n">styleLabel</span><span class="p">,</span> <span class="n">reactionKeys</span><span class="p">,</span> <span class="n">Q</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For the list of indices and/or labels in reactionKeys, calcualate the summed crosstions and create a crossSectionSum</span>
<span class="sd">        for it. If insert is True, the crossSectionSum is added to self&#39;s sums/crossSectionSums node. If N keys match the</span>
<span class="sd">        same reaction in this, that reaction will be added N times.</span>

<span class="sd">        :param sumLabel: Label for the constructed crossSectionSum node</span>
<span class="sd">            :type sumLabel: str</span>
<span class="sd">        :param ENDF_MT: The ENDF MT for the crossSectionSum node</span>
<span class="sd">            :type ENDF_MT: int</span>
<span class="sd">        :param styleLabel: The label for the function1d added to the Q and crossSection nodes</span>
<span class="sd">            :type styleLabel: str</span>
<span class="sd">        :param reactionKeys: All reactions with an index or label matching an item of this list are added to cross section sum.</span>
<span class="sd">            :type reactionKeys: iterator, list or tuple</span>
<span class="sd">        :param Q: The Q value for the cross section sum</span>
<span class="sd">            :type Q: float</span>

<span class="sd">        :return: A crossSectionSum instance representing the requested reaction cross section sums</span>
<span class="sd">        :rtype: crossSectionSum instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">crossSectionSum</span> <span class="o">=</span> <span class="n">sumsModule</span><span class="o">.</span><span class="n">CrossSectionSum</span><span class="p">(</span> <span class="n">sumLabel</span><span class="p">,</span> <span class="n">ENDF_MT</span> <span class="p">)</span>

        <span class="nb">sum</span> <span class="o">=</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">reactionKeys</span> <span class="p">:</span>
            <span class="n">reaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="p">)</span>
            <span class="n">crossSectionSum</span><span class="o">.</span><span class="n">summands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">sumsModule</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">link</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">crossSectionSum</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">styleLabel</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">crossSectionSum</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">QModule</span><span class="o">.</span><span class="n">Constant1d</span><span class="p">(</span> <span class="n">Q</span><span class="p">,</span> <span class="n">domainMin</span> <span class="o">=</span> <span class="nb">sum</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="n">domainMax</span> <span class="o">=</span> <span class="nb">sum</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">QModule</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span> <span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="n">styleLabel</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span><span class="p">(</span> <span class="n">crossSectionSum</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.inputParticlesToReactionString"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.inputParticlesToReactionString">[docs]</a>    <span class="k">def</span> <span class="nf">inputParticlesToReactionString</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2"> + </span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">suffix</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.cullStyles"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.cullStyles">[docs]</a>    <span class="k">def</span> <span class="nf">cullStyles</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">removeDocumentation</span><span class="p">,</span> <span class="n">removeApplicationData</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all forms from each component except for the requested style or, if it is not present</span>
<span class="sd">        its nearest derived from style.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span><span class="p">[</span><span class="n">styleName</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">HeatedMultiGroup</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">styleList</span> <span class="o">=</span> <span class="p">[</span> <span class="n">style</span> <span class="p">]</span>
        <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">GriddedCrossSection</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">styleList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span><span class="p">(</span> <span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">styleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span>
                <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">derivedFromStyle</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;style name &quot;</span><span class="si">%s</span><span class="s1">&quot; is for type &quot;</span><span class="si">%s</span><span class="s1">&quot; which is not supported for culling.&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">style</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span></div>
<span class="c1"># FIXME What about self.resonances</span>

<div class="viewcode-block" id="ReactionSuite.CoulombPlusNuclearMuCutoffs"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.CoulombPlusNuclearMuCutoffs">[docs]</a>    <span class="k">def</span> <span class="nf">CoulombPlusNuclearMuCutoffs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">muCutoffs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">CoulombPlusNuclearElasticMuCutoff</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">muCutoffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">style</span><span class="o">.</span><span class="n">muCutoff</span> <span class="p">)</span>

        <span class="k">return</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">muCutoffs</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.hasFission"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.hasFission">[docs]</a>    <span class="k">def</span> <span class="nf">hasFission</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reaction</span><span class="o">.</span><span class="n">isFission</span><span class="p">():</span> <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ReactionSuite.listOfProducts"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.listOfProducts">[docs]</a>    <span class="k">def</span> <span class="nf">listOfProducts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns, as a set, the list of PoP&#39;s ids for all products (i.e., outgoing particles) for all reactions of *self*.&quot;&quot;&quot;</span>

        <span class="n">products</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span> <span class="n">products</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">listOfProducts</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="p">:</span> <span class="n">products</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">listOfProducts</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="p">:</span> <span class="n">products</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">listOfProducts</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="p">:</span> <span class="n">products</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">listOfProducts</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incompleteReactions</span><span class="p">:</span> <span class="n">products</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">listOfProducts</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">products</span></div>

<div class="viewcode-block" id="ReactionSuite.covarianceExternalFiles"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.covarianceExternalFiles">[docs]</a>    <span class="k">def</span> <span class="nf">covarianceExternalFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a list of all ExternalFile instanaces in *self* that point to covariance files.</span>

<span class="sd">        :return:    The list of ExternalFile instanaces that point to covariance files.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">from</span> <span class="nn">fudge</span> <span class="kn">import</span> <span class="n">GNDS_file</span> <span class="k">as</span> <span class="n">GNDS_fileModule</span>
        <span class="kn">from</span> <span class="nn">fudge.covariances</span> <span class="kn">import</span> <span class="n">covarianceSuite</span> <span class="k">as</span> <span class="n">covarianceSuiteModule</span>

        <span class="n">externalFiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">externalFile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="p">:</span>
            <span class="c1"># TODO submit proposal to include file type attribute in the externalFile GNDS node so we don&#39;t need to run GNDS_fileModule.type</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">externalFile</span><span class="o">.</span><span class="n">realpath</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  WARNING: skipping externalFile &#39;</span><span class="si">%s</span><span class="s2">&#39; which points to non-existing file </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span>
                      <span class="p">(</span><span class="n">externalFile</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">externalFile</span><span class="o">.</span><span class="n">realpath</span><span class="p">()))</span>
                <span class="k">continue</span>
            <span class="n">gndsType</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">GNDS_fileModule</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">externalFile</span><span class="o">.</span><span class="n">realpath</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">gndsType</span> <span class="o">==</span> <span class="n">covarianceSuiteModule</span><span class="o">.</span><span class="n">CovarianceSuite</span><span class="o">.</span><span class="n">moniker</span><span class="p">:</span>
                <span class="n">externalFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">externalFile</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">externalFiles</span></div>

<div class="viewcode-block" id="ReactionSuite.loadCovariances"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.loadCovariances">[docs]</a>    <span class="k">def</span> <span class="nf">loadCovariances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load all external files of type &#39;covarianceSuite&#39;, and resolve links between self and covarianceSuites.</span>

<span class="sd">        :return: list of loaded covarianceSuites</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">fudge.covariances</span> <span class="kn">import</span> <span class="n">covarianceSuite</span> <span class="k">as</span> <span class="n">covarianceSuiteModule</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadedCovariances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadedCovariances</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">covariance</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">covarianceExternalFiles</span><span class="p">():</span>
                <span class="n">covariance</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">covarianceSuiteModule</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">covariance</span><span class="o">.</span><span class="n">realpath</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_loadedCovariances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">covariance</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadedCovariances</span></div>

<div class="viewcode-block" id="ReactionSuite.partialProductionIntegral"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.partialProductionIntegral">[docs]</a>    <span class="k">def</span> <span class="nf">partialProductionIntegral</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">productID</span><span class="p">,</span> <span class="n">energyIn</span><span class="p">,</span> <span class="n">energyOut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">muOut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">phiOut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">lab</span><span class="p">,</span>
                <span class="n">LegendreOrder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">partialProductionIntegralSum</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">partialProductionIntegralSum</span> <span class="o">+=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">partialProductionIntegral</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">productID</span><span class="p">,</span> <span class="n">energyIn</span><span class="p">,</span> <span class="n">energyOut</span> <span class="o">=</span> <span class="n">energyOut</span><span class="p">,</span> <span class="n">muOut</span> <span class="o">=</span> <span class="n">muOut</span><span class="p">,</span> 
                    <span class="n">phiOut</span> <span class="o">=</span> <span class="n">phiOut</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span> <span class="n">LegendreOrder</span> <span class="o">=</span> <span class="n">LegendreOrder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">orphanProduct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span>
            <span class="n">partialProductionIntegralSum</span> <span class="o">+=</span> <span class="n">orphanProduct</span><span class="o">.</span><span class="n">partialProductionIntegral</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">productID</span><span class="p">,</span> <span class="n">energyIn</span><span class="p">,</span> <span class="n">energyOut</span> <span class="o">=</span> <span class="n">energyOut</span><span class="p">,</span> <span class="n">muOut</span> <span class="o">=</span> <span class="n">muOut</span><span class="p">,</span> 
                    <span class="n">phiOut</span> <span class="o">=</span> <span class="n">phiOut</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span> <span class="n">LegendreOrder</span> <span class="o">=</span> <span class="n">LegendreOrder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>

        <span class="k">return</span><span class="p">(</span> <span class="n">partialProductionIntegralSum</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.processCoulombPlusNuclearMuCutoff"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.processCoulombPlusNuclearMuCutoff">[docs]</a>    <span class="k">def</span> <span class="nf">processCoulombPlusNuclearMuCutoff</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">excludeRutherfordScattering</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">nuclearPlusCoulombInterference</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">RutherfordScatteringExcluded</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processCoulombPlusNuclearMuCutoff</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">excludeRutherfordScattering</span> <span class="o">=</span> <span class="n">excludeRutherfordScattering</span> <span class="p">)</span>

            <span class="k">if</span><span class="p">(</span> <span class="n">RutherfordScatteringExcluded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">crossSection</span><span class="p">,</span> <span class="n">function2d</span> <span class="o">=</span> <span class="n">RutherfordScatteringExcluded</span>
                <span class="n">firstProduct</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">secondProduct</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">nuclearPlusCoulombInterference</span> <span class="o">=</span> <span class="n">nuclearPlusCoulombInterferenceModule</span><span class="o">.</span><span class="n">NuclearPlusCoulombInterference</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

                <span class="k">try</span> <span class="p">:</span>
                    <span class="n">LLNL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationData</span><span class="p">[</span><span class="s1">&#39;LLNL&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="p">:</span>
                    <span class="n">LLNL</span> <span class="o">=</span> <span class="n">institutionModule</span><span class="o">.</span><span class="n">Institution</span><span class="p">(</span><span class="s1">&#39;LLNL&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">applicationData</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">LLNL</span> <span class="p">)</span>
                <span class="n">LLNL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">nuclearPlusCoulombInterference</span> <span class="p">)</span>

                <span class="n">nuclearPlusCoulombInterference</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">crossSection</span> <span class="p">)</span>

                <span class="n">Q</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>
                <span class="n">Q</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span>
                <span class="n">nuclearPlusCoulombInterference</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">Q</span> <span class="p">)</span>

                <span class="n">product1</span> <span class="o">=</span> <span class="n">productModule</span><span class="o">.</span><span class="n">Product</span><span class="p">(</span><span class="n">firstProduct</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">firstProduct</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="n">product1</span><span class="o">.</span><span class="n">multiplicity</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">firstProduct</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">product1</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span>
                <span class="n">angularTwoBody1</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">TwoBody</span><span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">centerOfMass</span><span class="p">,</span> <span class="n">function2d</span> <span class="p">)</span>
                <span class="n">product1</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">angularTwoBody1</span> <span class="p">)</span>
                <span class="n">nuclearPlusCoulombInterference</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">product1</span> <span class="p">)</span>

                <span class="n">product2</span> <span class="o">=</span> <span class="n">productModule</span><span class="o">.</span><span class="n">Product</span><span class="p">(</span><span class="n">secondProduct</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">secondProduct</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="n">product2</span><span class="o">.</span><span class="n">multiplicity</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">secondProduct</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">product2</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span>
                <span class="n">recoil</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Recoil</span><span class="p">(</span> <span class="n">link</span> <span class="o">=</span> <span class="n">product1</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="n">style</span><span class="o">.</span><span class="n">label</span><span class="p">],</span> <span class="n">relative</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
                <span class="n">angularTwoBody2</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">TwoBody</span><span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">centerOfMass</span><span class="p">,</span> <span class="n">recoil</span> <span class="p">)</span>
                <span class="n">product2</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">angularTwoBody2</span> <span class="p">)</span>
                <span class="n">nuclearPlusCoulombInterference</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">product2</span> <span class="p">)</span>

                <span class="n">nuclearPlusCoulombInterference</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">process</span> <span class="o">=</span> <span class="s1">&#39;no Rutherford&#39;</span>
                <span class="n">nuclearPlusCoulombInterference</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">updateLabel</span><span class="p">(</span> <span class="p">)</span>

        <span class="k">return</span><span class="p">(</span> <span class="n">nuclearPlusCoulombInterference</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.processThermalNeutronScatteringLaw"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.processThermalNeutronScatteringLaw">[docs]</a>    <span class="k">def</span> <span class="nf">processThermalNeutronScatteringLaw</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="bp">self</span> <span class="p">}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;temperatureUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/k&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c**2&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;momentumUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;neutronMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;productMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;neutronMass&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>

        <span class="n">energyMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getEvaluatedStyle</span><span class="p">()</span><span class="o">.</span><span class="n">projectileEnergyDomain</span><span class="o">.</span><span class="n">max</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">energyMax</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;energyMax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energyMax</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processThermalNeutronScatteringLaw</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.processMC_cdf"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.processMC_cdf">[docs]</a>    <span class="k">def</span> <span class="nf">processMC_cdf</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">additionalReactions</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot; --&gt;&quot;</span><span class="p">)))</span>

        <span class="n">tempInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="bp">self</span> <span class="p">}</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementalIndent</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;brokenLinks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processMC_cdf</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processMC_cdf</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">additionalReactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processMC_cdf</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">original</span><span class="p">,</span> <span class="n">newReference</span> <span class="ow">in</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;brokenLinks&#39;</span><span class="p">]:</span>
            <span class="n">newReference</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">referenceInstance</span><span class="o">.</span><span class="n">ancestor</span><span class="p">[</span> <span class="n">newReference</span><span class="o">.</span><span class="n">label</span> <span class="p">]</span></div>

<div class="viewcode-block" id="ReactionSuite.processGriddedCrossSections"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.processGriddedCrossSections">[docs]</a>    <span class="k">def</span> <span class="nf">processGriddedCrossSections</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">additionalReactions</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a union grid for all cross sections, for faster continuous energy Monte Carlo sampling.</span>
<span class="sd">        The grid spans the same domain as the elastic scattering cross section.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">mutualDomain</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">:</span>

            <span class="n">crossSection</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">Regions1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">crossSection</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="p">)</span>
            <span class="n">crossSection</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainSlice</span><span class="p">(</span> <span class="n">domainMin</span><span class="p">,</span> <span class="n">domainMax</span> <span class="p">)</span>                 <span class="c1"># truncate to match elastic domain</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">&gt;</span> <span class="n">domainMin</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    WARNING, domains not mutual, setting first y-value to 0.&#39;</span><span class="p">)</span>
                <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span> <span class="p">]</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">&lt;</span> <span class="n">domainMax</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">crossSection</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    WARNING, domains not mutual, setting last y-value to 0.&#39;</span><span class="p">)</span>
                <span class="n">crossSection</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">crossSection</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span> <span class="p">]</span>
            <span class="n">thresholds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">(</span> <span class="n">crossSection</span> <span class="p">)</span>

        <span class="k">def</span> <span class="nf">photoAtomic</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">:</span>

            <span class="n">crossSection</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">Regions1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">iRegion</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">crossSection</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">domainGrid</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">domainGrid</span>
                    <span class="n">values</span> <span class="o">+=</span> <span class="n">domainGrid</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainGrid</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">domainMin</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">y1</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">xEpsilon</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x1</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">xEpsilon</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xEpsilon</span> <span class="p">)</span>

            <span class="k">return</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">evaluationStyle</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findDerivedFromStyle</span><span class="p">(</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">Evaluated</span> <span class="p">)</span>
        <span class="n">projectileEnergyDomain</span> <span class="o">=</span> <span class="n">evaluationStyle</span><span class="o">.</span><span class="n">projectileEnergyDomain</span>
        <span class="n">domainMin</span> <span class="o">=</span> <span class="n">projectileEnergyDomain</span><span class="o">.</span><span class="n">min</span>
        <span class="n">domainMax</span> <span class="o">=</span> <span class="n">projectileEnergyDomain</span><span class="o">.</span><span class="n">max</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>

        <span class="n">isPhotoAtomic</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">isThermalNeutronScatteringLaw</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
            <span class="n">isChemicalElement</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">ChemicalElement</span> <span class="p">)</span>
            <span class="n">isUnorthodox</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">unorthodoxPoPsModule</span><span class="o">.</span><span class="n">Particle</span> <span class="p">)</span>
            <span class="n">isPhotoAtomic</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">isChemicalElement</span> <span class="ow">or</span> <span class="n">isUnorthodox</span> <span class="p">)</span>

        <span class="n">thresholds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">isPhotoAtomic</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">photoAtomic</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">total</span> <span class="o">+=</span> <span class="n">mutualDomain</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span> <span class="n">total</span> <span class="o">+=</span> <span class="n">mutualDomain</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">domainGrid</span>

        <span class="n">tooCloseXsIndicies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span> <span class="o">*</span> <span class="n">x2</span> <span class="p">)</span> <span class="p">:</span> <span class="n">tooCloseXsIndicies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">i1</span> <span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span>
        <span class="n">tooCloseXsIndicies</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tooCloseXsIndicies</span> <span class="p">:</span>                   <span class="c1"># Remove close points but any threshold points.</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">in</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">:</span> <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">valuesModule</span><span class="o">.</span><span class="n">Values</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">axesModule</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span> <span class="n">total</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">GridStyle</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">values</span> <span class="p">)</span>
        <span class="n">style</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span><span class="p">,</span> <span class="n">isPhotoAtomic</span> <span class="o">=</span> <span class="n">isPhotoAtomic</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="n">isPhotoAtomic</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">production</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">:</span>
                <span class="n">production</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

            <span class="k">for</span> <span class="nb">sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSectionSums</span> <span class="p">:</span>
                <span class="nb">sum</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">fissionComponent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="p">:</span>
                <span class="n">fissionComponent</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">additionalReactions</span> <span class="p">:</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.processMultiGroup"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.processMultiGroup">[docs]</a>    <span class="k">def</span> <span class="nf">processMultiGroup</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">legendreMax</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">logFile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">workDir</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">restart</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">additionalReactions</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate multi-group processed data, including cross sections, weighted multiplicities and Q-values and transfer matrices.</span>
<span class="sd">        Processed results will be stored as new forms inside the reactionSuite.</span>

<span class="sd">        :param style: fudge.styles.HeatedMultiGroup instance</span>
<span class="sd">        :param legendreMax: number of Legendre orders to produce in transfer matrices.</span>
<span class="sd">        :param verbosity: verbosity level</span>
<span class="sd">        :param indent: indentation level for verbose output</span>
<span class="sd">        :param incrementalIndent: amount to increase verbose output indentation when calling processMultiGroup on child classes</span>
<span class="sd">        :param logFile: open file where log will be written.  FIXME logFile is a required argument, but default value = None</span>
<span class="sd">        :param workDir: directory to save working files generated during processing. Note that this directory can become very large.</span>
<span class="sd">        :param restart: load previous Merced outputs (if found) rather than recomputing, useful if a processProtare run times out or crashes.</span>
<span class="sd">        :return: None, except ValueError is raised if any errors occurred during processing</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">times</span> <span class="k">as</span> <span class="n">timesModule</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot; --&gt;&quot;</span><span class="p">)))</span>
        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">HeatedMultiGroup</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span><span class="p">(</span> <span class="s1">&#39;Instance is not a HeatedMultiGroup style.&#39;</span> <span class="p">)</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">timesModule</span><span class="o">.</span><span class="n">Times</span><span class="p">(</span> <span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="bp">self</span> <span class="p">}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementalIndent</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logFile</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c**2&#39;</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">restart</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legendreMax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legendreMax</span>

            <span class="n">projectile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projectile</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileZA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="n">projectile</span> <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">isThermalNeutronScatteringLaw</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;isInfiniteTargetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">ChemicalElement</span> <span class="p">)</span>
                <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">ChemicalElement</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span> <span class="p">)</span> <span class="p">:</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetZA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="n">target</span> <span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;masses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;Projectile&#39;</span>   <span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileMass&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;Product&#39;</span>      <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;Residual&#39;</span>     <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="s1">&#39;Target&#39;</span>       <span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="p">}</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zeroPerTNSL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isThermalNeutronScatteringLaw</span><span class="p">(</span> <span class="p">)</span>
            <span class="n">projectileEnergyDomain</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">projectileEnergyDomain</span>
            <span class="n">transportable</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">transportable</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">boundary</span> <span class="o">&gt;</span> <span class="n">projectileEnergyDomain</span><span class="o">.</span><span class="n">max</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maximumProjectileGroupIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>

            <span class="k">if</span><span class="p">(</span> <span class="n">workDir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">workDir</span> <span class="o">=</span> <span class="s1">&#39;Merced.work&#39;</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workDir</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">style</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;groupedFlux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">style</span><span class="o">.</span><span class="n">multiGroupFlux</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">constructArray</span><span class="p">(</span> <span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>

<span class="c1"># BRB FIXME, must have test to determine if reconstructResonances is needed.</span>
<span class="c1">#        self.reconstructResonances( styleName = &#39;reconstructed&#39;, 1e-3, verbose = False )</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;o</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;p</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSectionSums</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;s</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;f</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">additionalReactions</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;a</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">logFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">logFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">t0</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s2">&quot;kwargs[&#39;failures&#39;] = </span><span class="si">%d</span><span class="s2">  &gt; 0&quot;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupVector"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupVector">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">childSuite</span><span class="p">,</span> <span class="n">multiGroupVectorMethod</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General method to return multiGroupVector output from a specified multiGroupVectorMethod for specified reactionSuite child nodes.</span>

<span class="sd">        :param childSuite: Suite which to iterate over.</span>
<span class="sd">        :param multiGroupVectorMethod: Method to be executed for each entry in the suite of reactionSuite child nodes.</span>
<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param \*\*kwargs: Additional arguments for the selected method in the entries in the selected suite of reactionSuite child nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">vectorResult</span> <span class="o">=</span> <span class="n">vectorModule</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">suiteEntry</span> <span class="ow">in</span> <span class="n">childSuite</span><span class="p">:</span>
            <span class="n">vectorMethod</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">suiteEntry</span><span class="p">,</span> <span class="n">multiGroupVectorMethod</span><span class="p">)</span>
            <span class="n">vectorResult</span> <span class="o">+=</span> <span class="n">vectorMethod</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">vectorResult</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupMatrix"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">childSuite</span><span class="p">,</span> <span class="n">multiGroupMatrixMethod</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General method to return multiGroupMatrix output from a specified multiGroupVectorMethod for specified reactionSuite child nodes.</span>

<span class="sd">        :param childSuite: Suite which to iterate over.</span>
<span class="sd">        :param multiGroupMatrixMethod: Method to be executed for each entry in the suite of reactionSuite child nodes.</span>
<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param kwargs: Additional arguments for the selected method in the entries in the selected suite of reactionSuite child nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">matrixResult</span> <span class="o">=</span> <span class="n">matrixModule</span><span class="o">.</span><span class="n">Matrix</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">suiteEntry</span> <span class="ow">in</span> <span class="n">childSuite</span><span class="p">:</span>
            <span class="n">matrixMethod</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">suiteEntry</span><span class="p">,</span> <span class="n">multiGroupMatrixMethod</span><span class="p">)</span>
            <span class="n">matrixResult</span> <span class="o">+=</span> <span class="n">matrixMethod</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">matrixResult</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupCrossSection"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupCrossSection">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupCrossSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total cross section for the requested label. This is summed over all reactions.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupCrossSection&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupInverseSpeed"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupInverseSpeed">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupInverseSpeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the inverse speeds for the requested label. The label must be for a heated multi-group style.</span>

<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">styleLabel</span> <span class="o">=</span> <span class="n">temperatureInfo</span><span class="o">.</span><span class="n">heatedMultiGroup</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">styleLabel</span><span class="p">]</span><span class="o">.</span><span class="n">inverseSpeed</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">constructVector</span><span class="p">()</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupQ"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupQ">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupQ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">includeFinalProducts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total Q for the requested label. This is a cross section weighted multiplicity summed over all reactions.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param includeFinalProducts: If true, the Q is calculated for all output channels, including those for products.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupQ&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">includeFinalProducts</span><span class="o">=</span><span class="n">includeFinalProducts</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupMultiplicity"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupMultiplicity">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupMultiplicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total multiplicity for the requested label for the requested product. This is a cross section weighted multiplicity.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param productID: Particle id for the requested product.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">multiplicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupMultiplicity&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">)</span>
        <span class="n">multiplicity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="p">,</span> <span class="s1">&#39;multiGroupMultiplicity&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">multiplicity</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupFissionNeutronMultiplicity"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupFissionNeutronMultiplicity">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupFissionNeutronMultiplicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total fission neutron multiplicity for the requested label. This is a cross section weighted multiplicity.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">vectorModule</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reaction</span><span class="o">.</span><span class="n">isFission</span><span class="p">():</span>
                <span class="n">multiplicity</span> <span class="o">+=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">multiGroupMultiplicity</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">multiplicity</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupAvailableEnergy"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupAvailableEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupAvailableEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total available energy for the requested label. This is a cross section weighted available energy summed over all reactions.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupAvailableEnergy&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupAverageEnergy"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupAverageEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupAverageEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total average energy for the requested label for the requested product. This is a cross section weighted average energy summed over all reactions.</span>
<span class="sd">        </span>
<span class="sd">        This is a cross section weighted average energy summed over all products for this reaction.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param productID: Particle id for the requested product.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">averageEnergy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupAverageEnergy&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">)</span>
        <span class="n">averageEnergy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="p">,</span> <span class="s1">&#39;multiGroupAverageEnergy&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">averageEnergy</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupDepositionEnergy"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupDepositionEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupDepositionEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particleIDs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total deposition energy for the requested label.</span>
<span class="sd">        </span>
<span class="sd">        This is a cross section weighted deposition energy summed over all reactions. The deposition energy is calculated by subtracting </span>
<span class="sd">        the average energy from each transportable particle from the available energy. The list of transportable particles is specified </span>
<span class="sd">        via the list of particle specified in the multiGroupSettings argument.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param particleIDs: The list of particles to be transported.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">depositionEnergy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupAvailableEnergy</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">particleID</span> <span class="ow">in</span> <span class="n">particleIDs</span><span class="p">:</span>
            <span class="n">depositionEnergy</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupAverageEnergy</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particleID</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">depositionEnergy</span> </div>

<div class="viewcode-block" id="ReactionSuite.multiGroupAvailableMomentum"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupAvailableMomentum">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupAvailableMomentum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total available momentum for the requested label.</span>
<span class="sd">        </span>
<span class="sd">        This is a cross section weighted available momentum summed over all reactions.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupAvailableMomentum&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupAverageMomentum"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupAverageMomentum">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupAverageMomentum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total average momentum for the requested label for the requested product.</span>
<span class="sd">        </span>
<span class="sd">        This is a cross section weighted average momentum summed over all reactions.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param productID: Particle id for the requested product.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">averageMomentum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupAverageMomentum&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">)</span>
        <span class="n">averageMomentum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="p">,</span> <span class="s1">&#39;multiGroupAverageMomentum&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">averageMomentum</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupDepositionMomentum"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupDepositionMomentum">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupDepositionMomentum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particleIDs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total deposition momentum for the requested label.</span>
<span class="sd">        </span>
<span class="sd">        This is a cross section weighted deposition momentum summed over all reactions. The deposition momentum is calculated by </span>
<span class="sd">        subtracting the average momentum from each transportable particle from the available momentum. The list of transportable </span>
<span class="sd">        particles is specified via the list of particle specified in the multiGroupSettings argument.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param particleIDs: The list of particles to be transported.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">depositionMomentum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupAvailableMomentum</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">particleID</span> <span class="ow">in</span> <span class="n">particleIDs</span><span class="p">:</span>
            <span class="n">depositionMomentum</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupAverageMomentum</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particleID</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">depositionMomentum</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupGain"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupGain">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupGain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">productID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, gain for the requested particle and label.</span>
<span class="sd">        </span>
<span class="sd">        This is a cross section weighted gain summed over all reactions.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param productID: Particle id for the requested product.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">particleGain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupGain&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> \
            <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">,</span> <span class="n">projectileID</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">particleGain</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupTransportCorrection"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupTransportCorrection">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupTransportCorrection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">legendreOrder</span><span class="p">,</span> \
        <span class="n">temperature</span><span class="p">,</span> <span class="n">transportCorrectionType</span><span class="o">=</span><span class="n">transportingModule</span><span class="o">.</span><span class="n">TransportCorrectionType</span><span class="o">.</span><span class="n">none</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group transport correction for the requested label.</span>
<span class="sd">        </span>
<span class="sd">        The transport correction is calculated from the transfer matrix for the projectile id for the Legendre order of legendreOrder + 1.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param particles: The list of particles to be transported.</span>
<span class="sd">        :param legendreOrder: Requested Legendre order.</span>
<span class="sd">        :param temperature: The temperature of the flux to use when collapsing.</span>
<span class="sd">        :param transportCorrectionType: Requested transport correction type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">transportCorrectionType</span> <span class="o">==</span> <span class="n">transportingModule</span><span class="o">.</span><span class="n">TransportCorrectionType</span><span class="o">.</span><span class="n">Pendlebury</span><span class="p">:</span>
            <span class="n">multiGroupProductMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupProductMatrix</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="n">legendreOrder</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">matrixCollapsed</span> <span class="o">=</span> <span class="n">particlesModule</span><span class="o">.</span><span class="n">CollapseMatrix</span><span class="p">(</span><span class="n">multiGroupProductMatrix</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">)</span>
            <span class="n">transportCorrection</span> <span class="o">=</span> <span class="n">vectorModule</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">matrixCollapsed</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span>

        <span class="k">elif</span> <span class="n">transportCorrectionType</span> <span class="ow">is</span> <span class="n">transportingModule</span><span class="o">.</span><span class="n">TransportCorrectionType</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
            <span class="n">transportCorrection</span> <span class="o">=</span> <span class="n">vectorModule</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unsupported transport correction: only None and Pendlebury (i.e., Pendlebury/Underhill) are currently supported.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">transportCorrection</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupProductMatrix"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupProductMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupProductMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">productID</span><span class="p">,</span> <span class="n">legendreOrder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multi-group, total product matrix for the requested label for the requested product id for the requested Legendre order.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param particles: The list of particles to be transported.</span>
<span class="sd">        :param productID: Particle id for the requested product.</span>
<span class="sd">        :param legendreOrder: Requested Legendre order.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">productMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupProductMatrix&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> \
            <span class="n">particles</span><span class="o">=</span><span class="n">particles</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">,</span> <span class="n">legendreOrder</span><span class="o">=</span><span class="n">legendreOrder</span><span class="p">)</span>

        <span class="n">productMatrix</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="p">,</span> <span class="s1">&#39;multiGroupProductMatrix&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> \
            <span class="n">particles</span><span class="o">=</span><span class="n">particles</span><span class="p">,</span> <span class="n">productID</span><span class="o">=</span><span class="n">productID</span><span class="p">,</span> <span class="n">legendreOrder</span><span class="o">=</span><span class="n">legendreOrder</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">productMatrix</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupFissionMatrix"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupFissionMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupFissionMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">legendreOrder</span><span class="p">):</span>
        <span class="n">fissionMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiGroupMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="s1">&#39;multiGroupFissionMatrix&#39;</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> \
            <span class="n">particles</span><span class="o">=</span><span class="n">particles</span><span class="p">,</span> <span class="n">legendreOrder</span><span class="o">=</span><span class="n">legendreOrder</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fissionMatrix</span></div>

<div class="viewcode-block" id="ReactionSuite.multiGroupProductArray"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.multiGroupProductArray">[docs]</a>    <span class="k">def</span> <span class="nf">multiGroupProductArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">productID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the full multi-group, total product array for the requested label for the requested product id.</span>

<span class="sd">        :param multiGroupSettings: MG instance to instruct deterministic methods on what data are being requested.</span>
<span class="sd">        :param temperatureInfo: TemperatureInfo instance whose HeatedMultiGroup or SnElasticUpScatter label specifies the multi-group data to retrieve.</span>
<span class="sd">        :param particles: The list of particles to be transported.</span>
<span class="sd">        :param productID: Particle id for the requested product.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">productArray</span> <span class="o">=</span> <span class="n">productArrayModule</span><span class="o">.</span><span class="n">ProductArray</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="n">productArray</span> <span class="o">+=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">multiGroupProductArray</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">productID</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="p">:</span>
            <span class="n">productArray</span> <span class="o">+=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">multiGroupProductArray</span><span class="p">(</span><span class="n">multiGroupSettings</span><span class="p">,</span> <span class="n">temperatureInfo</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">productID</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">productArray</span></div>

<div class="viewcode-block" id="ReactionSuite.addMultiGroupSums"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.addMultiGroupSums">[docs]</a>    <span class="k">def</span> <span class="nf">addMultiGroupSums</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">.processing.deterministic</span> <span class="kn">import</span> <span class="n">addMultiGroupSums</span> <span class="k">as</span> <span class="n">addMultiGroupSumsModule</span>

        <span class="n">addMultiGroupSumsModule</span><span class="o">.</span><span class="n">addMultiGroupSums</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.processSnElasticUpScatter"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.processSnElasticUpScatter">[docs]</a>    <span class="k">def</span> <span class="nf">processSnElasticUpScatter</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">legendreMax</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">logFile</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">SnElasticUpScatter</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;style must be an instance of stylesModule.SnElasticUpScatter, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>

        <span class="n">tempInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="bp">self</span> <span class="p">}</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementalIndent</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logFile</span>
        <span class="n">incidentEnergyUnit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainUnit</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;legendreOrder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legendreMax</span>

        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;minEval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mf">1.e-11</span><span class="p">,</span> <span class="s1">&#39;MeV&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">incidentEnergyUnit</span> <span class="p">)</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;maxEval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mf">20.</span><span class="p">,</span> <span class="s1">&#39;MeV&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">incidentEnergyUnit</span> <span class="p">)</span>

        <span class="n">massUnit</span> <span class="o">=</span> <span class="n">incidentEnergyUnit</span> <span class="o">+</span> <span class="s1">&#39;/c**2&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span> <span class="p">)</span> <span class="p">:</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;targetMassRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">massUnit</span> <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">massUnit</span> <span class="p">)</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;groupBoundaries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span><span class="o">.</span><span class="n">group</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;zeroPerTNSL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">elasticReaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span> <span class="s1">&#39;elastic&#39;</span> <span class="p">)</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">elasticReaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">getProductWithName</span><span class="p">(</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span> <span class="p">)</span>

        <span class="n">TM_1</span><span class="p">,</span> <span class="n">TM_E</span><span class="p">,</span> <span class="n">averageEnergy</span><span class="p">,</span> <span class="n">maxIncidentGroup</span> <span class="o">=</span> <span class="n">multiGroupUpScatterModule</span><span class="o">.</span><span class="n">SnElasticUpScatter</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
        <span class="n">style</span><span class="o">.</span><span class="n">upperCalculatedGroup</span> <span class="o">=</span> <span class="n">maxIncidentGroup</span>

                <span class="c1"># multiply constant cross section into the distribution (upscatter code assumes sigma(E) = 1 )</span>
        <span class="n">groupedCrossSec</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">findAttributeInAncestry</span><span class="p">(</span> <span class="s1">&#39;crossSection&#39;</span> <span class="p">)[</span><span class="n">style</span><span class="o">.</span><span class="n">derivedFromStyle</span><span class="o">.</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">values</span>
        <span class="n">TM_1</span> <span class="o">=</span> <span class="n">multiGroupUpScatterModule</span><span class="o">.</span><span class="n">rescaleCrossSection</span><span class="p">(</span> <span class="n">groupedCrossSec</span><span class="p">,</span> <span class="n">TM_1</span> <span class="p">)</span>

        <span class="n">distribution</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">distribution</span>                             <span class="c1"># Put matrix into GNDS structures.</span>
        <span class="n">derivedForm</span> <span class="o">=</span> <span class="n">distribution</span><span class="p">[</span><span class="n">style</span><span class="o">.</span><span class="n">derivedFrom</span><span class="p">]</span>
        <span class="n">multiGroupSubform</span> <span class="o">=</span> <span class="n">derivedForm</span><span class="o">.</span><span class="n">multiGroupSubform</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">multiGroupSubform</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">constructArray</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">incidentGroup</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">style</span><span class="o">.</span><span class="n">upperCalculatedGroup</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">array</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">incidentGroup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TM_1</span> <span class="p">)</span> <span class="p">:</span> <span class="n">TM_1</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">outgoingGroup</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">array</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">outgoingGroup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TM_1</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span> <span class="n">TM_1</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">TM_1</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">][</span><span class="n">outgoingGroup</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">array</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">][</span><span class="n">outgoingGroup</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;productName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">pid</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;groupedFlux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">style</span><span class="o">.</span><span class="n">derivedFromStyle</span><span class="o">.</span><span class="n">multiGroupFlux</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">constructArray</span><span class="p">(</span> <span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incidentEnergyUnit</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;crossSection&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">derivedFromStyle</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="n">elasticReaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span>
        <span class="n">multiGroup</span> <span class="o">=</span> <span class="n">groupModule</span><span class="o">.</span><span class="n">TMs2Form</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">TM_1</span><span class="p">,</span> <span class="n">TM_E</span> <span class="p">)</span>
        <span class="n">distribution</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">multiGroup</span> <span class="p">)</span>

        <span class="n">averageProductEnergy</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">averageProductEnergy</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">averageProductEnergyModule</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">(</span> <span class="n">energyUnit</span> <span class="o">=</span> <span class="n">incidentEnergyUnit</span> <span class="p">)</span>
        <span class="n">averageEnergy</span> <span class="o">=</span> <span class="n">averageProductEnergyModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="n">averageEnergy</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span>
        <span class="n">averageEnergy</span> <span class="o">=</span> <span class="n">averageEnergy</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">indent</span> <span class="p">)</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">averageEnergy</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">constructArray</span><span class="p">(</span> <span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">averageProductEnergy</span><span class="p">[</span><span class="n">style</span><span class="o">.</span><span class="n">derivedFrom</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">constructArray</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">incidentGroup</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">style</span><span class="o">.</span><span class="n">upperCalculatedGroup</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">array</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">grouped</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">incidentGroup</span><span class="p">]</span>
        <span class="n">averageProductEnergy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">groupModule</span><span class="o">.</span><span class="n">toMultiGroup1d</span><span class="p">(</span> <span class="n">averageProductEnergyModule</span><span class="o">.</span><span class="n">Gridded1d</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">averageEnergy</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">grouped</span><span class="p">,</span> <span class="n">zeroPerTNSL</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;zeroPerTNSL&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.removeStyles"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.removeStyles">[docs]</a>    <span class="k">def</span> <span class="nf">removeStyles</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">styleLabels</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all forms whose label matches one of the labels in removeStyles.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span><span class="o">.</span><span class="n">removeStyles</span><span class="p">(</span> <span class="n">styleLabels</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span><span class="o">.</span><span class="n">removeStyles</span><span class="p">(</span> <span class="n">styleLabels</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span><span class="o">.</span><span class="n">removeStyles</span><span class="p">(</span> <span class="n">styleLabels</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span><span class="o">.</span><span class="n">removeStyles</span><span class="p">(</span> <span class="n">styleLabels</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span><span class="o">.</span><span class="n">removeStyles</span><span class="p">(</span> <span class="n">styleLabels</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span><span class="o">.</span><span class="n">removeStyles</span><span class="p">(</span> <span class="n">styleLabels</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span><span class="o">.</span><span class="n">removeStyles</span><span class="p">(</span> <span class="n">styleLabels</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.supportsResonanceReconstruction"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.supportsResonanceReconstruction">[docs]</a>    <span class="k">def</span> <span class="nf">supportsResonanceReconstruction</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether self.resonances contains any resonance parameters that can be reconstructed into</span>
<span class="sd">        cross sections and/or product distributions.</span>
<span class="sd">        :return: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">reconstructCrossSection</span></div>

<div class="viewcode-block" id="ReactionSuite.reconstructResonances"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.reconstructResonances">[docs]</a>    <span class="k">def</span> <span class="nf">reconstructResonances</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">thin</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">significantDigits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn resonance parameters into pointwise cross sections, then merge the results with</span>
<span class="sd">        tabulated pointwise cross sections. Resulting pointwise cross sections are stored</span>
<span class="sd">        alongside the original &#39;resonancesWithBackground&#39; data in the reactionSuite.</span>

<span class="sd">        :param style: style - an instance of style CrossSectionReconstructed.</span>
<span class="sd">        :param accuracy: float - target accuracy during reconstruction. For example, 0.001.</span>
<span class="sd">        :param thin: boolean - enable/disable thinning after reconstruction (disabling makes summed cross sections consistency checks easier).</span>
<span class="sd">        :param significantDigits: int - energy grid will only include points that can be exactly represented using specified number of significant digits.</span>
<span class="sd">        :param verbose: boolean - turn on/off verbosity</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">reconstructCrossSection</span><span class="p">:</span>
            <span class="k">return</span> <span class="c1"># nothing to do</span>
        <span class="kn">from</span> <span class="nn">fudge.processing.resonances</span> <span class="kn">import</span> <span class="n">reconstructResonances</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">CrossSectionReconstructed</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;style must be an instance of CrossSectionReconstructed, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>

        <span class="n">xsecs</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="o">.</span><span class="n">reconstructResonances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">significantDigits</span> <span class="o">=</span> <span class="n">significantDigits</span> <span class="p">)</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-8</span>  <span class="c1"># for joining multiple regions together</span>

        <span class="c1"># for each reaction, add tabulated pointwise data (ENDF MF=3) to reconstructed resonances:</span>
        <span class="n">possibleChannels</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;elastic&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;capture&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;nonelastic&#39;</span> <span class="p">:</span> <span class="kc">False</span> <span class="p">}</span>
        <span class="n">derivedFromLabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">sumsModule</span><span class="o">.</span><span class="n">MultiplicitySum</span> <span class="p">):</span> <span class="k">continue</span>
            <span class="n">evaluatedCrossSection</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">evaluated</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">evaluatedCrossSection</span><span class="p">,</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">ResonancesWithBackground</span> <span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># which reconstructed cross section corresponds to this reaction?</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">derivedFromLabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">:</span> <span class="n">derivedFromLabel</span> <span class="o">=</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">label</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">derivedFromLabel</span> <span class="o">!=</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;WARNING derivedFromLabel = &quot;</span><span class="si">%s</span><span class="s1">&quot; != &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">derivedFromLabel</span><span class="p">,</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
            <span class="n">RRxsec</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="ow">in</span> <span class="n">xsecs</span><span class="p">:</span>
                <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">xsecs</span><span class="p">[</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">possibleChannel</span> <span class="ow">in</span> <span class="n">possibleChannels</span> <span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">possibleChannels</span><span class="p">[</span><span class="n">possibleChannel</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
                        <span class="k">if</span><span class="p">(</span> <span class="n">possibleChannel</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">xsecs</span><span class="p">[</span><span class="n">possibleChannel</span><span class="p">]</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                        <span class="k">if</span><span class="p">(</span> <span class="n">reaction</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span> <span class="n">possibleChannel</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">xsecs</span><span class="p">[</span><span class="n">possibleChannel</span><span class="p">]</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>
            <span class="k">if</span> <span class="n">RRxsec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find appropriate reconstructed cross section to add to reaction &#39;</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="n">reaction</span><span class="p">)</span>

            <span class="n">background</span> <span class="o">=</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">background</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Encountered an error while linearizing background cross section for reaction &#39;</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="n">reaction</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">ex</span>
            <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">removeOverAdjustedPoints</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
            <span class="n">RRxsec</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="p">{</span><span class="n">RRxsec</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">:</span> <span class="n">background</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">,</span>  <span class="n">RRxsec</span><span class="o">.</span><span class="n">rangeUnit</span><span class="p">:</span> <span class="n">background</span><span class="o">.</span><span class="n">rangeUnit</span> <span class="p">}</span> <span class="p">)</span>

            <span class="n">background</span><span class="p">,</span> <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">mutualify</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">RRxsec</span><span class="p">,</span> <span class="o">-</span><span class="n">epsilon</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">background</span> <span class="o">+</span> <span class="n">RRxsec</span>    <span class="c1"># result is a crossSection.XYs1d instance</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">rangeMin</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
                <span class="c1"># turn any negative xsc to 0</span>
                <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span> <span class="n">rangeMin</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Warning: negative cross section encountered for </span><span class="si">%s</span><span class="s2">; changed to 0 b&quot;</span> <span class="o">%</span> <span class="n">reaction</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
                <span class="c1"># special handling for threshold reaction:</span>
                <span class="c1">#  trim leading zeros + points with cross section &lt; 1e-90 b,</span>
                <span class="c1">#  thin aggressively up to xsc = 1e-10 b</span>
                <span class="n">firstNonZero</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RRxsec</span><span class="p">)</span> <span class="k">if</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="p">[</span><span class="n">firstNonZero</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>

                <span class="n">points</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">copyDataToXYs</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">domainMin</span><span class="p">:</span>
                    <span class="n">points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

                <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">priorCrossSection</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="mf">1e5</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">idx</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span> <span class="k">break</span>
                    <span class="k">if</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e-20</span><span class="p">:</span> <span class="n">factor</span> <span class="o">=</span> <span class="mi">10</span>
                    <span class="k">if</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1e-90</span> <span class="ow">or</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">priorCrossSection</span><span class="p">:</span>
                        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">priorCrossSection</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

                <span class="n">RRxsec</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">thin</span><span class="p">:</span>
                <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">thin</span><span class="p">(</span> <span class="n">accuracy</span> <span class="p">)</span>
            <span class="n">RRxsec</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">RRxsec</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.reconstructResonancesAngularDistributions"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.reconstructResonancesAngularDistributions">[docs]</a>    <span class="k">def</span> <span class="nf">reconstructResonancesAngularDistributions</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thin</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn resonance parameters into Legendre-expanded angular distributions, then merge the results with</span>
<span class="sd">        tabulated angular distributions (overwriting original values in the resonance region). Resulting pointwise</span>
<span class="sd">        angular distributions are stored alongside the original angular distributions in the reactionSuite.</span>

<span class="sd">        :param styleName: string - label for reconstructed distribution style</span>
<span class="sd">        :param overwrite: boolean - if style already in use for another distribution, overwrite it with the reconstructed distribution</span>
<span class="sd">        :param accuracy: float - giving target accuracy during reconstruction. For example, 0.001</span>
<span class="sd">        :param thin: boolean - enable/disable thinning after reconstruction</span>
<span class="sd">        :param verbose: boolean - turn on/off verbosity</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">accuracy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Refining interpolation grid for angular distributions still TBD&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thin</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Thinning for angular distributions still TBD&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="kn">from</span> <span class="nn">fudge.processing.resonances</span> <span class="kn">import</span> <span class="n">reconstructResonances</span>

        <span class="n">newStyle</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">AngularDistributionReconstructed</span><span class="p">(</span> <span class="n">styleName</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span> <span class="p">)</span>       <span class="c1"># BRB6, FIXME - &#39;eval&#39; should not be hardwired.</span>

        <span class="n">distributions</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="o">.</span><span class="n">reconstructAngularDistributions</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">distributions</span><span class="p">:</span>
            <span class="n">reaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span> <span class="n">key</span> <span class="p">)</span>
            <span class="c1"># Kludgy way to discern the product&#39;s name so we can look it up</span>
<span class="c1"># BRB6 hardwired.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="n">productName</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
            <span class="k">else</span><span class="p">:</span>
<span class="c1"># BRB6 hardwired.</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">pid</span> <span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">products</span> <span class="p">]</span>
                <span class="n">productName</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pairs</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># pick&#39;s the lightest product</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">getProductWithName</span><span class="p">(</span><span class="n">productName</span><span class="p">)</span>
            <span class="n">original</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">angularSubform</span>
            <span class="n">reconstructed</span> <span class="o">=</span> <span class="n">distributions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="n">merged</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Regions2d</span><span class="p">(</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">axes</span> <span class="p">)</span>     <span class="c1"># Caleb, FIXME - check that this is correct.</span>
            <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">reconstructed</span> <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">original</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span> <span class="p">):</span>
                <span class="n">newregion</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span><span class="p">(</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
                        <span class="n">interpolationQualifier</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">interpolationQualifier</span> <span class="p">)</span>
                <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">original</span><span class="o">.</span><span class="n">getAtEnergy</span><span class="p">(</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">original</span><span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">val</span><span class="o">.</span><span class="n">outerDomainValue</span> <span class="o">&lt;=</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span> <span class="k">continue</span>
                    <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">val</span> <span class="p">)</span>
                <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">newregion</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">original</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Regions2d</span> <span class="p">):</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">original</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">&gt;</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">!=</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">newregion</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span><span class="p">(</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">region</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
                            <span class="n">interpolationQualifier</span><span class="o">=</span><span class="n">region</span><span class="o">.</span><span class="n">interpolationQualifier</span> <span class="p">)</span>
                    <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">region</span><span class="o">.</span><span class="n">getAtEnergy</span><span class="p">(</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">region</span><span class="p">:</span>
                        <span class="k">if</span><span class="p">(</span> <span class="n">val</span><span class="o">.</span><span class="n">outerDomainValue</span> <span class="o">&lt;=</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span> <span class="k">continue</span>
                        <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">val</span> <span class="p">)</span>
                    <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">newregion</span> <span class="p">)</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">original</span><span class="p">[</span><span class="n">idx</span><span class="p">:]:</span>
                    <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">region</span> <span class="p">)</span>

            <span class="n">newForm</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">TwoBody</span><span class="p">(</span> <span class="n">label</span> <span class="o">=</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">productFrame</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">productFrame</span><span class="p">,</span> <span class="n">angularSubform</span> <span class="o">=</span> <span class="n">merged</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="p">:</span>
                <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span>
            <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">newForm</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">newStyle</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.removeStyle"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.removeStyle">[docs]</a>    <span class="k">def</span> <span class="nf">removeStyle</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the given style everywhere it appears in this reactionSuite</span>
<span class="sd">        :param style: may be a style instance or its name</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">Style</span><span class="p">):</span> <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span>

        <span class="k">def</span> <span class="nf">removeStyleFromComponent</span><span class="p">(</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">component</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">styleName</span> <span class="ow">in</span> <span class="n">component</span><span class="p">:</span>
                <span class="n">component</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">styleName</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="c1"># currently checks in cross section and deposition data, should also check multiplicity and distributions</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="s1">&#39;crossSection&#39;</span><span class="p">):</span>
                <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="s1">&#39;outputChannel&#39;</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="p">:</span>
                <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">product</span><span class="o">.</span><span class="n">averageProductEnergy</span> <span class="p">)</span>
                <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">product</span><span class="o">.</span><span class="n">averageProductMomentum</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">product</span><span class="o">.</span><span class="n">outputChannel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">for</span> <span class="n">dproduct</span> <span class="ow">in</span> <span class="n">product</span><span class="o">.</span><span class="n">outputChannel</span><span class="p">:</span>
                    <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">dproduct</span><span class="o">.</span><span class="n">averageProductEnergy</span> <span class="p">)</span>
                    <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">dproduct</span><span class="o">.</span><span class="n">averageProductMomentum</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.saveAllToFile"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.saveAllToFile">[docs]</a>    <span class="k">def</span> <span class="nf">saveAllToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">hybrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes *self* and its covariance data to files. The name of the covariance file will be the same as the *fileName* but</span>
<span class="sd">        it will be put into a &quot;Covariance&quot; sub-directory inside the directory where *self* is written and &quot;-covar&quot; will be</span>
<span class="sd">        added before the extension. If hybrid is *True*, self will be written out in default hybrid mode with the HDF5 data </span>
<span class="sd">        written into a file with the same name as *self* but different extension and in a sub-directory named &quot;HDF5&quot;.</span>

<span class="sd">        :param fileName:        The name of the file to write *self* to.</span>
<span class="sd">        :param hybrid:          If *True* data are written in hybrid XML/HDF5 files.</span>
<span class="sd">        :param kwargs:          Additional key-word arguments that are passed to internal calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">externalFile</span> <span class="k">as</span> <span class="n">externalFileModule</span>
        <span class="n">covarianceDir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;covarianceDir&#39;</span><span class="p">,</span> <span class="s1">&#39;Covariances&#39;</span><span class="p">))</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
        <span class="n">covarianceName</span> <span class="o">=</span> <span class="n">covarianceDir</span> <span class="o">/</span> <span class="p">(</span><span class="n">fileName</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;-covar&#39;</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
        <span class="n">covariancePath</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">covarianceName</span>

        <span class="n">covariances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadCovariances</span><span class="p">()</span>
        <span class="n">originalPaths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">covariances</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcePath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># self was generated directly, not parsed from a ReactionSuite file. Add externalFiles before saving:</span>
            <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">externalFileModule</span><span class="o">.</span><span class="n">ExternalFile</span><span class="p">(</span><span class="s2">&quot;reactions&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)))</span>
            <span class="n">covariances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">saveToFile</span><span class="p">(</span><span class="n">covariancePath</span><span class="p">)</span>

            <span class="n">sha1sum</span> <span class="o">=</span> <span class="n">checksumsModule</span><span class="o">.</span><span class="n">Sha1sum</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">covariancePath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">externalFileModule</span><span class="o">.</span><span class="n">ExternalFile</span><span class="p">(</span><span class="s2">&quot;covariances&quot;</span><span class="p">,</span> <span class="n">covariancePath</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="n">sha1sum</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># locate and update the ExternalFiles pointing between the two files</span>
            <span class="k">for</span> <span class="n">covariance</span> <span class="ow">in</span> <span class="n">covariances</span><span class="p">:</span>
                <span class="n">externalPath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">sourcePathC</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">covariance</span><span class="o">.</span><span class="n">sourcePath</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">externalFile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="p">:</span>                             <span class="c1"># Find externalFile for this covariance.</span>
                    <span class="k">if</span> <span class="n">sourcePathC</span><span class="o">.</span><span class="n">samefile</span><span class="p">(</span><span class="n">externalFile</span><span class="o">.</span><span class="n">realpath</span><span class="p">()):</span>
                        <span class="n">externalPath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">externalFile</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">externalPath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: could not find externalFile for covariance &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="n">sourcePathC</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">externalPath</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>                                <span class="c1"># Only write if not absolute.</span>
                    <span class="k">if</span> <span class="n">externalFile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">originalPaths</span><span class="p">:</span>
                        <span class="n">originalPaths</span><span class="p">[</span><span class="n">externalFile</span><span class="p">]</span> <span class="o">=</span> <span class="n">externalFile</span><span class="o">.</span><span class="n">path</span>             <span class="c1"># Needs to be reset back to original name before this method exits..</span>
                    <span class="n">externalFile</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">covarianceName</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">covariancePath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">covariancePath</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">covarianceDir</span> <span class="o">/</span> <span class="n">sourcePathC</span><span class="o">.</span><span class="n">name</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: multiple covariance files, using &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="n">covariancePath</span><span class="p">)</span>

                    <span class="n">externalPathC</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">selfSourcePath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcePath</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">externalFileC</span> <span class="ow">in</span> <span class="n">covariance</span><span class="o">.</span><span class="n">externalFiles</span><span class="p">:</span>
                        <span class="n">externalFilePath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">externalFileC</span><span class="o">.</span><span class="n">realpath</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">externalFilePath</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">selfSourcePath</span><span class="o">.</span><span class="n">samefile</span><span class="p">(</span><span class="n">externalFilePath</span><span class="p">):</span>
                            <span class="n">externalPathC</span> <span class="o">=</span> <span class="n">externalFileC</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">externalPathC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: could not find externalFile in covariance for reactionSuite.&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">externalFileC</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">originalPaths</span><span class="p">:</span>
                            <span class="n">originalPaths</span><span class="p">[</span><span class="n">externalFileC</span><span class="p">]</span> <span class="o">=</span> <span class="n">externalFileC</span><span class="o">.</span><span class="n">path</span>             <span class="c1"># Needs to be reset back to original name before this method exits..</span>
                        <span class="n">externalPathC</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">fileName</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">covariance</span><span class="o">.</span><span class="n">saveToFile</span><span class="p">(</span><span class="n">covariancePath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">covariancePath</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">hybrid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveToHybrid</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveToFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">externalFile</span> <span class="ow">in</span> <span class="n">originalPaths</span><span class="p">:</span>
            <span class="n">externalFile</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">originalPaths</span><span class="p">[</span><span class="n">externalFile</span><span class="p">]</span></div>

<div class="viewcode-block" id="ReactionSuite.saveToHybrid"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.saveToHybrid">[docs]</a>    <span class="k">def</span> <span class="nf">saveToHybrid</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">xmlName</span><span class="p">,</span> <span class="n">hdfName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hdfSubDir</span><span class="o">=</span><span class="s1">&#39;HDF5&#39;</span><span class="p">,</span> <span class="n">minLength</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the reactionSuite to a hybrid layout, with the data hierarchy in xml</span>
<span class="sd">        but most actual data saved in an associated HDF file</span>

<span class="sd">        :param xmlName: file name to save.</span>
<span class="sd">        :param hdfName: if None, will be the same as xmlName with extension changed to .h5</span>
<span class="sd">        :param hdfSubDir: if not None, the sub-directoty to add to path hdfName.</span>
<span class="sd">        :param minLength: minimum number of values before moving a dataset from XML to HDF</span>
<span class="sd">            Need to determine best default setting</span>
<span class="sd">        :param flatten: if True, GNDS datasets are concatenated into flattened HDF5 datasets</span>
<span class="sd">        :param compress: enable gzip + shuffle compression for HDF5 datasets</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">externalFile</span> <span class="k">as</span> <span class="n">externalFileModule</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">HDF5_present</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Missing module &#39;h5py&#39; must be installed to support generating HDF5 files.&quot;</span><span class="p">)</span>

        <span class="n">xmlName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">xmlName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hdfName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hdfName</span> <span class="o">=</span> <span class="n">xmlName</span>
            <span class="k">if</span> <span class="n">hdfName</span><span class="o">.</span><span class="n">suffix</span> <span class="o">!=</span> <span class="s1">&#39;.xml&#39;</span><span class="p">:</span>
                <span class="n">hdfName</span> <span class="o">=</span> <span class="n">hdfName</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">hdfName</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">)</span>
            <span class="n">hdfName</span> <span class="o">=</span> <span class="n">hdfName</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hdfName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">hdfName</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hdfSubDir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hdfName</span> <span class="o">=</span> <span class="n">hdfName</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">hdfSubDir</span> <span class="o">/</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">hdfName</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">hdfName</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">hdfName</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdfName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5</span><span class="p">:</span>
            <span class="n">HDF_opts</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;h5file&#39;</span><span class="p">:</span> <span class="n">h5</span><span class="p">,</span>
                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>     <span class="c1"># assign unique name to each dataset</span>
                <span class="s1">&#39;minLength&#39;</span><span class="p">:</span> <span class="n">minLength</span><span class="p">,</span>
                <span class="s1">&#39;flatten&#39;</span><span class="p">:</span> <span class="n">flatten</span><span class="p">,</span>
                <span class="s1">&#39;iData&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;dData&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;compression&#39;</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">compress</span><span class="p">:</span>
                <span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;compression&#39;</span><span class="p">:</span><span class="s1">&#39;gzip&#39;</span><span class="p">,</span> <span class="s1">&#39;shuffle&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;chunks&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>

            <span class="n">checksumAlgorithm</span> <span class="o">=</span> <span class="n">checksumsModule</span><span class="o">.</span><span class="n">Sha1sum</span>
            <span class="n">relHdfName</span> <span class="o">=</span> <span class="n">hdfName</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">relHdfName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">hdfName</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">xmlName</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">relHdfName</span> <span class="o">==</span> <span class="n">relHdfName</span><span class="o">.</span><span class="n">resolve</span><span class="p">():</span>
                    <span class="n">relHdfName</span> <span class="o">=</span> <span class="n">relHdfName</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># add filler external file, actual checksum computed below</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">externalFileModule</span><span class="o">.</span><span class="n">ExternalFile</span><span class="p">(</span><span class="s2">&quot;HDF&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">relHdfName</span><span class="p">),</span> <span class="n">checksum</span> <span class="o">=</span> <span class="s2">&quot;deadbeef&quot;</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">checksumAlgorithm</span><span class="o">.</span><span class="n">algorithm</span><span class="p">))</span>

            <span class="n">xmlString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span> <span class="n">HDF_opts</span> <span class="o">=</span> <span class="n">HDF_opts</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;iData&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;iData&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span> <span class="p">)</span>
                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;iData&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">iData</span><span class="p">,</span> <span class="o">**</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;dData&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;dData&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span> <span class="p">)</span>
                <span class="n">h5</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;dData&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dData</span><span class="p">,</span> <span class="o">**</span><span class="n">HDF_opts</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">])</span>

        <span class="n">sha1sum</span> <span class="o">=</span> <span class="n">checksumAlgorithm</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">hdfName</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xmlString</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;externalFile&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;checksum=&quot;deadbeef&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">xmlString</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;deadbeef&quot;</span><span class="p">,</span> <span class="n">sha1sum</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">xmlName</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">xmlName</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">xmlName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span> <span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">xmlString</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;HDF&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.thermalNeutronScatteringLawTemperatures"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.thermalNeutronScatteringLawTemperatures">[docs]</a>    <span class="k">def</span> <span class="nf">thermalNeutronScatteringLawTemperatures</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">temperatures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">thermalNeutronScatteringLawTemperatures</span><span class="p">(</span> <span class="n">temperatures</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">temperatures</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.toXML_strList"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.toXML_strList">[docs]</a>    <span class="k">def</span> <span class="nf">toXML_strList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of GNDS/XML strings representing self.&quot;&quot;&quot;</span>

        <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">)</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span>
        <span class="n">indent3</span> <span class="o">=</span> <span class="n">indent2</span> <span class="o">+</span> <span class="n">incrementalIndent</span>

        <span class="n">formatVersion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;formatVersion&#39;</span><span class="p">,</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formatVersion</span> <span class="ow">in</span> <span class="p">(</span><span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_2_0_LLNL_3</span><span class="p">,</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_2_0_LLNL_4</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO: converting GNDS format from &quot;</span><span class="si">%s</span><span class="s1">&quot; to &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">formatVersion</span><span class="p">,</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_2_0</span><span class="p">))</span>
            <span class="n">formatVersion</span> <span class="o">=</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_2_0</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;formatVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatVersion</span>
        <span class="k">if</span> <span class="n">formatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">allowed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported GNDS structure &#39;</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">formatVersion</span><span class="p">))</span>

        <span class="n">interaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interaction</span>
        <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">TNSL</span><span class="p">:</span>
            <span class="n">interaction</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">getTNSLInteration</span><span class="p">(</span><span class="n">formatVersion</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> projectile=&quot;</span><span class="si">%s</span><span class="s1">&quot; target=&quot;</span><span class="si">%s</span><span class="s1">&quot; evaluation=&quot;</span><span class="si">%s</span><span class="s1">&quot; format=&quot;</span><span class="si">%s</span><span class="s1">&quot; projectileFrame=&quot;</span><span class="si">%s</span><span class="s1">&quot; interaction=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="p">,</span> <span class="n">formatVersion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectileFrame</span><span class="p">,</span> <span class="n">interaction</span><span class="p">)]</span>

        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incompleteReactions</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationData</span><span class="o">.</span><span class="n">toXML_strList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">xmlString</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">xmlString</span></div>

<div class="viewcode-block" id="ReactionSuite.toString"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a string representation of an reactionSuite.&quot;&quot;&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39; --&gt; &#39;</span> <span class="p">)</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span>
        <span class="n">indent3</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent3</span> <span class="p">)</span>
            <span class="n">indent3</span> <span class="o">=</span> <span class="n">indent2</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ReactionSuite.parseNodeUsingClass"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.parseNodeUsingClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parseNodeUsingClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translates a &lt;reactionSuite&gt; xml node into a reactionSuite instance. Users should use the &#39;readXML_file&#39; function instead.&quot;&quot;&quot;</span>

        <span class="n">xPath</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span>   <span class="c1"># Keep track of location in the tree, in case errors come up.</span>

        <span class="n">verbosity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbosity&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">numberOfBrokenLinksToPrint</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;numberOfBrokenLinksToPrint&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">try</span> <span class="p">:</span>
            <span class="n">sourcePath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sourcePath&#39;</span><span class="p">,</span> <span class="s1">&#39;./&#39;</span><span class="p">)</span>     <span class="c1"># This (i.e., &#39;./&#39;) may not be the correct default.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">sourcePath</span> <span class="o">=</span> <span class="n">sourcePath</span><span class="o">.</span><span class="n">name</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">)</span>

            <span class="n">formatVersion</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;format&#39;</span> <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;formatVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatVersion</span>

            <span class="n">projectile</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;projectile&#39;</span> <span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;target&#39;</span> <span class="p">)</span>
            <span class="n">evaluation</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;evaluation&#39;</span> <span class="p">)</span>
            <span class="n">projectileFrame</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;projectileFrame&#39;</span> <span class="p">)</span>

            <span class="n">interaction</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interaction&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">legacyTNSL</span> <span class="ow">or</span> <span class="n">interaction</span> <span class="o">==</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">TNSL</span><span class="p">:</span>
                <span class="n">interaction</span> <span class="o">=</span> <span class="n">interaction</span> <span class="o">=</span> <span class="n">enumsModule</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">TNSL</span>
                <span class="n">guessedInteraction</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">guessedInteraction</span><span class="p">,</span> <span class="n">interaction</span> <span class="o">=</span> <span class="n">guessInteractionModule</span><span class="o">.</span><span class="n">guessInteraction</span><span class="p">(</span><span class="n">interaction</span><span class="p">,</span> <span class="n">projectile</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>


            <span class="n">rs</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">projectile</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">formatVersion</span><span class="o">=</span><span class="n">formatVersion</span><span class="p">,</span> <span class="n">projectileFrame</span><span class="o">=</span><span class="n">projectileFrame</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="n">interaction</span><span class="p">,</span> <span class="n">sourcePath</span><span class="o">=</span><span class="n">sourcePath</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">formatVersion</span> <span class="o">==</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_1_10</span><span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">guessedInteraction</span> <span class="o">=</span> <span class="n">guessedInteraction</span>
            <span class="k">elif</span> <span class="n">guessedInteraction</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Function guessInteraction had to guess at the interaction attribute for a non GNDS </span><span class="si">%s</span><span class="s1"> file.&#39;</span> <span class="o">%</span> <span class="n">formatVersion</span><span class="p">)</span>

            <span class="n">linkData</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="n">rs</span><span class="p">,</span> <span class="s1">&#39;unresolvedLinks&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;format&#39;</span> <span class="p">:</span> <span class="n">formatVersion</span> <span class="p">}</span>

            <span class="n">externalFilesNode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">suitesModule</span><span class="o">.</span><span class="n">ExternalFiles</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">externalFilesNode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">parseNode</span><span class="p">(</span><span class="n">externalFilesNode</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;HDF&quot;</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">externalFiles</span><span class="p">:</span>   <span class="c1"># FIXME hard-coded label</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">HDF5_present</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Missing module &#39;h5py&#39; must be installed for HDF5 support.&quot;</span><span class="p">)</span>
                <span class="n">HDF_externalFile</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;HDF&#39;</span><span class="p">)</span>
                <span class="n">h5FilePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">path</span><span class="p">,</span> <span class="n">HDF_externalFile</span><span class="o">.</span><span class="n">path</span> <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">h5FilePath</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;External HDF file </span><span class="si">%s</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="n">h5FilePath</span><span class="p">)</span>

                <span class="n">h5File</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span> <span class="n">h5FilePath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">libver</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span> <span class="p">)</span>
                <span class="n">linkData</span><span class="p">[</span><span class="s2">&quot;HDF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;h5File&quot;</span> <span class="p">:</span> <span class="n">h5File</span> <span class="p">}</span>

            <span class="n">resonancesNode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resonancesNode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">resonances</span> <span class="o">=</span> <span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="o">.</span><span class="n">parseNodeUsingClass</span><span class="p">(</span><span class="n">resonancesNode</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;membersToSkip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rs</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="o">.</span><span class="n">moniker</span><span class="p">]</span>

            <span class="n">childNodesNotParse</span><span class="p">,</span> <span class="n">membersNotFoundInNode</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">parseAncestryMembers</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">childNodesNotParse</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">childNodesNotParse</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">resonancesModule</span><span class="o">.</span><span class="n">Resonances</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">oldDocumentationElement</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">oldDocumentationElement_3</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">formatVersion</span> <span class="o">==</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_1_10</span><span class="p">:</span> <span class="n">oldDocumentationElement</span> <span class="o">=</span> <span class="n">childNodesNotParse</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;documentations&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">formatVersion</span> <span class="o">==</span> <span class="n">GNDS_formatVersionModule</span><span class="o">.</span><span class="n">version_2_0_LLNL_3</span><span class="p">:</span> <span class="n">oldDocumentationElement_3</span> <span class="o">=</span> <span class="n">childNodesNotParse</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">oldDocumentationElement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldDocumentationElement</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Too many children of old documentations node: number of children = </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">oldDocumentationElement</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">oldDocumentationElement</span> <span class="o">=</span> <span class="n">oldDocumentationElement</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">oldDocumentationElement</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">rs</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getEvaluatedStyle</span><span class="p">()</span><span class="o">.</span><span class="n">documentation</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">text</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rs</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getEvaluatedStyle</span><span class="p">()</span><span class="o">.</span><span class="n">documentation</span><span class="o">.</span><span class="n">endfCompatible</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">text</span>
            <span class="k">elif</span> <span class="n">oldDocumentationElement_3</span><span class="p">:</span>                         <span class="c1"># Support some old 2.0.LLNL_3 files of YAHFC to GNDS for now. Hopefully, only temporary.</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">documentation</span><span class="o">.</span><span class="n">parseNode</span><span class="p">(</span><span class="n">oldDocumentationElement_3</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">childNodesNotParse</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: encountered unexpected child nodes &#39;</span><span class="si">%s</span><span class="s2">&#39; in reactionSuite!&quot;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">childNodesNotParse</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Error encountered at xpath = /</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">xPath</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># Fix links.</span>
        <span class="n">unresolvedLinksCounter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">quant</span> <span class="ow">in</span> <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;unresolvedLinks&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">quant</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">ReactionSuite</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">quant</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">quant</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span> <span class="n">rs</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="n">quant</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
                    <span class="n">rs</span><span class="o">.</span><span class="n">_externalLinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">quant</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>   <span class="c1"># relative link</span>
                    <span class="n">quant</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">quant</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span> <span class="n">quant</span> <span class="p">)</span>
            <span class="k">except</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">XPathNotFound</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">unresolvedLinksCounter</span> <span class="o">&lt;</span> <span class="n">numberOfBrokenLinksToPrint</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;    Cannot resolve link &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="n">quant</span> <span class="p">)</span>
                    <span class="n">unresolvedLinksCounter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">raise</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">unresolvedLinksCounter</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;WARNING: </span><span class="si">%s</span><span class="s1"> unresolved links found while parsing file &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">unresolvedLinksCounter</span><span class="p">,</span> <span class="n">rs</span><span class="o">.</span><span class="n">sourcePath</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">rs</span></div>

<div class="viewcode-block" id="ReactionSuite.read"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.ReactionSuite.read">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in the file name *fileName* and returns a **ReactionSuite** instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">ReactionSuite</span><span class="o">.</span><span class="n">readXML_file</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="read"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.read">[docs]</a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in the file name *fileName* and returns a **ReactionSuite** instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">ReactionSuite</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="niceSortOfMTs"><a class="viewcode-back" href="../../fudge/fudge.html#fudge.reactionSuite.niceSortOfMTs">[docs]</a><span class="k">def</span> <span class="nf">niceSortOfMTs</span><span class="p">(</span><span class="n">MTs</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">logFile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sorts the list of ENDF MTs into a sensible, defined order.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For internal use only.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">MT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MTs</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">MTs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">MT</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">MT</span><span class="p">]</span>

    <span class="n">MTs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">MTs</span><span class="p">)))</span>

    <span class="n">newMTs</span> <span class="o">=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span>  <span class="mi">2</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>                       <span class="c1"># Elastic reaction.</span>

    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">92</span><span class="p">):</span>                                   <span class="c1"># (z,n) reactions.</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span>  <span class="mi">4</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">16</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>                      <span class="c1"># (z,2n) reactions.</span>
    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">875</span><span class="p">,</span> <span class="mi">892</span><span class="p">):</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">17</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">37</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">18</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>                      <span class="c1"># Fission reactions.</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">19</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">20</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">38</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">28</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">32</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span> <span class="mi">33</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">):</span>                                  <span class="c1"># (z,p) reactions.</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="mi">103</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">650</span><span class="p">,</span> <span class="mi">700</span><span class="p">):</span>                                  <span class="c1"># (z,d) reactions.</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">750</span><span class="p">):</span>                                  <span class="c1"># (z,t) reactions.</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">800</span><span class="p">):</span>                                 <span class="c1"># (z,He3) reactions.</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="mi">106</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">850</span><span class="p">):</span>                                 <span class="c1"># (z,a) reactions.</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="mi">107</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>                                <span class="c1"># (z,g) reactions.</span>
        <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="n">newMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="n">MT5</span> <span class="o">=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span>  <span class="mi">5</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>                          <span class="c1"># (z,everything else).</span>

    <span class="n">MTAtomics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">573</span><span class="p">):</span>
        <span class="n">MTAtomics</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="n">skippingMTs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">151</span><span class="p">]:</span>
        <span class="n">skippingMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">201</span><span class="p">,</span> <span class="mi">600</span><span class="p">):</span>
        <span class="n">skippingMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">MT</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">850</span><span class="p">,</span> <span class="mi">875</span><span class="p">):</span>
        <span class="n">skippingMTs</span> <span class="o">+=</span> <span class="n">removeGetIfPresent</span><span class="p">(</span><span class="n">MT</span><span class="p">,</span> <span class="n">MTs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">skippingMTs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Skipping MTs = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">skippingMTs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newMTs</span> <span class="o">+</span> <span class="n">MTs</span> <span class="o">+</span> <span class="n">MT5</span> <span class="o">+</span> <span class="n">MTAtomics</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/gnd.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Fudge and GNDS 6.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fudge.reactionSuite</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, B.Beck, D. Brown, C. Mattoon, N. Patel, N. Summers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>