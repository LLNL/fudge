
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fudge.processing.deterministic.transferMatrices &#8212; Fudge and GNDS 6.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    
    <link rel="shortcut icon" href="../../../../_static/gnd-20121206-favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">Fudge and GNDS 6.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fudge.processing.deterministic.transferMatrices</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fudge.processing.deterministic.transferMatrices</h1><div class="highlight"><pre>
<span></span><span class="c1"># &lt;&lt;BEGIN-copyright&gt;&gt;</span>
<span class="c1"># &lt;&lt;END-copyright&gt;&gt;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">pqu</span> <span class="kn">import</span> <span class="n">PQU</span> <span class="k">as</span> <span class="n">PQUModule</span>

<span class="kn">from</span> <span class="nn">PoPs</span> <span class="kn">import</span> <span class="n">IDs</span> <span class="k">as</span> <span class="n">IDsPoPsModule</span>

<span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">locateFudgeBin</span> <span class="k">as</span> <span class="n">locateBinFolderModule</span>

<span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">subprocessing</span> <span class="k">as</span> <span class="n">subprocessingModule</span>
<span class="kn">from</span> <span class="nn">LUPY</span> <span class="kn">import</span> <span class="n">times</span> <span class="k">as</span> <span class="n">timesModule</span>

<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">enums</span> <span class="k">as</span> <span class="n">xDataEnumsModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">axes</span> <span class="k">as</span> <span class="n">axesModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">XYs1d</span> <span class="k">as</span> <span class="n">XYs1dModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">multiD_XYs</span> <span class="k">as</span> <span class="n">multiD_XYsModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="kn">import</span> <span class="n">regions</span> <span class="k">as</span> <span class="n">regionsModule</span>

<span class="kn">from</span> <span class="nn">fudge.productData.distributions</span> <span class="kn">import</span> <span class="n">angular</span> <span class="k">as</span> <span class="n">angularModule</span>
<span class="kn">from</span> <span class="nn">fudge.productData.distributions</span> <span class="kn">import</span> <span class="n">energy</span> <span class="k">as</span> <span class="n">energyModule</span>
<span class="kn">from</span> <span class="nn">fudge.productData.distributions</span> <span class="kn">import</span> <span class="n">energyAngular</span> <span class="k">as</span> <span class="n">energyAngularModule</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">specialCases</span> <span class="k">as</span> <span class="n">specialCasesModule</span>

<span class="n">linlin</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Interpolation</span><span class="o">.</span><span class="n">linlin</span>
<span class="n">linlog</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Interpolation</span><span class="o">.</span><span class="n">linlog</span>
<span class="n">loglin</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Interpolation</span><span class="o">.</span><span class="n">loglin</span>
<span class="n">loglog</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Interpolation</span><span class="o">.</span><span class="n">loglog</span>
<span class="n">flat</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Interpolation</span><span class="o">.</span><span class="n">flat</span>

<span class="n">GNDS2ProcessingInterpolationQualifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span><span class="p">:</span> <span class="s1">&#39;direct&#39;</span><span class="p">,</span> 
    <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">:</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">,</span>
    <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBaseUnscaled</span><span class="p">:</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBaseUnscaled</span><span class="p">,</span>
    <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">correspondingPoints</span><span class="p">:</span> <span class="s1">&#39;cumulativepoints&#39;</span><span class="p">,</span>
    <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">correspondingPointsUnscaled</span><span class="p">:</span> <span class="s1">&#39;cumulativepoints-unscaled&#39;</span> <span class="p">}</span>

<span class="n">versionStr</span> <span class="o">=</span> <span class="s2">&quot;xndfgenTransferMatrix: version 1.0&quot;</span>
<span class="n">doubleFmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%19.12e</span><span class="s2">&quot;</span>
<span class="n">lowerEps</span> <span class="o">=</span> <span class="mf">1e-8</span>
<span class="n">upperEps</span> <span class="o">=</span> <span class="mf">1e-8</span>
<span class="n">startOfNewData</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Start data</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">startOfNewSubData</span> <span class="o">=</span> <span class="s2">&quot;# Start sub data&quot;</span>

<span class="n">transferMatrixExecute</span> <span class="o">=</span> <span class="n">locateBinFolderModule</span><span class="o">.</span><span class="n">locateMerced</span><span class="p">()</span>

<div class="viewcode-block" id="twoBodyTransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.twoBodyTransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">twoBodyTransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate input and call processing code to generate a transfer matrix for two-body angular distribution.</span>
<span class="sd">    If the distribution is actually made up of two different forms in different energy regions, this function</span>
<span class="sd">    calls itself in the two regions and sums the result.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Isotropic2d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">angularData</span> <span class="o">=</span> <span class="n">angularData</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="p">)</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="o">=</span> <span class="n">twoBodyTransferMatrix2</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Regions2d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">angularData</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">twoBodyTransferMatrix</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
        <span class="n">TM1s</span><span class="p">,</span> <span class="n">TMEs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">lowestBound</span><span class="p">,</span> <span class="n">highestBound</span> <span class="o">=</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="n">angularData</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">domainMax</span>
        <span class="n">weightAxes</span> <span class="o">=</span> <span class="n">axesModule</span><span class="o">.</span><span class="n">Axes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">reactionSuite</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span>
        <span class="n">projectileName</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">projectile</span>
        <span class="n">maxGroupEnergy</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">projectileName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">iRegion</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">angularData</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">&gt;=</span> <span class="n">maxGroupEnergy</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">iRegion</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">weightData</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">lowestBound</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="n">highestBound</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">]</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">iRegion</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span> <span class="n">angularData</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">weightData</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">lowestBound</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="n">highestBound</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">weightData</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">lowestBound</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="mi">0</span> <span class="p">],</span> <span class="p">[</span> <span class="n">highestBound</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">]</span>
            <span class="n">_weight</span> <span class="o">=</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">weightData</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">weightAxes</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">flat</span><span class="p">)</span>

            <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;r</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">iRegion</span> <span class="p">)</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="o">=</span> <span class="n">twoBodyTransferMatrix2</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span>
                        <span class="n">productFrame</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">_weight</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span> <span class="p">)</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">del</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">raise</span>
            <span class="k">del</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">TM1s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">TM1</span> <span class="p">)</span>
            <span class="n">TMEs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">TME</span> <span class="p">)</span>
        <span class="n">TM1</span> <span class="o">=</span> <span class="n">addTMs</span><span class="p">(</span> <span class="n">TM1s</span> <span class="p">)</span>
        <span class="n">TME</span> <span class="o">=</span> <span class="n">addTMs</span><span class="p">(</span> <span class="n">TMEs</span> <span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Unsupported P(mu|E) = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">angularData</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="p">)</span></div>
        
<div class="viewcode-block" id="twoBodyTransferMatrix2"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.twoBodyTransferMatrix2">[docs]</a><span class="k">def</span> <span class="nf">twoBodyTransferMatrix2</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for twoBodyTransferMatrix. This should be called separately for every interpolation </span>
<span class="sd">    region within a Regions2d form.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">reactionSuite</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span>

<span class="c1">#</span>
<span class="c1"># This next section handles the case where Merced is having issues for photo-nuclear data at threshold and for small (&lt;1e-9 MeV) outgoing energies.</span>
<span class="c1">#</span>
    <span class="n">modifiedProductGroupIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">modifiedProductGroup</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">projectile</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="ow">and</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;productName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span><span class="p">:</span>

        <span class="n">cutoffEnergy</span> <span class="o">=</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="s1">&#39;MeV&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">])</span>
        <span class="n">productName</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;productName&#39;</span><span class="p">]</span>
        <span class="n">productGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">productName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span>
        <span class="k">for</span> <span class="n">modifiedProductGroupIndex</span><span class="p">,</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">productGroupBoundaries</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">boundary</span> <span class="o">&gt;</span> <span class="n">cutoffEnergy</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">if</span> <span class="n">modifiedProductGroupIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">modifiedProductGroup</span> <span class="o">=</span> <span class="n">productGroupBoundaries</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>
            <span class="n">modifiedProductGroupBoundaries</span> <span class="o">=</span> <span class="n">modifiedProductGroup</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="n">modifiedProductGroupIndex</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># 3 should be 3.    # 2 because the first one returned by Merced extends to 0.0 product energy.</span>
            <span class="n">modifiedProductGroup</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">modifiedProductGroup</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">modifiedProductGroupIndex</span><span class="p">:]</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Recoil</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">angularData</span> <span class="o">=</span> <span class="n">angularData</span><span class="o">.</span><span class="n">getNumericalDistribution</span><span class="p">(</span> <span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: &#39;two body transfer matrix&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Legendre</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: &#39;Legendre two body transfer matrix&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Unsupported P(mu) = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Reaction&#39;s Q value: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="p">(</span> <span class="n">Q</span> <span class="p">),</span> <span class="mi">12</span> <span class="p">)</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">photonFrame</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">centerOfMass</span><span class="p">,</span>
            <span class="n">modifiedProductGroup</span><span class="o">=</span><span class="n">modifiedProductGroup</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">angularToString</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="p">,</span> <span class="n">twoBody</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
    <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="o">=</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">],</span>
            <span class="n">productOffset</span> <span class="o">=</span> <span class="n">modifiedProductGroupIndex</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">modifiedProductGroup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span>

    <span class="n">projectileName</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">projectile</span>
    <span class="n">projectileGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">projectileName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span>
    <span class="k">for</span> <span class="n">projectileIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TM1</span><span class="p">)):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">TM1</span><span class="p">[</span><span class="n">projectileIndex</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">productIndex</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span> <span class="n">data</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">productIndex</span><span class="p">]))</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">dE</span> <span class="o">=</span> <span class="n">projectileGroupBoundaries</span><span class="p">[</span><span class="n">projectileIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">projectileGroupBoundaries</span><span class="p">[</span><span class="n">projectileIndex</span><span class="p">]</span>  <span class="c1"># This ignores any flux dependency on energy.</span>
            <span class="n">groupFlux</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">dE</span>
            <span class="n">TM1atThreshold</span><span class="p">,</span> <span class="n">TMEatThreshold</span> <span class="o">=</span> <span class="n">specialCasesModule</span><span class="o">.</span><span class="n">twoBodyPhotoNuclearAtThreshold</span><span class="p">(</span><span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;masses&#39;</span><span class="p">],</span> <span class="n">Q</span><span class="p">,</span> 
                <span class="n">modifiedProductGroupBoundaries</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;legendreMax&#39;</span><span class="p">],</span> <span class="n">groupFlux</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">TM1atThreshold</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">TM1atThreshold</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span>
            <span class="n">TMEatThreshold</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">TM1atThresholdRow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">TM1atThreshold</span><span class="p">):</span>
                <span class="n">TM1atThresholdRow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">norm</span>
                <span class="n">row</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">TM1atThresholdRow</span>
                <span class="n">TME</span><span class="p">[</span><span class="n">projectileIndex</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">TMEatThreshold</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span></div>

<div class="viewcode-block" id="wholeAtomScattering"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.wholeAtomScattering">[docs]</a><span class="k">def</span> <span class="nf">wholeAtomScattering</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">formFactor</span><span class="p">,</span> <span class="n">realAnomalousFactor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">imaginaryAnomalousFactor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>
    <span class="n">incidentEnergyUnit</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span>
    <span class="n">waveLengthUnit</span> <span class="o">=</span> <span class="n">formFactor</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
    <span class="n">inverseWaveLengthToEnergyFactor</span> <span class="o">=</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hplanck * c * </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">waveLengthUnit</span> <span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">incidentEnergyUnit</span> <span class="p">)</span>
    <span class="n">electronRadius</span> <span class="o">=</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;e**2 / ( 4 * pi * eps0 * me * c**2 )&quot;</span> <span class="p">)</span>
    <span class="n">ThomsonScatteringCrossSection</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">electronRadius</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>

    <span class="n">s1</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s2">&quot;Process: &#39;coherent scattering&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;inverseWaveLengthToEnergyFactor: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">inverseWaveLengthToEnergyFactor</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;ThompsonScattering: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">ThomsonScatteringCrossSection</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="s1">&#39;b&#39;</span> <span class="p">),</span> <span class="mi">12</span> <span class="p">)</span>

    <span class="n">s1</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">productFrame</span> <span class="p">)</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="n">startOfNewData</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;FormFactorData&quot;</span><span class="p">,</span> <span class="n">formFactor</span> <span class="p">)</span> <span class="p">)</span>
<span class="c1"># BRB: FIXME For realAnomalousFactor and imaginaryAnomalousFactor need to convert energy to proper unit.</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">realAnomalousFactor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> 
        <span class="n">s1</span> <span class="o">+=</span> <span class="n">startOfNewData</span>
        <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;realAnomalousFactor&quot;</span><span class="p">,</span> <span class="n">realAnomalousFactor</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">imaginaryAnomalousFactor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">s1</span> <span class="o">+=</span> <span class="n">startOfNewData</span>
        <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;imaginaryAnomalousFactor&quot;</span><span class="p">,</span> <span class="n">imaginaryAnomalousFactor</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="comptonScattering"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.comptonScattering">[docs]</a><span class="k">def</span> <span class="nf">comptonScattering</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">scatteringFactor</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>
    <span class="n">incidentEnergyUnit</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span>
    <span class="n">waveLengthUnit</span> <span class="o">=</span> <span class="n">scatteringFactor</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
    <span class="n">inverseWaveLengthToEnergyFactor</span> <span class="o">=</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hplanck * c * </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">waveLengthUnit</span> <span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">incidentEnergyUnit</span> <span class="p">)</span>
    <span class="n">electronRadius</span> <span class="o">=</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;e**2 / ( 4 * pi * eps0 * me * c**2 )&quot;</span> <span class="p">)</span>
    <span class="n">ThomsonScatteringCrossSection</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">electronRadius</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>

    <span class="n">s1</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s2">&quot;Process: &#39;Compton scattering&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;inverseWaveLengthToEnergyFactor: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">inverseWaveLengthToEnergyFactor</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;ThompsonScattering: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">ThomsonScatteringCrossSection</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="s1">&#39;b&#39;</span> <span class="p">),</span> <span class="mi">12</span> <span class="p">)</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;Electron mass: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;me * c**2&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">incidentEnergyUnit</span> <span class="p">),</span> <span class="mi">14</span> <span class="p">)</span>

    <span class="n">s1</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">productFrame</span> <span class="p">)</span>
    <span class="n">s1</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;ScatteringFactorData&quot;</span><span class="p">,</span> <span class="n">scatteringFactor</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ENDFEMuEpP_TransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.ENDFEMuEpP_TransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">ENDFEMuEpP_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">angularEnergyData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is ENDF MF = 6, LAW = 7 type data.&quot;&quot;&quot;</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: ENDF Double differential EMuEpP data</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">EMuEpPDataToString</span><span class="p">(</span> <span class="n">angularEnergyData</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ENDLEMuEpP_TransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.ENDLEMuEpP_TransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">ENDLEMuEpP_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">EMuEpPData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is LLNL I = 1, 3 type data.&quot;&quot;&quot;</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: &#39;Double differential EMuEpP data transfer matrix&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">angularToString</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">crossSection</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">EMuEpPDataToString</span><span class="p">(</span> <span class="n">EMuEpPData</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="ELEpP_TransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.ELEpP_TransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">ELEpP_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">LEEpPData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is for ENDL I = 4 data with l &gt; 0. This form is deprecated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: &#39;Legendre EEpP data transfer matrix&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">LEEpPDataToString</span><span class="p">(</span> <span class="n">LEEpPData</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="EEpMuP_TransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.EEpMuP_TransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">EEpMuP_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">energyAngularData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is ENDF MT=6 LAW=1, LANG=1,11-15 type data.&quot;&quot;&quot;</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyAngularData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">energyAngularModule</span><span class="o">.</span><span class="n">Legendre</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">Legendre_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> 
                <span class="n">energyAngularData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyAngularData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">energyAngularModule</span><span class="o">.</span><span class="n">XYs1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">doubleDifferential_EEpMuP</span><span class="p">(</span>  <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span>
                <span class="n">energyAngularData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Unsupported P(mu) for P(E&#39;,mu|E) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">energyAngularData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span></div>

<div class="viewcode-block" id="Legendre_TransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.Legendre_TransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">Legendre_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">LegendreData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: Legendre energy-angle data</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">LegendreDataToString</span><span class="p">(</span> <span class="n">LegendreData</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="doubleDifferential_EEpMuP"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.doubleDifferential_EEpMuP">[docs]</a><span class="k">def</span> <span class="nf">doubleDifferential_EEpMuP</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">EEpMuPData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
    
    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>
    
    <span class="n">s</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: pointwise energy-angle data</span><span class="se">\n</span><span class="s2">&quot;</span>
    
    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">EEpMuPDataToString</span><span class="p">(</span> <span class="n">EEpMuPData</span> <span class="p">)</span>
    
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="uncorrelated_EMuP_EEpP_TransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.uncorrelated_EMuP_EEpP_TransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">uncorrelated_EMuP_EEpP_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">energyData</span><span class="p">,</span> 
        <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="n">legendreMax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">isIsotropic</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">productFrame</span> <span class="o">==</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">lab</span><span class="p">:</span> <span class="n">legendreMax</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">sSpecific</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">FunctionalBase</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sProcess</span><span class="p">,</span> <span class="n">sSpecific</span><span class="p">,</span> <span class="n">sData</span> <span class="o">=</span> <span class="n">energyFunctionToString</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">WeightedFunctionals</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">TM1s</span><span class="p">,</span> <span class="n">TMEs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">energyData</span> <span class="p">:</span>
            <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="o">=</span> <span class="n">uncorrelated_EMuP_EEpP_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> 
                    <span class="n">weight</span><span class="o">.</span><span class="n">functional</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">weight</span> <span class="p">)</span>
            <span class="n">TM1s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">TM1</span> <span class="p">)</span>
            <span class="n">TMEs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">TME</span> <span class="p">)</span>
        <span class="n">TM1</span> <span class="o">=</span> <span class="n">addTMs</span><span class="p">(</span> <span class="n">TM1s</span> <span class="p">)</span>
        <span class="n">TME</span> <span class="o">=</span> <span class="n">addTMs</span><span class="p">(</span> <span class="n">TMEs</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">Regions2d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">TM1s</span><span class="p">,</span> <span class="n">TMEs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axesModule</span><span class="o">.</span><span class="n">Axes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">energyData</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="n">region</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="n">region</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">flat</span><span class="p">)</span>
            <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;r</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i1</span> <span class="p">)</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="o">=</span> <span class="n">uncorrelated_EMuP_EEpP_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span>
                        <span class="n">region</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="p">)</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">del</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">raise</span>
            <span class="k">del</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">TM1s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">TM1</span> <span class="p">)</span>
            <span class="n">TMEs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">TME</span> <span class="p">)</span>
        <span class="n">TM1</span> <span class="o">=</span> <span class="n">addTMs</span><span class="p">(</span> <span class="n">TM1s</span> <span class="p">)</span>
        <span class="n">TME</span> <span class="o">=</span> <span class="n">addTMs</span><span class="p">(</span> <span class="n">TMEs</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">PrimaryGamma</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">primaryGammaAngularData</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">isIsotropic</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">sProcess</span> <span class="o">=</span> <span class="s2">&quot;Process: isotropic table</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">sData</span> <span class="o">=</span> <span class="n">EEpPDataToString</span><span class="p">(</span> <span class="n">energyData</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sProcess</span> <span class="o">=</span> <span class="s2">&quot;Process: &#39;Uncorrelated energy-angle data transfer matrix&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">sData</span> <span class="o">=</span> <span class="n">angularToString</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">crossSection</span> <span class="p">)</span>
            <span class="n">sData</span> <span class="o">+=</span> <span class="n">EEpPDataToString</span><span class="p">(</span> <span class="n">energyData</span> <span class="p">)</span>

    <span class="n">sCommon</span> <span class="o">=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="p">,</span> <span class="n">legendreMax</span> <span class="o">=</span> <span class="n">legendreMax</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">sProcess</span> <span class="o">+</span> <span class="n">sSpecific</span> <span class="o">+</span> <span class="n">sCommon</span> <span class="o">+</span> <span class="n">sData</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="discreteGammaAngularData"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.discreteGammaAngularData">[docs]</a><span class="k">def</span> <span class="nf">discreteGammaAngularData</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">gammaEnergy</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Currently, only isotropic (i.e., l = 0) data are returned. That is, lMax and angularData are ignored. This routine is also used</span>
<span class="sd">    for pair-production which pass angularData as None.&quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">fudge.processing</span> <span class="kn">import</span> <span class="n">miscellaneous</span> <span class="k">as</span> <span class="n">miscellaneousModule</span>

    <span class="n">reactionSuite</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span>
    <span class="n">projectileName</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">projectile</span>
    <span class="n">projectileGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">projectileName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span>
    <span class="n">productName</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;productName&#39;</span><span class="p">]</span>
    <span class="n">productGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">productName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span>

    <span class="n">nProj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">projectileGroupBoundaries</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">nProd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">productGroupBoundaries</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">TM_1</span><span class="p">,</span> <span class="n">TM_E</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nProj</span><span class="p">):</span>
        <span class="n">TM_1_i1</span><span class="p">,</span> <span class="n">TM_E_i1</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nProd</span><span class="p">):</span>
            <span class="n">TM_1_i1</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
            <span class="n">TM_E_i1</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
        <span class="n">TM_1</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">TM_1_i1</span>
        <span class="n">TM_E</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">TM_E_i1</span>

    <span class="n">indexEp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">Ep</span> <span class="ow">in</span> <span class="n">productGroupBoundaries</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">gammaEnergy</span> <span class="o">&lt;=</span> <span class="n">Ep</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">indexEp</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">indexEp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">indexEp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">nProd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">multiplicity</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">&lt;</span> <span class="n">productGroupBoundaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">xsecTimesMult</span> <span class="o">=</span> <span class="n">miscellaneousModule</span><span class="o">.</span><span class="n">groupTwoFunctionsAndFlux</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;groupedFlux&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">indexE</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nProj</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">xsecTimesMult</span><span class="p">[</span><span class="n">indexE</span><span class="p">]</span>
            <span class="n">TM_1</span><span class="p">[</span><span class="n">indexE</span><span class="p">][</span><span class="n">indexEp</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">TM_E</span><span class="p">[</span><span class="n">indexE</span><span class="p">][</span><span class="n">indexEp</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">gammaEnergy</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">TM_1</span><span class="p">,</span> <span class="n">TM_E</span></div>

<div class="viewcode-block" id="primaryGammaAngularData"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.primaryGammaAngularData">[docs]</a><span class="k">def</span> <span class="nf">primaryGammaAngularData</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Currently, only isotropic (i.e., l = 0) data are returned. That is, lMax and angularData are ignored. massRatio is the</span>
<span class="sd">    target mass divide by the sum of the projectile and target masses.</span>

<span class="sd">    This function perform the integration </span>

<span class="sd">        TM = \int_g dE \int_h dE&#39; S(E) M(E) f(E) P(E -&gt; E&#39;) / \int_g dE f(E)</span>

<span class="sd">    where \int_g is the integral of E from E_i to E_{i+1}, \int_g is the integral of E&#39; from E&#39;_j to E&#39;_{j+1}, S(E) is the cross section,</span>
<span class="sd">    M(E) is the products multiplicity, f(E) is the flux weighting and P(E -&gt; E&#39;) is the probability for a projectile of energy E producing</span>
<span class="sd">    a primary gamma of energy E&#39; for binding energy bindingEnergy. This function assumes that M(E) is a constant. For primary gamma&#39;s captured</span>
<span class="sd">    into binding energy bindingEnergy P(E -&gt; E&#39;) = deltaFunction( E&#39; - ( bindingEnergy + massRatio E ) ) where massRatio = mt / ( mp + mt ),</span>
<span class="sd">    mp is the projectile&#39;s mass and mt is the target&#39;s mass. Note, this formula is from the ENDF manual which ignores the recoil of the residual</span>
<span class="sd">    nucleus.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">reactionSuite</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span>
    <span class="n">projectileName</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">projectile</span>
    <span class="n">projectileGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">projectileName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span>
    <span class="n">productName</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;productName&#39;</span><span class="p">]</span>
    <span class="n">productGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">productName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span>
    <span class="n">flux0</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">getFluxAtLegendreOrder</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="n">groupedFlux</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;groupedFlux&#39;</span><span class="p">]</span>

    <span class="n">bindingEnergy</span> <span class="o">=</span> <span class="n">energyData</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">energyData</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unitConversionFactor</span><span class="p">(</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">massRatio</span> <span class="o">=</span> <span class="n">energyData</span><span class="o">.</span><span class="n">massRatio</span>

    <span class="n">nProj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">projectileGroupBoundaries</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">nProd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">productGroupBoundaries</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">TM_1</span><span class="p">,</span> <span class="n">TM_E</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">nProj</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">TM_1</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TM_E</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">nProd</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">TM_1</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.</span> <span class="p">]</span>
            <span class="n">TM_E</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.</span> <span class="p">]</span>
    <span class="n">Eg2</span> <span class="o">=</span> <span class="n">bindingEnergy</span> <span class="o">+</span> <span class="n">massRatio</span> <span class="o">*</span> <span class="n">projectileGroupBoundaries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">indexEo</span><span class="p">,</span> <span class="n">Eo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">productGroupBoundaries</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">Eg2</span> <span class="o">&lt;=</span> <span class="n">Eo</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>
    <span class="n">indexEo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="n">indexEo</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">),</span> <span class="n">nProd</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="n">EMin</span><span class="p">,</span> <span class="n">EMax</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMax</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axesModule</span><span class="o">.</span><span class="n">Axes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">labelsUnits</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;energy_out&#39;</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="n">crossSection</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)})</span>
    <span class="n">Egp</span> <span class="o">=</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">bindingEnergy</span> <span class="o">+</span> <span class="n">massRatio</span> <span class="o">*</span> <span class="n">EMin</span> <span class="p">],</span> <span class="p">[</span> <span class="n">EMax</span><span class="p">,</span> <span class="n">bindingEnergy</span> <span class="o">+</span> <span class="n">massRatio</span> <span class="o">*</span> <span class="n">EMax</span> <span class="p">]</span> <span class="p">],</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span> <span class="p">)</span>

    <span class="k">for</span> <span class="n">indexEi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">nProj</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">Ei2</span> <span class="o">=</span> <span class="n">projectileGroupBoundaries</span><span class="p">[</span><span class="n">indexEi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">Eg2</span> <span class="o">=</span> <span class="n">bindingEnergy</span> <span class="o">+</span> <span class="n">massRatio</span> <span class="o">*</span> <span class="n">Ei2</span>
        <span class="n">EiMin</span> <span class="o">=</span> <span class="n">projectileGroupBoundaries</span><span class="p">[</span><span class="n">indexEi</span><span class="p">]</span>
        <span class="k">while</span><span class="p">(</span> <span class="kc">True</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">incrementIndexEo</span><span class="p">,</span> <span class="n">EiMax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ei2</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">indexEo</span> <span class="o">&lt;</span> <span class="p">(</span> <span class="n">nProd</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">Eg2</span> <span class="o">&gt;</span> <span class="n">productGroupBoundaries</span><span class="p">[</span><span class="n">indexEo</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">incrementIndexEo</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">EiMax</span> <span class="o">=</span> <span class="p">(</span> <span class="n">productGroupBoundaries</span><span class="p">[</span><span class="n">indexEo</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bindingEnergy</span> <span class="p">)</span> <span class="o">/</span> <span class="n">massRatio</span>
            <span class="n">TM_1</span><span class="p">[</span><span class="n">indexEi</span><span class="p">][</span><span class="n">indexEo</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">integrateTwoFunctions</span><span class="p">(</span> <span class="n">flux0</span><span class="p">,</span> 
                    <span class="n">domainMin</span> <span class="o">=</span> <span class="n">EiMin</span><span class="p">,</span> <span class="n">domainMax</span> <span class="o">=</span> <span class="n">EiMax</span> <span class="p">)</span> <span class="o">/</span> <span class="n">groupedFlux</span><span class="p">[</span><span class="n">indexEi</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">TM_E</span><span class="p">[</span><span class="n">indexEi</span><span class="p">][</span><span class="n">indexEo</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">integrateThreeFunctions</span><span class="p">(</span> <span class="n">flux0</span><span class="p">,</span> <span class="n">Egp</span><span class="p">,</span> 
                    <span class="n">domainMin</span> <span class="o">=</span> <span class="n">EiMin</span><span class="p">,</span> <span class="n">domainMax</span> <span class="o">=</span> <span class="n">EiMax</span> <span class="p">)</span> <span class="o">/</span> <span class="n">groupedFlux</span><span class="p">[</span><span class="n">indexEi</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">incrementIndexEo</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>
            <span class="n">EiMin</span> <span class="o">=</span> <span class="n">EiMax</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">indexEo</span> <span class="o">&lt;</span> <span class="p">(</span> <span class="n">nProd</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">indexEo</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">TM_1</span><span class="p">,</span> <span class="n">TM_E</span> <span class="p">)</span></div>

<div class="viewcode-block" id="NBodyPhaseSpace"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.NBodyPhaseSpace">[docs]</a><span class="k">def</span> <span class="nf">NBodyPhaseSpace</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">numberOfProducts</span><span class="p">,</span> <span class="n">mTotal</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span>
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: phase space spectrum</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Number of particles: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">numberOfProducts</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Total mass: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">mTotal</span><span class="p">,</span> <span class="mi">14</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Q value: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">Q</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span>
    <span class="n">productFrame</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">centerOfMass</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="KalbachMann_TransferMatrix"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.KalbachMann_TransferMatrix">[docs]</a><span class="k">def</span> <span class="nf">KalbachMann_TransferMatrix</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">particlesData</span><span class="p">,</span> <span class="n">KalbachMannData</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">logFile</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">],</span> 
    <span class="n">workDir</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span>

    <span class="n">energy_in_unit</span> <span class="o">=</span> <span class="s1">&#39;MeV&#39;</span>
    <span class="n">s</span>  <span class="o">=</span> <span class="n">versionStr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Process: Kalbach spectrum</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Projectile&#39;s ZA: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">particlesData</span><span class="p">[</span><span class="s1">&#39;projectile&#39;</span><span class="p">][</span><span class="s1">&#39;ZA&#39;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Target&#39;s ZA: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">particlesData</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">][</span><span class="s1">&#39;ZA&#39;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Product&#39;s ZA: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">particlesData</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">][</span><span class="s1">&#39;ZA&#39;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Compound&#39;s mass: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">particlesData</span><span class="p">[</span><span class="s1">&#39;compound&#39;</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">],</span> <span class="mi">14</span> <span class="p">)</span>
    <span class="n">productFrame</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">centerOfMass</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="o">=</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">KalbachMannDataToString</span><span class="p">(</span> <span class="n">KalbachMannData</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">transferMatrixExecute</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">],</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;restart&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="executeCommand"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.executeCommand">[docs]</a><span class="k">def</span> <span class="nf">executeCommand</span><span class="p">(</span> <span class="n">logFile</span><span class="p">,</span> <span class="n">executable</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">workFile</span><span class="p">,</span> <span class="n">restart</span><span class="p">,</span> <span class="n">productOffset</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
    <span class="c1"># FIXME remove unused argument logFile?</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs executable (presumably Merced) on a single input, parses resulting output file and returns two transfer matrices:</span>
<span class="sd">     - 1st has constant weight (conserves number of particles)</span>
<span class="sd">     - 2nd is weighted by E&#39; (conserves energy)</span>

<span class="sd">    If executable fails, create a &#39;.err&#39; file in the working directory (for easier searching)</span>

<span class="sd">    @param logFile: currently unused! Remove argument?</span>
<span class="sd">    @param executable: compiled executable to run, generally FUDGE/bin/merced</span>
<span class="sd">    @param cmd: full text of executable input file</span>
<span class="sd">    @param workDir: directory where executable will be run. processProtare creates new workDir for each projectile/target/temperature</span>
<span class="sd">    @param workFile: list of form [reaction identifier, product identifier], e.g. [&#39;r0001&#39;,&#39;n&#39;] or [&#39;r0045&#39;,&#39;photon__b&#39;]. Used to generate unique file names.</span>
<span class="sd">    @param restart: boolean. If True, check whether executable was previously run for this input and if so skip re-running (useful for resuming jobs that timed out).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">checkNegative_l0</span><span class="p">(</span> <span class="n">TM_EEpL</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">f</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">negative_l0Counter</span><span class="p">,</span> <span class="n">largestNegative</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">ig</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">TM_EEpL</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">TM_EpL</span> <span class="o">=</span> <span class="n">TM_EEpL</span><span class="p">[</span><span class="n">ig</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ih</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">TM_EpL</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">l0Cell</span> <span class="o">=</span> <span class="n">TM_EpL</span><span class="p">[</span><span class="n">ih</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">l0Cell</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">negative_l0Counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">largestNegative</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="n">largestNegative</span><span class="p">,</span> <span class="n">l0Cell</span> <span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;    negative l=0 for weight </span><span class="si">%s</span><span class="s1"> at row </span><span class="si">%3d</span><span class="s1"> column </span><span class="si">%3d</span><span class="s1">: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">weight</span><span class="p">,</span> <span class="n">ig</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">l0Cell</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">negative_l0Counter</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">executable</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Merced executable not found.&#39;</span> <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="n">workDir</span> <span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span> <span class="n">workDir</span> <span class="p">)</span>
    <span class="n">workFile</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">workFile</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_in&#39;</span>
    <span class="n">fullFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">workDir</span><span class="p">,</span> <span class="n">workFile</span> <span class="p">)</span>
    <span class="n">outputFile</span> <span class="o">=</span> <span class="n">fullFileName</span> <span class="o">+</span> <span class="s2">&quot;.out&quot;</span>
    <span class="n">infoFile</span> <span class="o">=</span> <span class="n">fullFileName</span> <span class="o">+</span> <span class="s2">&quot;.info&quot;</span>
    <span class="n">fOut</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">infoFile</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">restart</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullFileName</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullFileName</span> <span class="o">+</span> <span class="s2">&quot;.err&quot;</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullFileName</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                <span class="n">previousInput</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">previousInput</span> <span class="o">==</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="c1"># This input has already been successfully run (e.g. by previous processProtare run that timed out).</span>
                <span class="c1"># Ensure variables are initialized:</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Reading previously computed results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="n">timesModule</span><span class="o">.</span><span class="n">Times</span><span class="p">(</span> <span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">restart</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restart</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">restart</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">fullFileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">dataFile</span><span class="p">:</span>
            <span class="n">dataFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">timesModule</span><span class="o">.</span><span class="n">Times</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">subprocessingModule</span><span class="o">.</span><span class="n">executeCommand</span><span class="p">(</span> <span class="p">[</span> <span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-output&#39;</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">+</span><span class="s2">&quot;.tmp&quot;</span><span class="p">,</span> <span class="n">fullFileName</span> <span class="p">],</span>
                <span class="n">stdout</span> <span class="o">=</span> <span class="n">infoFile</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span> <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">outputFile</span><span class="o">+</span><span class="s2">&quot;.tmp&quot;</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="n">fErr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">fullFileName</span> <span class="o">+</span> <span class="s2">&quot;.err&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span> <span class="p">)</span>
            <span class="n">fErr</span><span class="o">.</span><span class="n">close</span><span class="p">(</span> <span class="p">)</span>
            <span class="k">raise</span>

    <span class="c1"># executable is finished, parse results</span>
    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">t0</span> <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;status = &quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Transfer failed for </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">executable</span><span class="p">,</span> <span class="n">fullFileName</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">parseOutputFile</span><span class="p">(</span> <span class="n">fullFileName</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span><span class="p">,</span> <span class="n">productOffset</span> <span class="p">)</span>
    <span class="n">negative_l0Counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">TM1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">negative_l0Counter</span> <span class="o">=</span> <span class="n">checkNegative_l0</span><span class="p">(</span> <span class="n">TM1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">fOut</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">TME</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">negative_l0Counter</span> <span class="o">+=</span> <span class="n">checkNegative_l0</span><span class="p">(</span> <span class="n">TME</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">fOut</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">negative_l0Counter</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    WARNING: </span><span class="si">%d</span><span class="s1"> negative l=0 elements found in transfer matrix&#39;</span> <span class="o">%</span> <span class="n">negative_l0Counter</span><span class="p">)</span>
    <span class="n">fOut</span><span class="o">.</span><span class="n">close</span><span class="p">(</span> <span class="p">)</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">workDir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">fullFileName</span> <span class="o">+</span> <span class="s1">&#39;.out&#39;</span> <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">fullFileName</span> <span class="o">+</span> <span class="s1">&#39;.info&#39;</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">workFile</span> <span class="o">==</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">dataFile</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">dataFile</span><span class="o">.</span><span class="n">close</span><span class="p">(</span> <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">fullFileName</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span> <span class="p">)</span></div>

<div class="viewcode-block" id="parseOutputFile"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.parseOutputFile">[docs]</a><span class="k">def</span> <span class="nf">parseOutputFile</span><span class="p">(</span> <span class="n">file</span><span class="p">,</span> <span class="n">productOffset</span><span class="p">,</span> <span class="n">firstLine</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="k">def</span> <span class="nf">checkKeyValue</span><span class="p">(</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">keyValue</span><span class="p">,</span> <span class="n">_key</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">try</span> <span class="p">:</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">keyValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s1">&#39;=&#39;</span> <span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;bad key/value = &quot;</span><span class="si">%s</span><span class="s1">&quot; at line </span><span class="si">%d</span><span class="s1"> while looking for key = &quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">keyValue</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">_key</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">_key</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span> <span class="s1">&#39;bad key = &quot;</span><span class="si">%s</span><span class="s1">&quot; at line </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">key</span><span class="p">,</span> <span class="n">lineNumber</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="k">return</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;bad value type </span><span class="si">%s</span><span class="s1"> at line </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">lineNumber</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseCrossSection</span><span class="p">(</span> <span class="n">paras</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">file</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">s1</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s1">&#39;:&#39;</span> <span class="p">)</span>                        <span class="c1"># This line should start as &#39;Cross section: n = &#39;</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s1">&#39;=&#39;</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s1">&#39;:&#39;</span> <span class="p">)</span>                        <span class="c1"># This line should start as &#39;Interpolation: &#39;</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span> <span class="p">)</span>
        <span class="n">lineNumber</span> <span class="o">+=</span> <span class="n">n1</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">lineNumber</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseTransferMatrix</span><span class="p">(</span> <span class="n">paras</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">productOffset</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">s1</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s2">&quot;:&quot;</span> <span class="p">)</span>                      <span class="c1"># This line should start as &#39;Integrals, weight = ...&#39;</span>
        <span class="n">EBins</span> <span class="o">=</span> <span class="n">checkKeyValue</span><span class="p">(</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;numEinBins&#39;</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">EBins</span> <span class="o">&gt;</span> <span class="n">paras</span><span class="p">[</span><span class="s1">&#39;numEinBins&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Bad transfer numEinBins = </span><span class="si">%d</span><span class="s1"> != </span><span class="si">%d</span><span class="s1"> in file </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">EBins</span><span class="p">,</span> <span class="n">paras</span><span class="p">[</span><span class="s1">&#39;numEinBins&#39;</span><span class="p">],</span> <span class="n">file</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">lMax</span> <span class="o">=</span> <span class="n">paras</span><span class="p">[</span><span class="s1">&#39;outputLegendreOrder&#39;</span><span class="p">]</span>
        <span class="n">lMaxPlus1</span> <span class="o">=</span> <span class="n">lMax</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">TM</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">paras</span><span class="p">[</span><span class="s1">&#39;numEinBins&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span> 
            <span class="n">TMEp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">paras</span><span class="p">[</span><span class="s1">&#39;numEoutBins&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">productOffset</span> <span class="p">)</span> <span class="p">:</span> <span class="n">TMEp</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lMaxPlus1</span> <span class="o">*</span> <span class="p">[</span> <span class="mf">0.</span> <span class="p">]</span>
            <span class="n">TM</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">TMEp</span>
        <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">EBins</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">lineNumber</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s2">&quot;:&quot;</span> <span class="p">)</span>                  <span class="c1"># This should start as &#39;EinBin = ...&#39;</span>
            <span class="n">EBin</span> <span class="o">=</span> <span class="n">checkKeyValue</span><span class="p">(</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;EinBin&#39;</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">EBin</span> <span class="o">&lt;</span> <span class="n">EBins</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Bad transfer EinBin at lineNumber = </span><span class="si">%d</span><span class="s1"> in file </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">EpBins</span> <span class="o">=</span> <span class="n">checkKeyValue</span><span class="p">(</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;numEoutBins&#39;</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">EpBins</span> <span class="o">&gt;</span> <span class="n">paras</span><span class="p">[</span><span class="s1">&#39;numEoutBins&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Bad transfer numEoutBins at lineNumber = </span><span class="si">%d</span><span class="s1"> in file </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">EpBins</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">lineNumber</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rowLs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">rowLs</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">lMaxPlus1</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Bad transfer lRows at lineNumber = </span><span class="si">%d</span><span class="s1"> in file </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">i3</span><span class="p">,</span> <span class="n">Cl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">rowLs</span> <span class="p">)</span> <span class="p">:</span> <span class="n">TM</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i2</span><span class="o">+</span><span class="n">productOffset</span><span class="p">][</span><span class="n">i3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cl</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">TM</span><span class="p">,</span> <span class="n">lineNumber</span> <span class="p">)</span>

    <span class="n">crossSection</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">TM1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">TME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span> <span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">file</span> <span class="p">)</span>
    <span class="k">except</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Could not open transfer file = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">file</span> <span class="p">)</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span> <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span> <span class="p">)</span>
    <span class="n">rightFirstLine</span> <span class="o">=</span> <span class="s2">&quot;merced: version 1</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">firstLine</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span> <span class="n">rightFirstLine</span> <span class="o">=</span> <span class="n">firstLine</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rightFirstLine</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Bad transfer file version in file </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">file</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">lineNumber</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">ls</span> <span class="p">)</span>
    <span class="n">paras</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;outputLegendreOrder&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;numEinBins&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;numEoutBins&#39;</span> <span class="p">:</span> <span class="kc">None</span> <span class="p">}</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">lineNumber</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s2">&quot;:&quot;</span> <span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;outputLegendreOrder&#39;</span><span class="p">,</span> <span class="s1">&#39;numEinBins&#39;</span><span class="p">,</span> <span class="s1">&#39;numEoutBins&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">paras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Bad transfer file, multiple key = </span><span class="si">%s</span><span class="s2"> lines in file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">key</span><span class="p">,</span> <span class="n">file</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">paras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Bad transfer file, could not convert data for key = </span><span class="si">%s</span><span class="s2"> to integer</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> in file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">key</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">],</span> <span class="n">file</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Comment&quot;</span> <span class="p">)</span> <span class="p">:</span> 
            <span class="k">pass</span>
        <span class="k">elif</span><span class="p">(</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;maxIncidentEnergyGroup&quot;</span> <span class="p">)</span> <span class="p">:</span> 
            <span class="n">paras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Cross section&quot;</span> <span class="p">)</span> <span class="p">:</span> 
            <span class="k">if</span><span class="p">(</span> <span class="n">crossSection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Bad transfer file, multiple cross section datasets in file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file</span> <span class="p">)</span>
            <span class="n">lineNumber</span> <span class="o">=</span> <span class="n">parseCrossSection</span><span class="p">(</span> <span class="n">paras</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">file</span> <span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Integrals, weight = 1&quot;</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">TM1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Bad transfer file, multiple weight = 1 datasets in file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file</span> <span class="p">)</span>
            <span class="n">TM1</span><span class="p">,</span> <span class="n">lineNumber</span> <span class="o">=</span> <span class="n">parseTransferMatrix</span><span class="p">(</span> <span class="n">paras</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">productOffset</span> <span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;Integrals, weight = E&#39;&quot;</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">TME</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Bad transfer file, multiple weight = E&#39; datasets in file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file</span> <span class="p">)</span>
            <span class="n">TME</span><span class="p">,</span> <span class="n">lineNumber</span> <span class="o">=</span> <span class="n">parseTransferMatrix</span><span class="p">(</span> <span class="n">paras</span><span class="p">,</span> <span class="n">lineNumber</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">productOffset</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Bad transfer file key in file </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">file</span><span class="p">,</span> <span class="n">ls</span><span class="p">[</span><span class="n">lineNumber</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">lineNumber</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">TM1</span><span class="p">,</span> <span class="n">TME</span><span class="p">,</span> <span class="n">paras</span> <span class="p">)</span></div>

<div class="viewcode-block" id="commonDataToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.commonDataToString">[docs]</a><span class="k">def</span> <span class="nf">commonDataToString</span><span class="p">(</span> <span class="n">comment</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">productFrame</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">photonFrame</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">lab</span><span class="p">,</span> <span class="n">legendreMax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modifiedProductGroup</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">reactionSuite</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span>
    <span class="n">projectileName</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">projectile</span>
    <span class="n">projectileGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">projectileName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span>
    <span class="n">productName</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;productName&#39;</span><span class="p">]</span>
    <span class="n">productGroupBoundaries</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">transportables</span><span class="p">[</span><span class="n">productName</span><span class="p">]</span><span class="o">.</span><span class="n">group</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">modifiedProductGroup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">):</span> <span class="n">productGroupBoundaries</span> <span class="o">=</span> <span class="n">modifiedProductGroup</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">legendreMax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">legendreMax</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;legendreMax&#39;</span><span class="p">]</span>
    <span class="n">s</span>  <span class="o">=</span> <span class="s2">&quot;outputLegendreOrder: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">legendreMax</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Comment: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">comment</span>

    <span class="n">masses</span> <span class="o">=</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;masses&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">masses</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">particle</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">mass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&#39;s mass: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">particle</span><span class="p">,</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="p">(</span> <span class="n">masses</span><span class="p">[</span><span class="n">particle</span><span class="p">]</span> <span class="p">),</span> <span class="mi">14</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Projectile Frame: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">projectileFrame</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">GBToString</span><span class="p">(</span> <span class="s1">&#39;Projectile&#39;</span><span class="p">,</span> <span class="n">projectileGroupBoundaries</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="n">maximumEnergy_in</span> <span class="o">=</span> <span class="n">projectileGroupBoundaries</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">GBToString</span><span class="p">(</span> <span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="n">productGroupBoundaries</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="n">fluxToString</span><span class="p">(</span> <span class="n">style</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">crossSection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="n">crossSectionToString</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">multiplicity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="n">multiplicityToString</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="o">=</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">productName</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="p">)</span> <span class="p">:</span> <span class="n">productFrame</span> <span class="o">=</span> <span class="n">photonFrame</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Product Frame: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">productFrame</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">addExtraBlankLine</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="GBToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.GBToString">[docs]</a><span class="k">def</span> <span class="nf">GBToString</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">gb</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">boundaries</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">boundaries</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">energy_in_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">boundaries</span><span class="o">.</span><span class="n">unitConversionFactor</span><span class="p">(</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="n">s</span>  <span class="o">=</span> <span class="n">startOfNewData</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&#39;s group boundaries: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">boundaries</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">oneDToString</span><span class="p">(</span> <span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">factor</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="fluxToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.fluxToString">[docs]</a><span class="k">def</span> <span class="nf">fluxToString</span><span class="p">(</span> <span class="n">flux</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">flux0</span> <span class="o">=</span> <span class="n">flux</span><span class="o">.</span><span class="n">getFluxAtLegendreOrder</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">energy_in_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">flux0</span> <span class="o">=</span> <span class="n">flux0</span><span class="o">.</span><span class="n">convertAxisToUnit</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="n">interpolationStr</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flux0</span><span class="p">,</span> <span class="n">addHeader</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span>
    <span class="n">s</span>  <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Fluxes: n = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">flux0</span> <span class="p">)</span> <span class="p">]</span>
    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">interpolationStr</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">Ein</span><span class="p">,</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="n">flux0</span> <span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;Ein: &#39;</span> <span class="o">+</span> <span class="p">(</span> <span class="n">doubleFmt</span> <span class="o">%</span> <span class="n">Ein</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: n = 1&#39;</span> <span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="p">(</span> <span class="n">doubleFmt</span> <span class="o">%</span> <span class="n">Cls</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="crossSectionToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.crossSectionToString">[docs]</a><span class="k">def</span> <span class="nf">crossSectionToString</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">energy_in_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">crossSection</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span><span class="o">.</span><span class="n">convertAxisToUnit</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;Cross section&quot;</span><span class="p">,</span> <span class="n">crossSection</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="multiplicityToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.multiplicityToString">[docs]</a><span class="k">def</span> <span class="nf">multiplicityToString</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">_multiplicity</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="n">_multiplicity</span> <span class="p">)</span>
    <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="mf">1e-8</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">energy_in_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span><span class="o">.</span><span class="n">convertAxisToUnit</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;Multiplicity&quot;</span><span class="p">,</span> <span class="n">multiplicity</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="angularToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.angularToString">[docs]</a><span class="k">def</span> <span class="nf">angularToString</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">twoBody</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">changeInterpolationQualifierWarning</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">weightString</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">weightString</span> <span class="o">=</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">addExtraBlankLine</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Isotropic2d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Angular data: n = 2</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">linlin</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing cosine interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">linlin</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">]</span> <span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> : n = 2</span><span class="se">\n</span><span class="s2">   -1 0.5</span><span class="se">\n</span><span class="s2">   1 0.5</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span> <span class="o">%</span> <span class="n">x</span> <span class="p">)</span>

    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Angular data: n = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">angularData</span> <span class="p">)</span>

            <span class="n">interpolationQualifier</span> <span class="o">=</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolationQualifier</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolationQualifier</span> <span class="o">==</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">twoBody</span> <span class="p">)</span> <span class="p">:</span>    <span class="c1"># Don&#39;t use direct interpolation!</span>
                <span class="n">interpolationQualifier</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span>

            <span class="k">if</span><span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">linlin</span><span class="p">,</span> <span class="n">flat</span> <span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">_angularData</span> <span class="o">=</span> <span class="n">angularData</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>
                <span class="n">_angularData</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">linlin</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">changeInterpolationQualifierWarning</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: interpolation </span><span class="si">%s</span><span class="s1"> is ignored, treated as </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">_angularData</span><span class="o">.</span><span class="n">interpolation</span> <span class="p">))</span>

            <span class="k">if</span><span class="p">(</span> <span class="n">twoBody</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> \
                        <span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">interpolationQualifier</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
                        <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">interpolationQualifier</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">interpolations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">POfMu</span><span class="o">.</span><span class="n">interpolation</span> <span class="k">for</span> <span class="n">POfMu</span> <span class="ow">in</span> <span class="n">angularData</span> <span class="p">)</span>
            <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">interpolations</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span><span class="p">(</span> <span class="p">(</span> <span class="n">linlin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interpolations</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span> <span class="n">flat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interpolations</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">interpolation</span> <span class="o">=</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolation</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">linearizeXYs</span> <span class="p">)</span> <span class="p">:</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="n">linlin</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing cosine interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">interpolation</span>

            <span class="n">s</span> <span class="o">+=</span> <span class="n">threeDListToString</span><span class="p">(</span> <span class="n">angularData</span><span class="p">,</span> <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="n">linearizeXYs</span> <span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">Legendre</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">interpolation</span> <span class="o">=</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolationQualifier</span> <span class="o">!=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;interpolation qualifier = &quot;</span><span class="si">%s</span><span class="s1">&quot; is not supported.&#39;</span> <span class="o">%</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolationQualifier</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">interpolation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">linlin</span><span class="p">,</span> <span class="n">flat</span> <span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">_angularData</span> <span class="o">=</span> <span class="n">angularData</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>
                <span class="n">_angularData</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">linlin</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">changeInterpolationQualifierWarning</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: ignoring interpolation &quot;</span><span class="si">%s</span><span class="s1">&quot; and using &quot;</span><span class="si">%s</span><span class="s1">&quot; instead&#39;</span> <span class="o">%</span>
                          <span class="p">(</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">_angularData</span><span class="o">.</span><span class="n">interpolation</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">angularData</span> <span class="o">=</span> <span class="n">_angularData</span>

            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Legendre coefficients: n = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">angularData</span> <span class="p">)</span> <span class="p">]</span>

            <span class="k">if</span><span class="p">(</span> <span class="n">twoBody</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">interpolationStr</span> <span class="o">=</span> <span class="s1">&#39;Interpolation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">interpolationStr</span> <span class="o">=</span> <span class="s1">&#39;Interpolation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">angularData</span><span class="o">.</span><span class="n">interpolation</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">interpolationStr</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">energy_in</span> <span class="ow">in</span> <span class="n">angularData</span> <span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39; Ein: </span><span class="si">%s</span><span class="s1">:  n = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">energy_in</span><span class="o">.</span><span class="n">outerDomainValue</span><span class="p">,</span> <span class="mi">12</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">energy_in</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">coefficient</span> <span class="ow">in</span> <span class="n">energy_in</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">coefficient</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;angular data = </span><span class="si">%s</span><span class="s2"> not supported&quot;</span> <span class="o">%</span> <span class="n">angularData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>

    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;angular data = </span><span class="si">%s</span><span class="s2"> not supported&quot;</span> <span class="o">%</span> <span class="n">angularData</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="n">weightString</span> <span class="o">+</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="energyFunctionToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.energyFunctionToString">[docs]</a><span class="k">def</span> <span class="nf">energyFunctionToString</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

    <span class="k">def</span> <span class="nf">getParameter</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">_linlin</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">lowerEps</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">upperEps</span> <span class="p">)</span>
        <span class="n">sData</span> <span class="o">=</span> <span class="p">[</span> <span class="n">startOfNewData</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: n = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">label</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">_linlin</span> <span class="p">)</span> <span class="p">)</span> <span class="p">]</span>
        <span class="n">sData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;Interpolation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">linlin</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">_linlin</span> <span class="p">:</span> <span class="n">sData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="mi">12</span> <span class="p">),</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">sData</span> <span class="p">)</span>

    <span class="n">sData</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="p">(</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">SimpleMaxwellianFission</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">Evaporation</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">Watt</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;U: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">energyData</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">energyData</span><span class="o">.</span><span class="n">parameter1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="p">),</span> <span class="mi">12</span> <span class="p">)</span> <span class="p">)</span>

    <span class="n">parameter1</span> <span class="o">=</span> <span class="n">energyData</span><span class="o">.</span><span class="n">parameter1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">lowerEps</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">upperEps</span> <span class="p">)</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">energyData</span><span class="o">.</span><span class="n">parameter2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">parameter2</span> <span class="o">=</span> <span class="n">energyData</span><span class="o">.</span><span class="n">parameter2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">lowerEps</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">upperEps</span> <span class="p">)</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axesModule</span><span class="o">.</span><span class="n">Axes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="n">parameter1</span><span class="o">.</span><span class="n">domainMin</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="n">parameter1</span><span class="o">.</span><span class="n">domainMax</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">flat</span><span class="p">)</span>
    <span class="n">sData</span> <span class="o">+=</span> <span class="n">twoDToString</span><span class="p">(</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">addExtraBlankLine</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">GeneralEvaporation</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sProcess</span> <span class="o">=</span> <span class="s1">&#39;Process: general evaporation</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sSpecific</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">sData</span> <span class="o">+=</span> <span class="n">getParameter</span><span class="p">(</span> <span class="n">parameter1</span><span class="p">,</span> <span class="s1">&#39;Theta&#39;</span> <span class="p">)</span>
        <span class="n">sData</span> <span class="o">+=</span> <span class="n">getParameter</span><span class="p">(</span> <span class="n">parameter2</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">SimpleMaxwellianFission</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sProcess</span> <span class="o">=</span> <span class="s1">&#39;Process: Maxwell spectrum</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sSpecific</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">sData</span> <span class="o">+=</span> <span class="n">getParameter</span><span class="p">(</span> <span class="n">parameter1</span><span class="p">,</span> <span class="s1">&#39;Theta&#39;</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">Evaporation</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sProcess</span> <span class="o">=</span> <span class="s1">&#39;Process: Evaporation spectrum</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sSpecific</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">sData</span> <span class="o">+=</span> <span class="n">getParameter</span><span class="p">(</span> <span class="n">parameter1</span><span class="p">,</span> <span class="s1">&#39;Theta&#39;</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">Watt</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sProcess</span> <span class="o">=</span> <span class="s1">&#39;Process: Watt spectrum</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sSpecific</span> <span class="o">=</span> <span class="s1">&#39;Conserve: number</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sData</span> <span class="o">+=</span> <span class="n">getParameter</span><span class="p">(</span> <span class="n">parameter1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="p">)</span>
        <span class="n">sData</span> <span class="o">+=</span> <span class="n">getParameter</span><span class="p">(</span> <span class="n">parameter2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">energyData</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">MadlandNix</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sProcess</span> <span class="o">=</span> <span class="s1">&#39;Process: Madland-Nix spectrum</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sSpecific</span> <span class="o">=</span> <span class="s1">&#39;Conserve: number</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sSpecific</span> <span class="o">+=</span> <span class="s1">&#39;EFL: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">energyData</span><span class="o">.</span><span class="n">EFL</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">energyData</span><span class="o">.</span><span class="n">parameter1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="p">),</span> <span class="mi">12</span> <span class="p">)</span>
        <span class="n">sSpecific</span> <span class="o">+=</span> <span class="s1">&#39;EFH: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">energyData</span><span class="o">.</span><span class="n">EFH</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span> <span class="n">energyData</span><span class="o">.</span><span class="n">parameter1</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="p">),</span> <span class="mi">12</span> <span class="p">)</span>
        <span class="n">sData</span> <span class="o">+=</span> <span class="n">getParameter</span><span class="p">(</span> <span class="n">parameter1</span><span class="p">,</span> <span class="s1">&#39;TM&#39;</span> <span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Unsupport energy functional = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">energyData</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span>

    <span class="n">sData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">sProcess</span><span class="p">,</span> <span class="n">sSpecific</span><span class="p">,</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">sData</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="EEpPDataToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.EEpPDataToString">[docs]</a><span class="k">def</span> <span class="nf">EEpPDataToString</span><span class="p">(</span> <span class="n">EEpPData</span><span class="p">,</span> <span class="n">changeInterpolationQualifierWarning</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">startOfNewData</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;EEpPData: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">EEpPData</span> <span class="p">)</span>

    <span class="n">qualifier</span> <span class="o">=</span> <span class="n">EEpPData</span><span class="o">.</span><span class="n">interpolationQualifier</span>
    <span class="k">if</span> <span class="n">qualifier</span> <span class="o">==</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">EEpPData</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">!=</span> <span class="n">flat</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">changeInterpolationQualifierWarning</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    WARNING: changing interpolation qualifier from None to unitbase&#39;</span><span class="p">)</span>
            <span class="n">qualifier</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">EEpPData</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">qualifier</span><span class="p">]</span> <span class="p">)</span>

    <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">POfEp</span> <span class="ow">in</span> <span class="n">EEpPData</span> <span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">POfEp</span><span class="p">,</span> <span class="n">energyModule</span><span class="o">.</span><span class="n">XYs1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="n">linearizeXYs</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">interpolations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">POfEp</span><span class="o">.</span><span class="n">interpolation</span> <span class="k">for</span> <span class="n">POfEp</span> <span class="ow">in</span> <span class="n">EEpPData</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">interpolations</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">interpolation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span> <span class="n">linlin</span><span class="p">,</span> <span class="n">flat</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">EEpPData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">linearizeXYs</span> <span class="p">)</span> <span class="p">:</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="n">linlin</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing energy interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">interpolation</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="n">threeDToString</span><span class="p">(</span> <span class="n">EEpPData</span><span class="p">,</span> <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="n">linearizeXYs</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="LEEpPDataToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.LEEpPDataToString">[docs]</a><span class="k">def</span> <span class="nf">LEEpPDataToString</span><span class="p">(</span> <span class="n">LEEpPData</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">startOfNewData</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;LEEpPData: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">LEEpPData</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">linlin</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">])</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing energy interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">linlin</span>
    <span class="k">for</span> <span class="n">l_EEpP</span> <span class="ow">in</span> <span class="n">LEEpPData</span> <span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">startOfNewSubData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;  l = </span><span class="si">%d</span><span class="s2">: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">l_EEpP</span><span class="o">.</span><span class="n">outerDomainValue</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">l_EEpP</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">threeDToString</span><span class="p">(</span> <span class="n">l_EEpP</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="LegendreDataToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.LegendreDataToString">[docs]</a><span class="k">def</span> <span class="nf">LegendreDataToString</span><span class="p">(</span> <span class="n">LegendreData</span><span class="p">,</span> <span class="n">changeInterpolationQualifierWarning</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;Legendre data by incident energy:  n = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">LegendreData</span> <span class="p">)</span> <span class="p">]</span>


    <span class="n">qualifier</span> <span class="o">=</span> <span class="n">LegendreData</span><span class="o">.</span><span class="n">interpolationQualifier</span>
    <span class="k">if</span> <span class="n">qualifier</span> <span class="o">==</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
        <span class="n">qualifier</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span>
    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">LegendreData</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">qualifier</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>

    <span class="n">interpolation</span> <span class="o">=</span> <span class="n">LegendreData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">interpolation</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">linlin</span><span class="p">,</span> <span class="n">flat</span> <span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;Outgoing energy interpolation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">interpolation</span> <span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">changeInterpolationQualifierWarning</span> <span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;    WARNING: converting interpolation from &quot;</span><span class="si">%s</span><span class="s1">&quot; to &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">linlin</span><span class="p">))</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;Outgoing energy interpolation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">linlin</span> <span class="p">)</span>

    <span class="k">for</span> <span class="n">EEpCl</span> <span class="ow">in</span> <span class="n">LegendreData</span> <span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot; Ein: </span><span class="si">%s</span><span class="s2">:  n = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">EEpCl</span><span class="o">.</span><span class="n">outerDomainValue</span><span class="p">,</span> <span class="mi">12</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">EEpCl</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">EpCl</span> <span class="ow">in</span> <span class="n">EEpCl</span> <span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">startOfNewSubData</span> <span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;  Eout: </span><span class="si">%s</span><span class="s2">:  n = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">EpCl</span><span class="o">.</span><span class="n">outerDomainValue</span><span class="p">,</span> <span class="mi">12</span> <span class="p">),</span> <span class="nb">len</span><span class="p">(</span> <span class="n">EpCl</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">Cl</span> <span class="ow">in</span> <span class="n">EpCl</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;   </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PQUModule</span><span class="o">.</span><span class="n">floatToShortestString</span><span class="p">(</span> <span class="n">Cl</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">startOfNewData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="EMuEpPDataToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.EMuEpPDataToString">[docs]</a><span class="k">def</span> <span class="nf">EMuEpPDataToString</span><span class="p">(</span> <span class="n">EMuEpPData</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">startOfNewData</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;EMuEpPData: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">EMuEpPData</span> <span class="p">)</span>

    <span class="n">qualifier</span> <span class="o">=</span> <span class="n">EMuEpPData</span><span class="o">.</span><span class="n">interpolationQualifier</span>
    <span class="k">if</span> <span class="n">qualifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span><span class="p">,</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;interpolation qualifier = </span><span class="si">%s</span><span class="s1"> is not supported&#39;</span> <span class="o">%</span> <span class="n">qualifier</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">EMuEpPData</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">!=</span> <span class="n">linlin</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;interpolation = &quot;</span><span class="si">%s</span><span class="s1">&quot; is not supported&#39;</span> <span class="o">%</span> <span class="n">EMuEpPData</span><span class="o">.</span><span class="n">interpolation</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">linlin</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">])</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing cosine interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">linlin</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">])</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing energy interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">linlin</span>

    <span class="k">for</span> <span class="n">muEpP</span> <span class="ow">in</span> <span class="n">EMuEpPData</span> <span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">startOfNewSubData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">muEpP</span><span class="o">.</span><span class="n">outerDomainValue</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;  E = </span><span class="si">%s</span><span class="s2">: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span> <span class="o">%</span> <span class="n">E</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">muEpP</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">threeDToString</span><span class="p">(</span> <span class="n">muEpP</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="EEpMuPDataToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.EEpMuPDataToString">[docs]</a><span class="k">def</span> <span class="nf">EEpMuPDataToString</span><span class="p">(</span> <span class="n">EEpMuPData</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">startOfNewData</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;EEpMuPData: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">EEpMuPData</span> <span class="p">)</span>

    <span class="n">qualifier</span> <span class="o">=</span> <span class="n">EEpMuPData</span><span class="o">.</span><span class="n">interpolationQualifier</span>
    <span class="k">if</span> <span class="n">qualifier</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">none</span><span class="p">,</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">correspondingPoints</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: converting interpolation qualifier from &quot;</span><span class="si">%s</span><span class="s1">&quot; to &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qualifier</span><span class="p">,</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">))</span>
        <span class="n">qualifier</span> <span class="o">=</span> <span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Incident energy interpolation: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">EEpMuPData</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">qualifier</span> <span class="p">)</span>

    <span class="n">outgoingInterpolations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">xys2d</span><span class="o">.</span><span class="n">interpolation</span> <span class="k">for</span> <span class="n">xys2d</span> <span class="ow">in</span> <span class="n">EEpMuPData</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outgoingInterpolations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Multiple outgoing energy interpolation(s) </span><span class="si">%s</span><span class="s1"> not supported&#39;</span> <span class="o">%</span> <span class="n">outgoingInterpolations</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing energy interpolation: </span><span class="si">%s</span><span class="s1"> direct</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">EEpMuPData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolation</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Outgoing cosine interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">EEpMuPData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolation</span>

    <span class="k">for</span> <span class="n">EpMuP</span> <span class="ow">in</span> <span class="n">EEpMuPData</span> <span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">startOfNewSubData</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;  E = </span><span class="si">%s</span><span class="s2">: n = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span> <span class="o">%</span> <span class="n">EpMuP</span><span class="o">.</span><span class="n">outerDomainValue</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">EpMuP</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">threeDToString</span><span class="p">(</span> <span class="n">EpMuP</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="KalbachMannDataToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.KalbachMannDataToString">[docs]</a><span class="k">def</span> <span class="nf">KalbachMannDataToString</span><span class="p">(</span> <span class="n">KalbachMannData</span><span class="p">,</span> <span class="n">energy_in_unit</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">nForm</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">KalbachMannData</span><span class="o">.</span><span class="n">aSubform</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="n">nForm</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">nForm</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;This is currently not implemented&#39;</span> <span class="p">)</span>

    <span class="n">fSubform</span> <span class="o">=</span> <span class="n">KalbachMannData</span><span class="o">.</span><span class="n">fSubform</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rSubform</span> <span class="o">=</span> <span class="n">KalbachMannData</span><span class="o">.</span><span class="n">rSubform</span><span class="o">.</span><span class="n">data</span>

    <span class="n">factor</span> <span class="o">=</span> <span class="n">fSubform</span><span class="o">.</span><span class="n">domainUnitConversionFactor</span><span class="p">(</span> <span class="n">energy_in_unit</span> <span class="p">)</span> <span class="c1"># Energies passed to get_transfer must be in energy_in_unit, traditionally MeV.</span>
    <span class="n">_fSubform</span> <span class="o">=</span> <span class="n">multiD_XYsModule</span><span class="o">.</span><span class="n">XYs2d</span><span class="p">(</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">xys</span> <span class="ow">in</span> <span class="n">fSubform</span> <span class="p">:</span>
        <span class="n">_xys</span> <span class="o">=</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="n">xys</span><span class="o">.</span><span class="n">nf_pointwiseXY</span><span class="o">.</span><span class="n">scaleOffsetXAndY</span><span class="p">(</span> <span class="n">xScale</span> <span class="o">=</span> <span class="n">factor</span><span class="p">,</span> <span class="n">yScale</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">factor</span> <span class="p">),</span> <span class="n">outerDomainValue</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">xys</span><span class="o">.</span><span class="n">outerDomainValue</span> <span class="p">)</span>
        <span class="n">_fSubform</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">_xys</span> <span class="p">)</span>

    <span class="n">_rSubform</span> <span class="o">=</span> <span class="n">multiD_XYsModule</span><span class="o">.</span><span class="n">XYs2d</span><span class="p">(</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">xys</span> <span class="ow">in</span> <span class="n">rSubform</span> <span class="p">:</span>
        <span class="n">_xys</span> <span class="o">=</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="n">xys</span><span class="o">.</span><span class="n">nf_pointwiseXY</span><span class="o">.</span><span class="n">scaleOffsetXAndY</span><span class="p">(</span> <span class="n">xScale</span> <span class="o">=</span> <span class="n">factor</span> <span class="p">),</span> <span class="n">outerDomainValue</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">xys</span><span class="o">.</span><span class="n">outerDomainValue</span> <span class="p">)</span>
        <span class="n">_rSubform</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">_xys</span> <span class="p">)</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">startOfNewData</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Kalbach probabilities: n = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">_fSubform</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Incident energy interpolation: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">linlin</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBase</span><span class="p">])</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Outgoing energy interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fSubform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">threeDListToString</span><span class="p">(</span> <span class="n">_fSubform</span> <span class="p">)</span>

    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Kalbach r parameter: n = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span> <span class="n">rSubform</span> <span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Incident energy interpolation: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rSubform</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">GNDS2ProcessingInterpolationQualifiers</span><span class="p">[</span><span class="n">xDataEnumsModule</span><span class="o">.</span><span class="n">InterpolationQualifier</span><span class="o">.</span><span class="n">unitBaseUnscaled</span><span class="p">])</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;Outgoing energy interpolation: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rSubform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">threeDListToString</span><span class="p">(</span> <span class="n">_rSubform</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div>

<div class="viewcode-block" id="oneDToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.oneDToString">[docs]</a><span class="k">def</span> <span class="nf">oneDToString</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;&quot;</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">doubleFmt</span> <span class="o">%</span> <span class="p">(</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">d</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="twoDToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.twoDToString">[docs]</a><span class="k">def</span> <span class="nf">twoDToString</span><span class="p">(</span> <span class="n">label</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">addHeader</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">addExtraBlankLine</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span> <span class="p">:</span>

    <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">XYs1dModule</span><span class="o">.</span><span class="n">XYs1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">interpolation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">linlin</span><span class="p">,</span> <span class="n">flat</span> <span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">lowerEps</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">upperEps</span> <span class="p">)</span>
        <span class="n">interpolationStr</span> <span class="o">=</span> <span class="s1">&#39;Interpolation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="k">elif</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">regionsModule</span><span class="o">.</span><span class="n">Regions1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">lowerEps</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">upperEps</span> <span class="p">)</span>
        <span class="n">interpolationStr</span> <span class="o">=</span> <span class="s1">&#39;Interpolation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;ERROR from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="vm">__file__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;Unsupported data type: see prior output&#39;</span> <span class="p">)</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span><span class="p">,</span> <span class="n">doubleFmt</span> <span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">]</span>
    <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="n">addHeader</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span><span class="p">(</span> <span class="n">interpolationStr</span><span class="p">,</span> <span class="n">a</span> <span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">interpolationStr</span> <span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: n = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">label</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">addExtraBlankLine</span> <span class="p">)</span> <span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span></div>

<div class="viewcode-block" id="threeDToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.threeDToString">[docs]</a><span class="k">def</span> <span class="nf">threeDToString</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wFmt</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> : n = </span><span class="si">%%</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span> <span class="p">)</span>
    <span class="n">xyFmt</span> <span class="o">=</span> <span class="s2">&quot;   </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span><span class="p">,</span> <span class="n">doubleFmt</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">w_xy</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">startOfNewSubData</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">type</span><span class="p">(</span> <span class="n">w_xy</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>       <span class="c1"># ???? This is a kludge until Legendre EEpP data is represented like angular EMuP data.</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;need to update for new gnds forms&#39;</span> <span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w_xy</span><span class="o">.</span><span class="n">outerDomainValue</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">w_xy</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">linearizeXYs</span> <span class="p">)</span> <span class="p">:</span> <span class="n">xy</span> <span class="o">=</span> <span class="n">w_xy</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="mf">1e-8</span> <span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">wFmt</span> <span class="o">%</span> <span class="p">(</span> <span class="n">w</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">xy</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">xy</span> <span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">xyFmt</span> <span class="o">%</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="threeDListToString"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.threeDListToString">[docs]</a><span class="k">def</span> <span class="nf">threeDListToString</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">linearizeXYs</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wFmt</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> : n = </span><span class="si">%%</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span> <span class="p">)</span>
    <span class="n">xyFmt</span> <span class="o">=</span> <span class="s2">&quot;   </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">doubleFmt</span><span class="p">,</span> <span class="n">doubleFmt</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">w_xy</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">startOfNewSubData</span> <span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">w_xy</span><span class="o">.</span><span class="n">outerDomainValue</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">linearizeXYs</span> <span class="p">)</span> <span class="p">:</span> <span class="n">w_xy</span> <span class="o">=</span> <span class="n">w_xy</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="mf">1e-8</span> <span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">wFmt</span> <span class="o">%</span> <span class="p">(</span> <span class="n">w</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">w_xy</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">w_xy</span> <span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">xyFmt</span> <span class="o">%</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="addTMs"><a class="viewcode-back" href="../../../../fudge/fudge.processing.deterministic.html#fudge.processing.deterministic.transferMatrices.addTMs">[docs]</a><span class="k">def</span> <span class="nf">addTMs</span><span class="p">(</span> <span class="n">TMs</span> <span class="p">)</span> <span class="p">:</span>

    <span class="n">TM</span> <span class="o">=</span> <span class="n">TMs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">TM</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">TM_energy_in</span> <span class="o">=</span> <span class="n">TM</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">TM_energy_in</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">TM_energy_in_out</span> <span class="o">=</span> <span class="n">TM_energy_in</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">TM2</span> <span class="ow">in</span> <span class="n">TMs</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">i3</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">TM_energy_in_out</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">TM_energy_in_out</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">TM2</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">i2</span><span class="p">][</span><span class="n">i3</span><span class="p">]</span>
                
    <span class="k">return</span><span class="p">(</span> <span class="n">TM</span> <span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/gnd.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">Fudge and GNDS 6.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fudge.processing.deterministic.transferMatrices</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, B.Beck, D. Brown, C. Mattoon, N. Patel, N. Summers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>